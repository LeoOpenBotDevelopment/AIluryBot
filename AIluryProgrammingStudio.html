<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link id="faviconico" rel="icon" href="AIlurylogo.ico" type="image/x-icon">
    <title>AIlury Studio</title>
    <style>
        :root {
            --background-color: #ffffff;
            --text-color: #000000;
            --editor-background-color: #E9E9E9;
            --editor-background2-color: #E9E9E9;
            --header-background-color: #fff; /* #e0e0e0;*/
            --circle-color: #000000;
            --button-background-color: #000000;
            --button-text-color: #ffffff;
            --editor-color: #172C41;
            --button-disabled-color: #999999;
            --button-disabled-background-color: #cccccc;
            --tag-color: #a239ca;
            --attribute-color: #d500f9;
            --text2-color: #e040fb;
            --keyword-color: #e040fb;
            --string-color: #e292fe;
            --number-color: #ff8a80;
            --def-color: #ab47bc;
            --variable-color: #7e57c2;
            --variable-2-color: #8e24aa;
            --variable-3-color: #aa00ff;
            --property-color: #ba68c8;
            --operator-color: #e91e63;
            --comment-color: #7d7d7d;
            --meta-color: #800080;
            --qualifier-color: #8e24aa;
            --builtin-color: #800080;
            --error-color: #d32f2f;
            --bracket-color: #8e24aa;
            --link-color: #d81b60;
            --active-line-bg: #1e1e1e;
            --selection-bg: #2c2c2c;
            --matching-bracket-color: #800080;
            --highlight-bg-color: rgba(0, 0, 0, 0.2);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --background-color: #000000;
                --text-color: #ffffff;
                --editor-background-color: #122335;
                --editor-background2-color: #122335;
                --header-background-color: #000000;
                --circle-color: #ffffff;
                --button-background-color: #ffffff;
                --button-text-color: #000000;
                --editor-color: #49C7CC;
                --button-disabled-color: grey;
                --button-disabled-background-color: #121212;
                --tag-color: #a239ca;
                --attribute-color: #d500f9;
                --text2-color: #e040fb;
                --keyword-color: #e040fb;
                --string-color: #e292fe;
                --number-color: #ff8a80;
                --def-color: #ab47bc;
                --variable-color: #7e57c2;
                --variable-2-color: #8e24aa;
                --variable-3-color: #aa00ff;
                --property-color: #ba68c8;
                --operator-color: #e91e63;
                --comment-color: #7d7d7d;
                --meta-color: #800080;
                --qualifier-color: #8e24aa;
                --builtin-color: #800080;
                --error-color: #d32f2f;
                --bracket-color: #8e24aa;
                --link-color: #d81b60;
                --active-line-bg: #1e1e1e;
                --selection-bg: #2c2c2c;
                --matching-bracket-color: #800080;
                --highlight-bg-color: rgba(255, 255, 255, 0.2);
            }
        }
        body {
            display: flex;
            font-family: Arial, sans-serif;
            margin: 0;
            height: 100vh;
            padding: 0;
            width: 100vw;
            max-width: 100vw;
            transition: 1s;
            background: var(--background-color);
            /*overflow: hidden;*/
        }

        #editor-container {
            display: flex;
            margin-top: 0;
            width: calc(100vw - 70px);
            height: calc(100vh - 60px);
            transition: 1s;
        }

        #preview {
            flex: 1;
            height: 100%;
            width: calc(100vw - 70px);
            border: none;
            overflow: auto;
            transition: 1s;
            background-color: var(--editor-background-color);
            border-radius: 5px;
        }

        .CodeMirror {
            font-family: 'Fira Code', monospace;
            font-size: 1.3em;
            line-height: 1.5;
            background: var(--editor-background-color);
            color: var(--text-color);
            border-radius: 0;
        }

        /* Zeilennummern und Cursor */
        .cm-s-mytheme .CodeMirror-gutters {
            background: var(--button-text-color);
            color: var(--button-disabled-color);
            border: none;
            padding: 10px;
            background-color: var(--button-text-color);
        }

        /*.CodeMirror-cursor {
            color: var(--button-background-color);
            border: none;
        }
        .cm-s-mytheme .CodeMirror-cursor {
            border-left: none;
            border: none;
        }*/

        .cm-s-mytheme.CodeMirror {
            background-color: var(--editor-background2-color);
            color: var(--editor-color);
            border: none;
        }

        .CodeMirror-gutters {
            color: var(--button-disabled-color);
            background: var(--button-text-color);
            border: none;
        }

        .cm-s-mytheme .CodeMirror-gutter {
            color: var(--button-disabled-color);
            background: var(--button-text-color);
            border: none;
        }
        .CodeMirror-linenumber {
            background: var(--button-text-color);
            color: var(--button-disabled-color);
            font-family: Arial, sans-serif;
            font-weight: bold;
            font-size: 0.7em;
            border: none;
        }

        .cm-s-mytheme .CodeMirror-linenumber {
            color: var(--button-disabled-color);
            background: var(--button-text-color);
            font-family: Arial, sans-serif;
            font-weight: bold;
            font-size: 0.7em;
            border: none;
        }

        .cm-s-mytheme .CodeMirror-foldgutter{
            color: var(--button-disabled-color);
            background: var(--button-text-color);
            border: none;
        }

        #files {
            display: flex;
            align-items: center;
            background-color: var(--header-background-color);
            padding: 10px;
            border-bottom: none;
            overflow-x: auto;
            position: fixed;/*fixed*/
            top: 0;
            left: 0;
            width: 100%;
            z-index: 50;
            transition: 1s;
        }

        #index {
            padding: 10px 20px;
            margin-right: 5px;
            background-color: #3a3f47;
            border-radius: 5px;
            color: #ffffff;
            font-weight: 500;
            cursor: pointer;
            transition: 1s;
            min-width: 100px;
            text-align: center;
            white-space: nowrap;
        }

        .index.highlight {
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border-bottom: 0;
            position: relative;
            z-index: 1;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
        }
        .view.highlight {
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border-bottom: 0;
            position: relative;
            z-index: 1;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
        }

        .toolbtn {
            /*padding: 9px 20px;*/
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            font-weight: bold;
            color: var(--button-text-color);
            background: var(--button-background-color);
            border: none;
            border-radius: 100px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: 1s;
            cursor: pointer;
            margin: 8px 0;
            height: 50px;
            width: 50px;
        }

        #runbtn {
            font-size: 1em;
            padding: 12px 24px;
            background: linear-gradient(90deg, #ff0077, #7700ff);
            color: #fff;
        }

        #consolebtn {
            font-size: 1em;
            padding: 12px 24px;
        }

        .toolbtn:hover {
            background: var(--button-text-color);
            color: var(--button-background-color);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            transform: translateY(-2px);
        }

        .toolbtn:active {
            background: #e0e0e0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            transform: translateY(0);
        }

        .toolbtn:disabled {
            background: var(--button-disabled-background-color);
            color: var(--button-disabled-color);
            cursor: not-allowed;
            box-shadow: none;
        }

        #sidebar {
            background-color: var(--header-background-color);
            color: var(--text-color);
            position: absolute;
            width: 250px;
            height: 100vh;
            top: 0;
            left: -300px;
            padding: 10px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
            transition: 1s;
            z-index: 100;
            overflow-y: scroll;
            overflow-x: hidden;
        }

        #sidebar.show {
            left: 0;
        }

        .file {
            color: var(--text-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px;
            opacity: 1;
            border-bottom: 1px solid #5c5c5c;
            transition: 1s;
        }

        .file input {
            border: none;
            background: none;
            color: var(--text-color);
            font-size: 16px;
            width: 100%;
        }

        .file .options {
            position: relative;
        }

        .file .options .dropdown {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background-color: var(--text-color);
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }

        .file .options .dropdown button {
            display: block;
            background: none;
            border: none;
            color: var(--button-text-color);
            padding: 5px 10px;
            width: 100%;
            text-align: left;
            cursor: pointer;
        }

        .file .options .dropdown button:hover {
            background-color: var(--header-background-color);
            color: var(--text-color);
        }

        #addFile {
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 1.3em;
            margin-bottom: 10px;
            margin-left: 10px;
            font-weight: bold;
            height: 5%;
            transition: 1s;
        }

        #hidesidebar {
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 1.3em;
            margin-bottom: 10px;
            font-weight: bold;
            height: 5%;
            transition: 1s;
        }

        .file .menu-btn {
            cursor: pointer;
            color: var(--text-color);
            font-size: 20px;
            margin-left: 10px;
        }

        #filepath-container {
            display: flex;
            align-items: center;
            background-color: var(--editor-background-color);
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            width: calc(100vw - 90px);
            z-index: 10;
        }

        #filepath-container label {
            font-size: 1em;
            color: var(--editor-color);
            margin-right: 10px;
            white-space: nowrap;
        }

        #filepath-container input[type="text"] {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 4px;
            font-size: 1em;
            color: var(--editor-color);
            box-sizing: border-box;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background: transparent;
        }

        #filepath-container input[type="text"]:focus {
            border: none;
            outline: none;
        }

        .index {
            padding: 10px 20px;
            margin-right: 5px;
            background-color: var(--button-disabled-background-color);
            border-radius: 5px;
            color: var(--button-disabled-color);
            font-weight: 500;
            cursor: pointer;
            transition: 1s;
            min-width: 100px;
            text-align: center;
            white-space: nowrap;
        }

        .index:hover {
            background-color: var(--button-background-color);
            color: var(--button-text-color);
        }

        .index.highlight {
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border-bottom: 0;
            position: relative;
            z-index: 1;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1); /* Schatten unter dem aktiven Tab */
        }

        .view.highlight {
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border-bottom: 0;
            position: relative;
            z-index: 1;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1); /* Schatten unter dem aktiven Tab */
        }
        .cm-s-mytheme .cm-tag {
            color: var(--tag-color);
        }

        .cm-s-mytheme .cm-attribute {
            color: var(--attribute-color);
        }

        .cm-s-mytheme .cm-attribute.cm-tag {
            color: var(--text2-color);
        }

        .cm-s-mytheme .cm-keyword {
            color: var(--keyword-color);
        }

        .cm-s-mytheme .cm-string {
            color: var(--string-color);
        }

        .cm-s-mytheme .cm-number {
            color: var(--number-color);
        }

        .cm-s-mytheme .cm-def {
            color: var(--def-color);
        }

        .cm-s-mytheme .cm-variable {
            color: var(--variable-color);
        }

        .cm-s-mytheme .cm-variable-2 {
            color: var(--variable-2-color);
        }

        .cm-s-mytheme .cm-variable-3 {
            color: var(--variable-3-color);
        }

        .cm-s-mytheme .cm-property {
            color: var(--property-color);
        }

        .cm-s-mytheme .cm-operator {
            color: var(--operator-color);
        }

        .cm-s-mytheme .cm-comment {
            color: var(--comment-color);
        }

        .cm-s-mytheme .cm-meta {
            color: var(--meta-color);
        }

        .cm-s-mytheme .cm-qualifier {
            color: var(--qualifier-color);
        }

        .cm-s-mytheme .cm-builtin {
            color: var(--builtin-color);
        }

        .cm-s-mytheme .cm-error {
            background: rgba(255, 0, 0, 0.2);
        }

        .cm-s-mytheme .cm-bracket {
            color: var(--bracket-color);
        }

        .cm-s-mytheme .cm-link {
            color: var(--link-color);
        }

        .cm-s-mytheme .cm-activeLine {
            background: var(--active-line-bg);
        }

        .cm-s-mytheme .cm-selection {
            background: var(--selection-bg);
        }

        .cm-s-mytheme .cm-matchingbracket {
            text-decoration: underline;
            color: var(--matching-bracket-color);
            background-color: var(--matching-bracket-color);
        }
        .cm-s-mytheme .cm-matchingbrackets {
            text-decoration: underline;
            color: var(--matching-bracket-color);
            background-color: var(--matching-bracket-color);
        }

        .cm-s-mytheme .CodeMirror-hints {
            background-color: var(--button-text-color);
            color: var(--button-background-color);
            border: none;
            font-size: 1em;
            padding: 5px;
        }

        .cm-s-mytheme .CodeMirror-hint {
            padding: 2px 5px;
            cursor: pointer;
            font-family: 'Fira Code', monospace;
        }

        .cm-s-mytheme .CodeMirror-hint-active {
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            font-family: 'Fira Code', monospace;
        }

        .cm-s-mytheme .CodeMirror-search-field{
            background-color: var(--button-text-color) !important;
            color: var(--button-background-color) !important;
            border: none;
            font-size: 1em;
            padding: 5px;
        }

        .cm-s-mytheme .CodeMirror-search-field input{
            background-color: transparent;
            color: var(--button-background-color) !important;
            border: none;
            font-size: 1em;
            padding: 5px;
        }

        .CodeMirror-foldgutter-open {
            background-color: transparent;
            color: var(--button-disabled-color) !important;
            border: none;
            font-size: 1em;
            padding: 5px;
            font-weight: bold;
        }

        .CodeMirror-foldgutter-folded {
            background-color: transparent;
            color: var(--button-disabled-color) !important;
            border: none;
            font-size: 1em;
            padding: 5px;
            font-weight: bold;
        }

        .CodeMirror-hints {
            color: var(--button-text-color) !important;
            background-color: var(--button-background-color) !important;
            border: none !important;
            font-family: 'Fira Code', monospace !important;
        }

        .CodeMirror-hint {
            color: var(--button-text-color) !important;
            background-color: var(--button-background-color) !important;
            border: none !important;
            font-family: 'Fira Code', monospace !important;
        }

        .CodeMirror-hint-active {
            color: var(--button-background-color) !important;
            background-color: var(--button-text-color) !important;
        }

        #preview-container{
            width: calc(100vw - 50px);
            height: calc(100vh - 50px);
            display: flex;
            flex-direction: column;
            transition: 1s;
        }
        .resizable-draggable {
            display: none;
            width: 320px;
            height: 370px;
            background-color: var(--background-color);
            border: none;
            border-radius: 8px;
            position: absolute;
            right: 20%;
            top: 10%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 10px;
            resize: both;
            overflow-x: hidden;
            overflow-y: scroll;
            cursor: move;
            z-index: 50;
            transition: background-color 1s ease;
        }
        
        .resizable-draggable.show{
            display: block;
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            font-size: 2em;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            line-height: 20px;
            text-align: center;
            cursor: pointer;
            background: linear-gradient(to right, #ff0077, #7700ff); /* Farbverlauf */
            -webkit-background-clip: text; /* Hintergrundclip auf den Text anwenden */
            -webkit-text-fill-color: transparent;
            border: none;
            z-index: 52;
            transition: 1s;
        }

        .move-button{
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            font-size: 2em;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            line-height: 20px;
            text-align: center;
            cursor: pointer;
            color: var(--text-color);
            transition: 1s;
        }

        #console {
            margin-top: 0;
            width: 100%;
            height: 100%;
            margin-top: 15%;
            transition: 1s;
        }
        #console-message{
            color: var(--text-color);
            font-family: 'Fira Code', monospace;
            transition: 1s;
        }

        .error{
            color: red;
            font-family: 'Fira Code', monospace;
            transition: 1s;
        }

        .warn{
            color: orange;
            font-family: 'Fira Code', monospace;
            transition: 1s;
        }

        .info{
            color: var(--text-color);
            font-family: 'Fira Code', monospace;
            transition: 1s;
        }

        .log{
            color: var(--text-color);
            font-family: 'Fira Code', monospace;
            transition: 1s;
        }

        .success{
            color: green;
            font-family: 'Fira Code', monospace;
            transition: 1s;
        }

        .button-container{
            height: 40px;
            width: 280px;
            overflow-y: scroll;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            margin-top: 30px;
            transition: 1s;
            position: absolute;
            z-index: 51;
            margin-top: 0;
            margin-left: 0;
        }

        #console-container{
            height: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
            transition: 1s;
        }
        .console-setting-btn{
            background: var(--button-disabled-background-color);
            color: var(--button-disabled-color);
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.8em;
            margin-bottom: 10px;
            margin-left: 10px;
            /*width: 100%;*/
            transition: 1s;
        }
        .console-setting-btn:hover{
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            transition: 1s;
        }
        .console-setting-btn.enabled{
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            transition: 1s;
        }
        #UploadFile{
            text-decoration: underline;
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 1.3em;
            margin-bottom: 10px;
            margin-left: 10px;
            font-weight: bold;
            height: 5%;
            transition: 1s;
        }
        #currentFileImg{
            /*max-width: 90vw;
            max-height: 85vh;
            object-fit: cover;*/
            transition: 1s;
        }
        #currentFileImg-container{
            width: 81%;
            height: 95%;
            background: var(--editor-background-color);
            position: absolute;/*absolute*/
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 45;
            transition: 1s;
            display: none;
            justify-content: center;
            align-items: center;
            padding: calc(1% + 60px) 10%;
            overflow: hidden;
        }

        @media (max-width: 650px) {
            .resizable-draggable{
                height: 100vh;
                width: 100vw;
                position: fixed;
                left: 0;
                top: 0;
            }
            .move-button{
                display: none;
            }
        }

        #currentFileImg-container img{
            width: 80%;
            object-fit: cover;
        }

        .CodeMirror-ghost {
            opacity: 0.5;
            color: gray;
            pointer-events: none;
            position: absolute;
            transition: 1s;
        }

        #line-number-input-container{
            width: 20%;
            max-width: 250px;
            color: var(--button-background-color);
            background-color: var(--button-text-color);
            border: none;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            position: fixed;
            right: 10px;
            bottom: 10px;
            transition: 1s;
            z-index: 45;
        }

        #GO-button{
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border: none;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
            font-size: 1em;
            margin-left: 10px;
            width: 30%;
            transition: 1s;
        }

        #lineNumber{
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border: none;
            border-radius: 5px;
            padding: 10px;
            font-size: 1em;
            margin-left: 10px;
            width: 60%;
            transition: 1s;
        }

        #lineNumber:focus{
            outline: none;
        }

        @keyframes rotateAnimation {
            0% {
              filter: hue-rotate(0deg);
            }
            100% {
              filter: hue-rotate(360deg);
            }
        }
        #load {
            display: none;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            width: 100vw;
            background: rgba(0, 0, 0, 0.4);
            animation: rotateAnimation 10s linear infinite;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 999;
            transition: 1s;
        }
        #load .loader {
            position: relative;
            width: 120px;
            height: 120px;
            transition: 1s;
        }
        #load .loader span{
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            transform: rotate(calc(18deg * var(--i)));
            transition: 1s;
        }
        #load .loader span::before{
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #fff;
            box-shadow: 0 0 10px #fff;/*, 0 0 20px #fff, 0 0 40px #fff, 0 0 60px #fff, 0 0 80px #fff;*/
            animation: loadingAnimation 2s linear infinite;
            animation-delay: calc(0.1s * var(--i));
            transition: 1s;
        }
        @keyframes loadingAnimation{
            0%{
              transform: scale(0);
            }
            80%,100%{
              transform: scale(1);
            }
        }
        .file-icon{
            font-size: 1em;
        }
        #refreshBtn{
            background: transparent;
            color: var(--editor-color);
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 1.5em;
            margin-right: 20px;
            font-weight: bold;
            transition: 1s;
        }
        #preview-cross{
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            color: var(--editor-color);
            border: none;
            font-size: 2.5em;
            border-radius: none;
            z-index: 1111;
            font-weight: bold;
            display: none;
            text-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            transition: 1s;
        }
        #previewFullScreenBtn{
            background: transparent;
            color: var(--editor-color);
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 1.5em;
            margin-right: 20px;
            font-weight: bold;
            transform: rotate(45deg);
            transition: 1s;
        }
        #alert-icon{
            position: absolute;
            font-size: 1.5em;
            color: red;
            margin-top: -0.8em;
            margin-left: 0.3em;
            display: none;
            animation: alertAnimation 1s;
        }

        @keyframes alertAnimation {
            0%{
                transform: scale(1) rotate(0deg);
            }
            33%{
                transform: scale(1.5) rotate(45deg);
            }
            66%{
                transform: scale(1.5) rotate(-45deg);
            }
            100%{
                transform: scale(1) rotate(0deg);
            }
        }

        /**/
        #edit-sidebar-container{
            position: fixed;
            top: 49%;
            left: 7%;
            height: 250px;
            background: transparent;
            display: none;
            justify-content: space-between;
            max-width: 100vw;
            z-index: 52;
            transition: 1s;
        }
        @media (max-width: 650px){
            #edit-sidebar-container{
                position: fixed;
                top: 0;
                left: 0;
                height: 100vh;
                width: 100vw;
            }
        }
        #edit-sidebar-content{
            height: 100%;
            width: 400px;
            margin-left: 10px;
            /* grid 4 x 4 */
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(20, 1fr);
            grid-gap: 10px;
            padding: 10px;
            background-color: var(--header-background-color);
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: 1s;
        }
        .edit-sidebar-container-button{
            width: 50px;
            height: 50px;
            background-color: var(--button-background-color);
            border: none;
            border-radius: 50%;
            margin: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            color: var(--background-color);
            font-weight: bold;
            transition: 1s;
        }
        #edit-code-button{
            font-size: 1em;
        }
        #edit-bot-button{
            font-size: 1em;
        }
        #edit-close-sidebar-content{
            font-size: 2.5em;
            color: var(--button-background-color);
            /*font-weight: bold;*/
            transition: 1s;
            height: 50px;
            width: 50px;
            background: transparent;
            border: none;
            margin-left: 20px;
            margin-top: 0px;
            font-family: "PrimaryFont", "FallbackFont", sans-serif;
            text-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
        }
        .edit-sidebar-container-button:after{
            content: 'text';
            position: absolute;
            margin-bottom: -65px;
            font-size: 12px;
            font-weight: bold;
            color: #929292;
            transition: 1s;
        }
        #edit-bot-button:after{
            content: 'bot';
        }
        #edit-code-button:after{
            content: 'code area';
        }
        #edit-text-button:after{
            content: 'text area';
        }
        #edit-tag-button:after{
            content: 'comment';
        }
        #edit-timeline-button:after{
            content: 'timeline';
        }
        #edit-element-button:after{
            content: 'element';
        }
        #edit-folder-button:after{
            content: 'folder';
        }
        #edit-file-button:after{
            content: 'file';
        }
        #edit-clock-button:after{
            content: 'clock';
        }
        #edit-notes-button:after{
            content: 'notes';
        }
        #edit-paper-button:after{
            content: 'whiteboard';
        }
        #edit-addpage-button:after{
            content: '+page';
        }
        #edit-console-button:after{
            content: 'console';
        }
        #edit-workspace-top-tab-bar{
            width: 100vw;
            height: 50px;
            background-color: var(--background-color);;
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-top: 0;
            transition: 1s;
        }
        #edit-left-bar-workspace{
            height: calc(100vh - 50px);
            width: 100vw;
            background: transparent;
            display: flex;
            justify-content: space-between;
            gap: 10px;
            transition: 1s;
        }
        #edit-workspace-left-button-bar{
            width: 70px;
            height: calc(100vh - 50px);
            padding: 10px;
            background: var(--background-color);;
            display: flex;
            flex-direction: column;
            z-index: 49;
            transition: 1s;
        }
        #edit-workspace-content-display{
            width: calc(100vw - 50px);
            height: calc(100vh - 60px);
            background: var(--background-color);
            margin-top: 10px;
            display: flex;
            transition: 1s;
        }

        #edit-workspace{
            height: 100vh;
            width: 100vw;
            transition: 1s;
        }
        .edit-sidebar-container-button.Active{
            background: linear-gradient(90deg, #ff0077, #7700ff);
            color: #fff;
        }
        @keyframes fadeIn{
            0%{
                opacity: 0;
                transform: scale(0);
            }
            45%{
                opacity: 0.45;
                transform: scale(1.1);
            }
            70%{
                opacity: 0.75;
                transform: scale(0.9);
            }
            /*50%{
                opacity: 0.5;
                transform: scale(1.1);
            }
            75%{
                opacity: 0.75;
                transform: scale(0.9);
            }*/
            100%{
                opacity: 1;
                transform: scale(1);
            }
        }
        @keyframes fadeOut {
            0%{
                opacity: 1;
                transform: scale(1);
            }
            50%{
                transform: scale(0);
                opacity: 0;
            }
            100%{
                opacity: 0;
                transform: scale(0);
            }
        }

        /* notes start */

        .notes-container {
            position: absolute;
            left: 100px;
            top: 200px;
            z-index: 51;
            display: none;
        }
        #notes-editor-edit-container{
            width: 320px;/*200*/
            height: 380px;/*290*/
            background: var(--button-text-color);/* note background */
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .note-container {
            position: relative;
            display: inline-block;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            width: 290px;/*170*/
            height: 320px;/*290*/
            overflow: hidden;
            background: var(--button-text-color);/* note background*/
            border-radius: 10px;
        }
        .note-container header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #ccc;
        }
        .note-actions{
            width: 100px;/*100*/
            border-radius: 5px;
            background: var(--button-background-color);
            color: var(--button-text-color);
            position: absolute;
            display: none;
            flex-direction: column;
            right: 2px;
            top: 45px;
        }
        .note-container header .note-actions button {
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 5px;
            text-align: left;
        }
        .note-container header .note-actions button:hover {
            background: var(--button-text-color);
            color: var(--button-background-color);
        }
        .format-buttons {
            display: flex;
            margin-bottom: 10px;
            width: 320px;/*200*/
            overflow: scroll;
        }
        .format-buttons button, .toolbar button {
            padding: 10px;
            margin-right: 5px;
            cursor: pointer;
            border: none;
            border-radius: 10px;
            background-color: var(--button-background-color);
            color: var(--button-text-color);
        }
        #notes-editor {
            width: 300px;  /*180*/
            height: 220px;/*130*/
            border: none;
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background: transparent;
            position: relative;
            font-size: 1em;
            color: var(--text-color);
            z-index: 1;
            overflow: scroll;
        }
        #notes-editor:focus {
            outline: none;
        }
        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .toolbar input[type="color"] {
            margin-right: 10px;
        }
        .toolbar select {
            margin-right: 10px;
        }
        .hidden {
            display: none;
        }
        .note-content {
            min-height: 150px;
            word-wrap: break-word;
            white-space: normal;
            text-align: left;
            overflow-wrap: break-word;
            overflow: scroll;
            color: var(--text-color);
        }
        .notes-header{
            display: flex;
            justify-content: space-between;
            background: #ccc;
            background: linear-gradient(to right, #ff0077, #7700ff); /* Farbverlauf */
            -webkit-background-clip: text; /* Hintergrundclip auf den Text anwenden */
            -webkit-text-fill-color: transparent;
            padding: 10px;
            font-size: 15px;
            border-bottom: 1px solid #ccc;
            margin-bottom: 5px;
        }

        .notes-header-option-btn{
            background: transparent;
            background: linear-gradient(to right, #ff0077, #7700ff); /* Farbverlauf */
            -webkit-background-clip: text; /* Hintergrundclip auf den Text anwenden */
            -webkit-text-fill-color: transparent;
            border: none;
            cursor: pointer;
            border-radius: 10px;
            font-size: 15px;
        }

        #notes-font-picker{
            background: var(--button-background-color); /* Farbverlauf */
            color: var(--button-text-color);
            border: none;
            cursor: pointer;
            border-radius: 10px;
            font-size: 15px;
            padding: 10px;
            margin-left: 5px;
            width: 245px;/*135*/
            height: 35px;
        }
        #notes-font-picker:focus{
            outline: none;
        }
        #draggble-notes-btn{
            width: 50px;
            height: 20px;
            background: transparent;
            transition: 1s;
        }
        #notes-list{
            height: 380px;/*290*/
            width: 320px;/*200*/
            border-radius: 10px;
            overflow-y: scroll;
            color: var(--button-text-color);
        }
        .note-title{
            border: none;
            background: transparent;
            color: var(--text-color);
            font-size: 15px;
            width: 100px;
        }
        .note-title:focus{
            outline: none;
        }

        .show-note-options{
            color: var(--text-color);
        }

        #shownotesbtn{
            animation: fadeIn 1s;
            display: none;
        }

        .edit-sidebar-container-button.Active{
            background: linear-gradient(90deg, #ff0077, #7700ff);
            color: #fff;
        }

        /* notes end */
        #whiteboard-container {
            position: absolute;
            left: 0;
            top: 0;
            padding: 70px 0;
            display: none;
            flex-direction: column;
            align-items: center;
            margin: 0;
            height: 100vh;
            width: 100vw;
            z-index: 46;
            background-color: var(--editor-background-color);
        }
        canvas {
            border: none;
            background: white;
            cursor: crosshair;
            border-radius: 20px;
            width: 80vw;
        }
        #controls {
            margin: 10px;
        }
        .whiteboardeditor {
            display: none;
            position: absolute;
            background: var(--background-color);
            border: none;
            padding: 10px;
            border-radius: 10px;
            color: var(--text-color);
            font-size: 1em;
            font-family: 'Arial', sans-serif;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        .whiteboardeditor input {
            margin: 5px 0;
        }
        #controls button {
            padding: 10px 20px;
            border-radius: 100px;
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border: none;
            font-size: 1em;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: 1s;
        }
        #controls button:hover {
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px);
        }
        #controls input[type="text"]{
            padding: 10px 20px;
            border-radius: 100px;
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border: none;
            font-size: 1em;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: 1s;
        }
        #controls input[type="text"]:focus{
            outline: none;
        }
        #whiteboardeditor button {
            padding: 7px 14px;
            border-radius: 100px;
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border: none;
            font-size: 0.7em;
            cursor: pointer;
            font-family: 'Arial', sans-serif;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: 1s;
        }
        #whiteboardeditor button:hover{
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px);
        }
        #whiteboardeditor input[type="text"]{
            padding: 7px 14px;
            border-radius: 100px;
            background-color: var(--background-color);
            color: var(--text-color);
            border: none;
            font-size: 0.7em;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: 1s;
        }
        #whiteboardeditor input[type="text"]:focus{
            outline: none;
        }
        #whiteboardbtn{
            display: none;
        }
        .clock {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: transparent;
            color: var(--button-background-color);
            text-shadow: 0px 0px 10px var(--highlight-bg-color);
            padding: 10px;
            border-radius: 5px;
            font-size: 1em;
            animation: fadeInDown 1s;
            font-family: 'Arial', sans-serif;
            z-index: 900;
            display: none;
        }
        #timeline-container{
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 20px;
            background: var(--button-disabled-background-color);
            opacity: 0.5;
            color: none;
            display: none;
            z-index: 100;
        }
        #timeline-line{
            background: linear-gradient(to right, #ff0077, #7700ff);
            height: 100%;
            width: 0%;
            transition: 1s;
        }
        #consolebtn{
            display: none;
        }
        /* custom prompt and alert */
        /* Overlay - Füllt den Bildschirm aus */
        #custom-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6); /* Semi-transparentes Schwarz */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            animation: fadeInOverlay 0.3s ease-in-out; /* Overlay fade-in Animation */
        }

        /* Dialog - Zentrale Box */
        #custom-dialog {
            background: var(--button-disabled-background-color);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 400px; /* Max-Breite der Box */
            text-align: center;
            position: relative;
            animation: fadeInDialog 0.4s ease-in-out; /* Box fade-in Animation */
        }

        /* Schließen-Button */
        #close-dialog {
            position: absolute;
            top: 15px;
            right: 15px;
            cursor: pointer;
            font-size: 24px;
            color: var(--button-background-color);
            transition: color 0.2s;
        }

        /* Nachricht */
        #custom-message {
            font-size: 18px;
            color: var(--text-color);
            margin-bottom: 20px;
            padding: 10px;
            text-align: left;
            max-height: 200px;
            overflow: scroll;
        }

        /* Prompt Eingabe-Container */
        #prompt-input-container {
            margin-top: 15px;
        }

        /* Eingabefeld für prompt */
        #custom-input {
            width: 95%;
            padding: 10px;
            border-radius: 10px;
            border: none;
            font-size: 16px;
            margin-bottom: 15px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
            color: var(--text-color);
            background: transparent;
        }
        #custom-input:focus{
            outline: none;
        }

        /* Button für Submit und OK */
        #close-alert, #submit-prompt {
            margin-top: 10px;
            padding: 12px;
            width: 100%;
            background-color: var(--button-background-color); /*#007BFF;*/
            color: var(--button-text-color);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }

        #close-alert:hover, #submit-prompt:hover {
            background-color: var(--button-disabled-background-color); /* Hover-Effekt für Buttons */
            color: var(--text-color);
        }

        /* Animationen */
        @keyframes fadeInOverlay {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes fadeInDialog {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

    </style>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/fold/foldgutter.min.css">
    <link rel="stylesheet" href="https://codemirror.net/lib/codemirror.css">
    <link rel="stylesheet" href="https://codemirror.net/addon/dialog/dialog.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/show-hint.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/hint/show-hint.min.css">

</head>
<body>
    <div id="clock" class="clock"></div>
    <section id="load">
      <div class="loader">
        <span style="--i: 1"></span>
        <span style="--i: 2"></span>
        <span style="--i: 3"></span>
        <span style="--i: 4"></span>
        <span style="--i: 5"></span>
        <span style="--i: 6"></span>
        <span style="--i: 7"></span>
        <span style="--i: 8"></span>
        <span style="--i: 9"></span>
        <span style="--i: 10"></span>
        <span style="--i: 11"></span>
        <span style="--i: 12"></span>
        <span style="--i: 13"></span>
        <span style="--i: 14"></span>
        <span style="--i: 15"></span>
        <span style="--i: 16"></span>
        <span style="--i: 17"></span>
        <span style="--i: 18"></span>
        <span style="--i: 19"></span>
        <span style="--i: 20"></span>
      </div>
    </section>
    <div class="notes-container">
        <div id="notes-editor-edit-container">
            <div class="notes-header">
                <div class="notes-header-ready">ready</div>
                <div id="draggble-notes-btn"></div>
                <div class="notes-header-options"><button class="notes-header-option-btn" onclick="hideandshownotescontainer(this)">v</button><button class="notes-header-option-btn" onclick="createNewNote()">+</button></div>
            </div>
            <div class="format-buttons">
                <button onclick="formatText('bold')" style="font-weight: bold;">B</button>
                <button onclick="formatText('italic')" style="font-style: italic;">I</button>
                <button onclick="formatText('underline')" style="text-decoration: underline;">U</button>
                <button onclick="formatText('strikethrough')" style="text-decoration: line-through;">S</button>
                <button onclick="formatText('subscript')" style="vertical-align: sub;">sub</button>
                <button onclick="formatText('superscript')" style="vertical-align: super;">super</button>
                <button onclick="toggleChecklist()">Checklist</button>
            </div>

            <div id="notes-editor" contenteditable="true" placeholder="Type your note here..."></div>

            <div class="toolbar">
                <!-- <input type="color" id="color-picker" value="#000000" onchange="changeColor(event)"> -->
                <select id="notes-font-picker" onchange="changeFont(event)">
                    <option value="Arial" selected>Arial</option>
                    <option value="Georgia">Georgia</option>
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Courier New">Courier New</option>
                    <option value="Verdana">Verdana</option>
                </select>
                <button class="btn" onclick="saveNote()">save</button>
            </div>
        </div>

        <div id="notes-list">

        </div>

    </div>
    <div id="edit-sidebar-container">
      <div id="edit-sidebar-content">
        <!--<button class="edit-sidebar-container-button" id="edit-bot-button" onclick="toggleAI()">AI</button>-->
        <button class="edit-sidebar-container-button" id="edit-console-button" onclick="toggleConsole(this)">□</button>
        <!-- <button class="edit-sidebar-container-button Active" id="edit-code-button" onclick="toggleCodeMirror()">&lt;/&gt;</button> -->
        <!-- <button class="edit-sidebar-container-button" id="edit-text-button" onclick="toggleTextArea()">🅐</button> -->
        <button class="edit-sidebar-container-button" id="edit-timeline-button" onclick="toggleTineline(this)">◵</button>
        <!-- <button class="edit-sidebar-container-button" id="edit-element-button" onclick="toggleElement()">⧉</button> -->
        <button class="edit-sidebar-container-button" id="edit-clock-button" onclick="toggleClock(this)">◶</button>
        <button class="edit-sidebar-container-button" id="edit-notes-button" onclick="toggleNotesTextArea(this)">✎</button>
        <button class="edit-sidebar-container-button" id="edit-paper-button" onclick="toggleWhiteboard(this)">■</button>
      </div>
      <div id="edit-close-sidebar-content" onclick="hideandshoweditPagewindow()">⊗</div>
    </div>
    <button id="preview-cross" onclick="previewFullScreen()">×</button>
    
    <div id="sidebar">
        <input type="file" id="fileInput" accept="image/*,.txt,.html,.css,.js" style="display: none;">
        <button id="hidesidebar">←</button><button id="addFile">+</button><label for="fileInput"><button id="UploadFile">↓</button></label>
        <div id="fileList">

        </div>
    </div>
    <div class="resizable-draggable" id="resizable-element">
        <button class="close-button">×</button>
        <button class="move-button">✣</button>
        <div id="console-container">
            <div class="button-container" id="button-container">
                <button id="warning" class="console-setting-btn">warning</button>
                <button id="error" class="console-setting-btn">error</button>
                <button id="log" class="console-setting-btn">log</button>
                <button id="info" class="console-setting-btn">info</button>
                <button id="all" class="console-setting-btn">all</button>
            </div>
            <div class="console" id="console">

            </div>
        </div>
    </div>

    
    <div id="line-number-input-container">
        <input type="number" id="lineNumber" placeholder="line">
        <button id="GO-button" onclick="goToLine()">GO</button>
    </div>

    <div id="edit-workspace">
      <div id="edit-workspace-top-tab-bar">
          <div id="files">
              <div class="view index" draggable="true">view</div>
              <div class="index" id="whiteboardbtn" draggable="true">whiteboard</div>
          </div>
      </div>
      <div id="edit-left-bar-workspace">
        <div id="edit-workspace-left-button-bar">
            <!-- ⚙ -->
            <button class="toolbtn" id="toggleSidebar">≡</button>
            <button class="toolbtn" id="homebtn">⌂</button>
            <button class="toolbtn" id="runbtn">▶</button>
            <button class="toolbtn" id="consolebtn">□<span id="alert-icon">⚠</span></button>
            <button class="toolbtn" id="shownotesbtn">✎</button>
            <button class="toolbtn" id="editPagebtn">+</button>
        </div>
        <div id="edit-workspace-content-display">
            <div id="editor-container">
                <textarea id="editor"></textarea>
                <div id="preview-container">
                    <!-- ⏻ -->
                    <div id="filepath-container"><button id="previewFullScreenBtn" onclick="previewFullScreen()">↔</button><button id="refreshBtn" onclick="refreshFunction()">↻</button><label for="filename">/</label><input type="text" id="filename" placeholder="html file path..." value="index.html"></div><br>
                    <iframe id="preview" loading="lazy"></iframe>
                </div>
                <div id="currentFileImg-container">
                    <img src="" id="currentFileImg">
                </div>
                <div id="whiteboard-container">
                    <div id="controls">
                        <button class="alwaysenabled" id="whiteboardbackbutton" onclick="backtolastaction()">⌫</button>
                        <button class="alwaysenabled" id="whiteboardforwardbutton" onclick="backtofutureaction()">⌦</button>
                        <button class="alwaysenabled" onclick="clearCanvas()">↺</button>
                        <button onclick="createShape('rectangle', this)">▭</button>
                        <button onclick="createShape('circle', this)">○</button>
                        <button onclick="createShape('triangle', this)">△</button>
                        <button onclick="toggleDrawing(this)">─</button>
                        <button onclick="createShape('text', this)">🅐</button>
                        <input type="text" id="shapetext" placeholder="Text">
                        <input type="color" id="colorPicker" value="#000000">
                        <input style="display: none;" type="range" id="lineWidth" min="1" max="10" value="2">
                    </div>
                    <canvas id="whiteboard" width="800" height="600"></canvas>

                    <div id="whiteboardeditor" class="whiteboardeditor">
                        <h3>edit</h3>
                        <label id="borderRadiusLabel" for="borderRadius">Randradius:</label>
                        <!-- number -->
                        <input type="range" id="borderRadius" value="0" min="0" max="50"><br id="borderRadiusbr">
                        <label id="elementColorLabel" for="elementColor">border color:</label>
                        <input type="color" id="elementColor"><br id="elementColorbr">
                        <label id="bgColorLabel" for="bgColor">background color:</label>
                        <input type="color" id="bgColor"><br id="bgColorbr">
                        <label id="whiteboardeditorwidthLabel" for="whiteboardeditorwidth">width:</label>
                        <input type="range" id="whiteboardeditorwidth" min="1" max="700"><br id="whiteboardeditorwidthbr">
                        <label id="shapesborderthicknesLabel" for="shapesborderthicknes">border thicknes:</label>
                        <input type="range" id="shapesborderthicknes" min="0" max="20"><br id="shapesborderthicknesbr">
                        <label id="whiteboardeditorheightLabel" for="whiteboardeditorheight">height:</label>
                        <input type="range" id="whiteboardeditorheight" min="1" max="700"><br id="whiteboardeditorheightbr">
                        <label id="newshapetextLabel" for="newshapetext">text:</label>
                        <input type="text" id="newshapetext" placeholder="Text"><br id="newshapetextbr"><br>
                        <!-- <button id="applycahngesbtn">Änderungen anwenden</button> -->
                        <button id="deletecurrentshapebtn">delete</button>
                        <button id="cloneshapebtn">clone</button>
                        <button onclick="closeEditor()">close</button>
                    </div>
                </div>
            </div>
        </div>
      </div>
    </div>
    <div id="timeline-container">
        <div id="timeline-line"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/lint/lint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/lint/javascript-lint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jshint/2.13.0/jshint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/fold/foldcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/fold/brace-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/fold/xml-fold.min.js"></script>
    <script src="path/to/codemirror/addon/edit/closebrackets.js"></script>
    <script src="path/to/codemirror/addon/edit/closetag.js"></script>
    <script src="path/to/codemirror/addon/edit/matchtags.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/edit/closetag.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/edit/matchtags.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/edit/matchbrackets.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/fold/foldgutter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/fold/foldcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/fold/brace-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/fold/comment-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/fold/markdown-fold.min.js"></script>

    <script src="https://codemirror.net/addon/search/search.js"></script>
    <script src="https://codemirror.net/addon/search/searchcursor.js"></script>
    <script src="https://codemirror.net/addon/dragdrop/dragdrop.js"></script>
    <script src="https://codemirror.net/addon/edit/history.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/search/search.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/search/jump-to-line.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/display/fullscreen.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/display/placeholder.min.js"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/show-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/javascript-hint.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/hint/show-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/hint/html-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/hint/css-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/hint/javascript-hint.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/hint/show-hint.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/hint/xml-hint.min.js"></script>
    <script src="https://codemirror.net/addon/edit/closetag.js"></script>

    <div id="custom-overlay" style="display: none;">
        <div id="custom-dialog">
            <span id="close-dialog">&times;</span>
            <p id="custom-message"></p>
            <div id="prompt-input-container" style="display: none;">
                <input type="text" id="custom-input" placeholder="Enter a value">
                <button id="submit-prompt">Submit</button>
            </div>
            <button id="close-alert">OK</button>
        </div>
    </div>

    <script>
        // Get references to the overlay and dialog elements
        const overlay = document.getElementById('custom-overlay');
        const messageBox = document.getElementById('custom-message');
        const closeAlertButton = document.getElementById('close-alert');
        const promptInputContainer = document.getElementById('prompt-input-container');
        const promptInput = document.getElementById('custom-input');
        const submitPromptButton = document.getElementById('submit-prompt');
        const closeDialog = document.getElementById('close-dialog');

        // Function to show a custom alert

        function showAlert(message) {
            messageBox.textContent = message;
            promptInputContainer.style.display = 'none'; // Hide the input for alerts
            closeAlertButton.style.display = 'block'; // Show the OK button
            overlay.style.display = 'flex'; // Show the overlay
        }

        // Function to show a custom prompt
        function showPrompt(message, callback) {
            messageBox.textContent = message;
            promptInputContainer.style.display = 'block'; // Show the input for prompts
            closeAlertButton.style.display = 'none'; // Hide the OK button for prompts
            overlay.style.display = 'flex'; // Show the overlay

            submitPromptButton.onclick = () => {
                const inputValue = promptInput.value;
                callback(inputValue); // Return the input value to the callback function
                closeCustomDialog();
            };
        }

        // Function to close the custom dialog
        function closeCustomDialog() {
            overlay.style.display = 'none'; // Hide the overlay
            promptInput.value = ''; // Clear the input value
        }

        // Event listeners for closing the dialog
        overlay.addEventListener('click', (e) => {
            if (e.target === overlay) { // Close if the background (overlay) is clicked
                closeCustomDialog();
            }
        });

        closeAlertButton.addEventListener('click', closeCustomDialog);
        closeDialog.addEventListener('click', closeCustomDialog);




        





        

        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            const timeString = `${hours}:${minutes}:${seconds}`;

            document.getElementById('clock').textContent = timeString;
        }

        // Update the clock every second
        setInterval(updateClock, 1000);

        // Initialize the clock immediately
        updateClock();
        let whiteboardpast = [];
        let whiteboardfuture = [];
        const canvas = document.getElementById('whiteboard');
        const ctx = canvas.getContext('2d');
        let shapes = [];
        let selectedShape = null;
        let drawingLine = false;
        let isDrawing = false;
        let startX, startY;
        let currentLine = [];
        let iswhiteboard = false;
        let isonpreview = false;
        let oldshapeposition = null;

        document.getElementById('whiteboardbtn').addEventListener('click', () => {
            document.querySelector('.index.highlight')?.classList.remove('highlight');
            document.getElementById('whiteboardbtn').classList.add(`highlight`);
            iswhiteboard = true;
            isonpreview = false;
            checkscreensizing();
        });

        function Shape(type, x, y, width, height, color, bgColor, borderRadius, shapeborderWidth, shapetext) {
            this.type = type;
            this.x = x;
            this.y = y;
            this.width = width;
            this.height = height;
            this.color = color;
            this.bgColor = bgColor || 'transparent';
            this.borderRadius = borderRadius || 0;
            this.borderWidth = shapeborderWidth;
            this.isDragging = false;
            this.text = shapetext;
        }

        Shape.prototype.draw = function() {
            ctx.fillStyle = this.bgColor;
            ctx.strokeStyle = this.color;
            ctx.lineWidth = this.borderWidth;


            switch (this.type) {
                case 'rectangle':
                    ctx.beginPath();
                    ctx.roundRect(this.x, this.y, this.width, this.height, this.borderRadius);
                    ctx.fill();
                    ctx.stroke();
                    break;
                case 'circle':
                    ctx.beginPath();
                    ctx.arc(this.x + this.width / 2, this.y + this.height / 2, this.width / 2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                    break;
                case 'triangle':
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y + this.height);
                    ctx.lineTo(this.x + this.width / 2, this.y);
                    ctx.lineTo(this.x + this.width, this.y + this.height);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                    break;
                case 'line':
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                    ctx.lineTo(this.x + this.width, this.y + this.height);
                    ctx.stroke();
                    break;
                case 'text':
                    ctx.font = this.height + 'px Arial';
                    ctx.fillStyle = this.color;
                    ctx.fillText(this.text, this.x, this.y + this.height);
                    break;
            }
        };

        canvas.addEventListener('mousedown', (e) => {
            const pos = getMousePos(canvas, e);
            handleMouseDown(pos.x, pos.y);
        });

        canvas.addEventListener('mouseup', () => {
            handleMouseUp();
        });

        canvas.addEventListener('mousemove', (e) => {
            const pos = getMousePos(canvas, e);
            handleMouseMove(pos.x, pos.y);
        });

        canvas.addEventListener('touchstart', (e) => {
            const pos = getTouchPos(canvas, e);
            handleMouseDown(pos.x, pos.y);
            e.preventDefault();
        });

        canvas.addEventListener('touchend', () => {
            handleMouseUp();
        });

        canvas.addEventListener('touchmove', (e) => {
            const pos = getTouchPos(canvas, e);
            handleMouseMove(pos.x, pos.y);
            e.preventDefault();
        });

        function handleMouseDown(mouseX, mouseY) {
            /*selectedShape = shapes.find(shape => {
                return mouseX >= shape.x && mouseX <= shape.x + shape.width &&
                       mouseY >= shape.y && mouseY <= shape.y + shape.height;
            });*/
            let allselectedShapes = [];

            shapes.forEach(shape => {
                if (mouseX >= shape.x && mouseX <= shape.x + shape.width &&
                    mouseY >= shape.y && mouseY <= shape.y + shape.height) {
                    allselectedShapes.push(shape);
                }
            });

            selectedShape = allselectedShapes[allselectedShapes.length - 1];

            if (selectedShape) {
                selectedShape.isDragging = true;
                oldshapeposition = { x: selectedShape.x, y: selectedShape.y };
                showEditor(selectedShape);
            } else {
                if (isDrawing) {
                    startX = mouseX;
                    startY = mouseY;
                    currentLine.push({ x: startX, y: startY });
                }
                closeEditor();
            }
        }

        function handleMouseMove(mouseX, mouseY) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            shapes.forEach(shape => shape.draw());

            if (isDrawing && startX !== undefined && startY !== undefined) {
                currentLine.push({ x: mouseX, y: mouseY });
                ctx.beginPath();
                ctx.moveTo(currentLine[0].x, currentLine[0].y);
                currentLine.forEach(point => ctx.lineTo(point.x, point.y));
                ctx.strokeStyle = document.getElementById('colorPicker').value;
                ctx.lineWidth = document.getElementById('lineWidth').value;
                ctx.stroke();
            } else if (selectedShape && selectedShape.isDragging) {
                const dx = mouseX - (selectedShape.x + selectedShape.width / 2);
                const dy = mouseY - (selectedShape.y + selectedShape.height / 2);
                selectedShape.x += dx;
                selectedShape.y += dy;
                const editor = document.getElementById('whiteboardeditor');
                editor.style.display = 'block';
                editor.style.left = `${selectedShape.x + selectedShape.width + editor.style.width}px`;
                //editor.style.top = `${selectedShape.y + selectedShape.height + editor.style.height}px`;
                //editor.style.top = `${selectedShape.y + selectedShape.height + 100}px`;
                if (selectedShape.y > canvas.height / 2) {
                    // Wenn der Shape unterhalb der Hälfte des Canvas ist, wird der Editor über dem Shape gesetzt
                    editor.style.top = `${selectedShape.y - selectedShape.height - 50}px`;
                } else {
                    // Wenn der Shape oberhalb der Hälfte des Canvas ist, wird der Editor unter dem Shape gesetzt
                    editor.style.top = `${selectedShape.y + selectedShape.height + 150}px`;
                }
                redrawCanvas();  // Update canvas while dragging
            }
        }

        function handleMouseUp() {
            if (selectedShape) {
                selectedShape.isDragging = false;
                if (oldshapeposition !== null){
                    whiteboardfuture = [];
                    document.getElementById('whiteboardforwardbutton').style.background = 'var(--button-disabled-background-color)';
                    document.getElementById('whiteboardforwardbutton').style.color = 'var(--button-disabled-color)';
                    document.getElementById('whiteboardbackbutton').style.background = 'var(--button-background-color)';
                    document.getElementById('whiteboardbackbutton').style.color = 'var(--button-text-color)';
                    const newpast = {
                        element: selectedShape,
                        action: 'move',
                        x: oldshapeposition.x,
                        y: oldshapeposition.y
                    };
                    whiteboardpast.push(newpast);
                }
                selectedShape = null;
            } else {
                if (isDrawing) {
                    const endX = currentLine[currentLine.length - 1].x;
                    const endY = currentLine[currentLine.length - 1].y;
                    const newLine = new Shape('line', startX, startY, endX - startX, endY - startY, document.getElementById('colorPicker').value, '');
                    shapes.push(newLine);
                    currentLine = [];
                    whiteboardfuture = [];
                    document.getElementById('whiteboardforwardbutton').style.background = 'var(--button-disabled-background-color)';
                    document.getElementById('whiteboardforwardbutton').style.color = 'var(--button-disabled-color)';
                    document.getElementById('whiteboardbackbutton').style.background = 'var(--button-background-color)';
                    document.getElementById('whiteboardbackbutton').style.color = 'var(--button-text-color)';
                    let newpast = {
                        element: newLine,
                        action: 'create'
                    };
                    whiteboardpast.push(newpast);
                }
            }
            redrawCanvas();  // Redraw on mouse up
        }

        function clearCanvas() {
            whiteboardfuture = [];
            whiteboardpast = [];
            document.getElementById('whiteboardforwardbutton').style.background = 'var(--button-disabled-background-color)';
            document.getElementById('whiteboardforwardbutton').style.color = 'var(--button-disabled-color)';
            document.getElementById('whiteboardbackbutton').style.background = 'var(--button-disabled-background-color)';
            document.getElementById('whiteboardbackbutton').style.color = 'var(--button-disabled-color)';
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            shapes = [];
            currentLine = [];
            closeEditor();
        }

        function createShape(type, thiselementwasclicked) {
            isDrawing = false;
            const width = 100;
            const height = 50;
            const color = document.getElementById('colorPicker').value;
            let newShape;
            if (type == 'text'){
                const newtext = document.getElementById('shapetext').value;
                newShape = new Shape(type, 50, 50, width, height, color, 'transparent', 0, 2, newtext);
            }else {
                newShape = new Shape(type, 50, 50, width, height, color, 'transparent', 0, 2, '');
            }
            shapes.push(newShape);
            redrawCanvas();
            document.querySelectorAll('#controls button').forEach(child => {
                if(child != thiselementwasclicked){
                    let aproved = true;
                    if (child.classList.contains('alwaysenabled')){
                        aproved = false;
                    }
                    if (aproved){
                        child.style.background = 'var(--button-disabled-background-color)';
                        child.style.color = 'var(--button-disabled-color)';
                    }
                }else {
                    child.style.background = 'linear-gradient(90deg, #ff0077, #7700ff)';
                    child.style.color = '#fff';
                }
            });
            whiteboardfuture = [];
            document.getElementById('whiteboardforwardbutton').style.background = 'var(--button-disabled-background-color)';
            document.getElementById('whiteboardforwardbutton').style.color = 'var(--button-disabled-color)';
            document.getElementById('whiteboardbackbutton').style.background = 'var(--button-background-color)';
            document.getElementById('whiteboardbackbutton').style.color = 'var(--button-text-color)';
            let newpast = {
                element: newShape,
                action: 'create'
            };
            whiteboardpast.push(newpast);
        }

        function toggleDrawing(thiselementwasclicked) {
            isDrawing = !isDrawing;
            if (!isDrawing) currentLine = []; // Reset current line when toggled off
            /*document.querySelectorAll('#controls button').forEach(child => {
                if(child != thiselementwasclicked){
                    child.disabled = isDrawing;
                }
            });*/
            if (isDrawing){
                document.querySelectorAll('#controls button').forEach(child => {
                    if(child != thiselementwasclicked){
                        let aproved = true;
                        if (child.classList.contains('alwaysenabled')){
                            aproved = false;
                        }
                        if (aproved){
                            child.style.background = 'var(--button-disabled-background-color)';
                            child.style.color = 'var(--button-disabled-color)';
                        }
                    }else {
                        child.style.background = 'linear-gradient(90deg, #ff0077, #7700ff)';
                        child.style.color = '#fff';
                    }
                });
            }else {
                document.querySelectorAll('#controls button').forEach(child => {
                    child.style.background = 'var(--button-background-color)';
                    child.style.color = 'var(--button-text-color)';
                });
            }
        }

        let currentshapeelement = null;
        function borderRadiusinputfunction() {
            const oldvalue = currentshapeelement.borderRadius;
            const borderRadius = document.getElementById('borderRadius').value;
            currentshapeelement.borderRadius = borderRadius ? parseInt(borderRadius) : currentshapeelement.borderRadius;
            redrawCanvas();
            whiteboardfuture = [];
            document.getElementById('whiteboardforwardbutton').style.background = 'var(--button-disabled-background-color)';
            document.getElementById('whiteboardforwardbutton').style.color = 'var(--button-disabled-color)';
            document.getElementById('whiteboardbackbutton').style.background = 'var(--button-background-color)';
            document.getElementById('whiteboardbackbutton').style.color = 'var(--button-text-color)';
            let newpast = {
                element: currentshapeelement,
                action: 'borderRadius',
                value: oldvalue
            };
            whiteboardpast.push(newpast);
        }

        function elementColorinputfunction() {
            let oldcolor = currentshapeelement.color;
            const color = document.getElementById('elementColor').value;
            currentshapeelement.color = color ? color : currentshapeelement.color;
            redrawCanvas();
            whiteboardfuture = [];
            document.getElementById('whiteboardforwardbutton').style.background = 'var(--button-disabled-background-color)';
            document.getElementById('whiteboardforwardbutton').style.color = 'var(--button-disabled-color)';
            document.getElementById('whiteboardbackbutton').style.background = 'var(--button-background-color)';
            document.getElementById('whiteboardbackbutton').style.color = 'var(--button-text-color)';
            let newpast = {
                element: currentshapeelement,
                action: 'borderColor',
                value: oldcolor
            };
            whiteboardpast.push(newpast);
        }

        function bgColorinputfunction() {
            let oldbgcolor = currentshapeelement.bgColor;
            const bgColor = document.getElementById('bgColor').value;
            currentshapeelement.bgColor = bgColor ? bgColor : currentshapeelement.bgColor;
            redrawCanvas();
            whiteboardfuture = [];
            document.getElementById('whiteboardforwardbutton').style.background = 'var(--button-disabled-background-color)';
            document.getElementById('whiteboardforwardbutton').style.color = 'var(--button-disabled-color)';
            document.getElementById('whiteboardbackbutton').style.background = 'var(--button-background-color)';
            document.getElementById('whiteboardbackbutton').style.color = 'var(--button-text-color)';
            let newpast = {
                element: currentshapeelement,
                action: 'backgroundColor',
                value: oldbgcolor
            };
            whiteboardpast.push(newpast);
        }

        function widthinputfunction() {
            const oldvalue = currentshapeelement.width;
            const width = parseInt(document.getElementById('whiteboardeditorwidth').value);
            currentshapeelement.width = !isNaN(width) ? width : currentshapeelement.width;
            redrawCanvas();
            whiteboardfuture = [];
            document.getElementById('whiteboardforwardbutton').style.background = 'var(--button-disabled-background-color)';
            document.getElementById('whiteboardforwardbutton').style.color = 'var(--button-disabled-color)';
            document.getElementById('whiteboardbackbutton').style.background = 'var(--button-background-color)';
            document.getElementById('whiteboardbackbutton').style.color = 'var(--button-text-color)';
            let newpast = {
                element: currentshapeelement,
                action: 'width',
                value: oldvalue
            };
            whiteboardpast.push(newpast);
        }

        function heightinputfunction() {
            const oldvalue = currentshapeelement.height;
            const height = parseInt(document.getElementById('whiteboardeditorheight').value);
            currentshapeelement.height = !isNaN(height) ? height : currentshapeelement.height;
            redrawCanvas();
            whiteboardfuture = [];
            document.getElementById('whiteboardforwardbutton').style.background = 'var(--button-disabled-background-color)';
            document.getElementById('whiteboardforwardbutton').style.color = 'var(--button-disabled-color)';
            document.getElementById('whiteboardbackbutton').style.background = 'var(--button-background-color)';
            document.getElementById('whiteboardbackbutton').style.color = 'var(--button-text-color)';
            let newpast = {
                element: currentshapeelement,
                action: 'height',
                value: oldvalue
            };
            whiteboardpast.push(newpast);
        }

        function cloneshape() {
            /*const clonedShape = JSON.parse(JSON.stringify(shape));
            shapes.push(clonedShape);
            redrawCanvas();*/
            const newShape = new Shape(currentshapeelement.type, currentshapeelement.x + 5, currentshapeelement.y + 5, currentshapeelement.width, currentshapeelement.height, currentshapeelement.color, currentshapeelement.bgColor, currentshapeelement.borderRadius, currentshapeelement.borderWidth, currentshapeelement.text);
            shapes.push(newShape);
            redrawCanvas();
            whiteboardfuture = [];
            document.getElementById('whiteboardforwardbutton').style.background = 'var(--button-disabled-background-color)';
            document.getElementById('whiteboardforwardbutton').style.color = 'var(--button-disabled-color)';
            document.getElementById('whiteboardbackbutton').style.background = 'var(--button-background-color)';
            document.getElementById('whiteboardbackbutton').style.color = 'var(--button-text-color)';
            let newpast = {
                element: newShape,
                action: 'create',
            };
            whiteboardpast.push(newpast);
        }

        function deletecurrentshape() {
            whiteboardfuture = [];
            document.getElementById('whiteboardforwardbutton').style.background = 'var(--button-disabled-background-color)';
            document.getElementById('whiteboardforwardbutton').style.color = 'var(--button-disabled-color)';
            document.getElementById('whiteboardbackbutton').style.background = 'var(--button-background-color)';
            document.getElementById('whiteboardbackbutton').style.color = 'var(--button-text-color)';
            let newpast = {
                element: currentshapeelement,
                action: 'delete',
            }
            whiteboardpast.push(newpast);
            shapes.splice(shapes.indexOf(currentshapeelement), 1);
            redrawCanvas();
            closeEditor();
        }

        function shapesborderthicknesfunction() {
            const oldvalue = currentshapeelement.borderWidth;
            const borderthicknes = document.getElementById('shapesborderthicknes').value;
            currentshapeelement.borderWidth = !isNaN(borderthicknes) ? borderthicknes : currentshapeelement.borderWidth;
            redrawCanvas();
            whiteboardfuture = [];
            document.getElementById('whiteboardforwardbutton').style.background = 'var(--button-disabled-background-color)';
            document.getElementById('whiteboardforwardbutton').style.color = 'var(--button-disabled-color)';
            document.getElementById('whiteboardbackbutton').style.background = 'var(--button-background-color)';
            document.getElementById('whiteboardbackbutton').style.color = 'var(--button-text-color)';
            let newpast = {
                element: currentshapeelement,
                action: 'borderThickness',
                value: oldvalue
            };
            whiteboardpast.push(newpast);
        }
        
        function newshapetextfunction() {
            const oldvalue = currentshapeelement.text;
            const newtext = document.getElementById('newshapetext').value;
            currentshapeelement.text = newtext;
            redrawCanvas();
            whiteboardfuture = [];
            document.getElementById('whiteboardforwardbutton').style.background = 'var(--button-disabled-background-color)';
            document.getElementById('whiteboardforwardbutton').style.color = 'var(--button-disabled-color)';
            document.getElementById('whiteboardbackbutton').style.background = 'var(--button-background-color)';
            document.getElementById('whiteboardbackbutton').style.color = 'var(--button-text-color)';
            let newpast = {
                element: currentshapeelement,
                action: 'text',
                value: oldvalue
            };
            whiteboardpast.push(newpast);
        }

        function backtolastaction(){
            if(whiteboardpast.length > 0){
                document.getElementById('whiteboardforwardbutton').style.background = 'var(--button-background-color)';
                document.getElementById('whiteboardforwardbutton').style.color = 'var(--button-text-color)';
                let lastaction = whiteboardpast.pop();
                if(lastaction.action == 'create') {
                    const newFutureAction = {
                        element: lastaction.element,
                        action: 'delete'
                    };
                    whiteboardfuture.push(newFutureAction);
                    shapes.splice(shapes.indexOf(lastaction.element), 1);
                    closeEditor();
                    redrawCanvas();
                }else if (lastaction.action == 'delete'){
                    const newFutureAction = {
                        element: lastaction.element,
                        action: 'create'
                    };
                    whiteboardfuture.push(newFutureAction);
                    shapes.push(lastaction.element);
                    closeEditor();
                    redrawCanvas();
                }else if (lastaction.action == 'borderRadius'){
                    const newFutureAction = {
                        element: lastaction.element,
                        action: 'borderRadius',
                        value: lastaction.value
                    };
                    whiteboardfuture.push(newFutureAction);
                    lastaction.element.borderRadius = lastaction.value;
                    showEditor(lastaction.element);
                    redrawCanvas();
                }else if (lastaction.action == 'borderColor'){
                    const newFutureAction = {
                        element: lastaction.element,
                        action: 'borderColor',
                        value: lastaction.value
                    };
                    whiteboardfuture.push(newFutureAction);
                    lastaction.element.color = lastaction.value;
                    showEditor(lastaction.element);
                    redrawCanvas();
                }else if (lastaction.action == 'backgroundColor'){
                    const newFutureAction = {
                        element: lastaction.element,
                        action: 'backgroundColor',
                        value: lastaction.value
                    };
                    whiteboardfuture.push(newFutureAction);
                    lastaction.element.bgColor = lastaction.value;
                    showEditor(lastaction.element);
                    redrawCanvas();
                }else if (lastaction.action == 'width'){
                    const newFutureAction = {
                        element: lastaction.element,
                        action: 'width',
                        value: lastaction.value
                    };
                    whiteboardfuture.push(newFutureAction);
                    lastaction.element.width = lastaction.value;
                    showEditor(lastaction.element);
                    redrawCanvas();
                }else if (lastaction.action == 'height'){
                    const newFutureAction = {
                        element: lastaction.element,
                        action: 'height',
                        value: lastaction.value
                    };
                    whiteboardfuture.push(newFutureAction);
                    lastaction.element.height = lastaction.value;
                    showEditor(lastaction.element);
                    redrawCanvas();
                }else if (lastaction.action == 'text'){
                    const newFutureAction = {
                        element: lastaction.element,
                        action: 'text',
                        value: lastaction.value
                    };
                    whiteboardfuture.push(newFutureAction);
                    lastaction.element.text = lastaction.value;
                    showEditor(lastaction.element);
                    redrawCanvas();
                }else if (lastaction.action == 'borderThickness'){
                    const newFutureAction = {
                        element: lastaction.element,
                        action: 'borderThickness',
                        value: lastaction.value
                    };
                    whiteboardfuture.push(newFutureAction);
                    lastaction.element.borderWidth = lastaction.value;
                    showEditor(lastaction.element);
                    redrawCanvas();
                }else if (lastaction.action == 'move'){
                    /*const newFutureAction = {
                        element: lastaction.element,
                        action: 'move',
                        x: lastaction.x,
                        y: lastaction.y
                    };
                    whiteboardfuture.push(newFutureAction);
                    lastaction.element.x = lastaction.x;
                    lastaction.element.y = lastaction.y;
                    showEditor(lastaction.element);
                    redrawCanvas();*/
                    const newFutureAction = {
                        element: lastaction.element,
                        action: 'move',
                        x: lastaction.element.x,  // aktuelle Position speichern
                        y: lastaction.element.y
                    };
                    whiteboardfuture.push(newFutureAction);

                    // Das Element zu den vorherigen Koordinaten bewegen
                    lastaction.element.x = lastaction.x;
                    lastaction.element.y = lastaction.y;

                    showEditor(lastaction.element);
                    redrawCanvas();
                }
            }else{
                document.getElementById('whiteboardbackbutton').style.background = 'var(--button-disabled-background-color)';
                document.getElementById('whiteboardbackbutton').style.color = 'var(--button-disabled-color)';
            }
        }

        function backtofutureaction(){
            if(whiteboardfuture.length > 0) {
                let lastaction = whiteboardfuture.pop();
                if (whiteboardfuture.length <= 0){
                    document.getElementById('whiteboardforwardbutton').style.background = 'var(--button-disabled-background-color)';
                    document.getElementById('whiteboardforwardbutton').style.color = 'var(--button-disabled-color)';
                }
                if (whiteboardpast >= 0){
                    document.getElementById('whiteboardbackbutton').style.background = 'var(--button-background-color)';
                    document.getElementById('whiteboardbackbutton').style.color = 'var(--button-text-color)';
                }
                if (lastaction.action == 'create'){
                    const newPastAction = {
                        element: lastaction.element,
                        action: 'delete'
                    };
                    whiteboardpast.push(newPastAction);
                    shapes.splice(shapes.indexOf(lastaction.element), 1);
                    closeEditor();
                    redrawCanvas();
                }else if (lastaction.action == 'delete'){
                    const newPastAction = {
                        element: lastaction.element,
                        action: 'create'
                    };
                    whiteboardpast.push(newPastAction);
                    shapes.push(lastaction.element);
                    closeEditor();
                    redrawCanvas();
                }else if (lastaction.action == 'borderRadius'){
                    const newPastAction = {
                        element: lastaction.element,
                        action: 'borderRadius',
                        value: lastaction.value
                    };
                    whiteboardpast.push(newPastAction);
                    lastaction.element.borderRadius = lastaction.value;
                    showEditor(lastaction.element);
                    redrawCanvas();
                }else if (lastaction.action == 'borderColor'){
                    const newPastAction = {
                        element: lastaction.element,
                        action: 'borderColor',
                        value: lastaction.value
                    };
                    whiteboardpast.push(newPastAction);
                    lastaction.element.color = lastaction.value;
                    showEditor(lastaction.element);
                    redrawCanvas();
                }else if (lastaction.action == 'backgroundColor'){
                    const newPastAction = {
                        element: lastaction.element,
                        action: 'backgroundColor',
                        value: lastaction.value
                    };
                    whiteboardpast.push(newPastAction);
                    lastaction.element.bgColor = lastaction.value;
                    showEditor(lastaction.element);
                    redrawCanvas();
                }else if (lastaction.action == 'width'){
                    const newPastAction = {
                        element: lastaction.element,
                        action: 'width',
                        value: lastaction.value
                    };
                    whiteboardpast.push(newPastAction);
                    lastaction.element.width = lastaction.value;
                    showEditor(lastaction.element);
                    redrawCanvas();
                }else if (lastaction.action == 'height'){
                    const newPastAction = {
                        element: lastaction.element,
                        action: 'height',
                        value: lastaction.value
                    };
                    whiteboardpast.push(newPastAction);
                    lastaction.element.height = lastaction.value;
                    showEditor(lastaction.element);
                    redrawCanvas();
                }else if (lastaction.action == 'text'){
                    const newPastAction = {
                        element: lastaction.element,
                        action: 'text',
                        value: lastaction.value
                    };
                    whiteboardpast.push(newPastAction);
                    lastaction.element.text = lastaction.value;
                    showEditor(lastaction.element);
                    redrawCanvas();
                }else if (lastaction.action == 'borderThickness'){
                    const newPastAction = {
                        element: lastaction.element,
                        action: 'borderThickness',
                        value: lastaction.value
                    };
                    whiteboardpast.push(newPastAction);
                    lastaction.element.borderWidth = lastaction.value;
                    showEditor(lastaction.element);
                    redrawCanvas();
                }else if (lastaction.action == 'move'){
                    /*const newPastAction = {
                        element: lastaction.element,
                        action: 'move',
                        x: lastaction.x,
                        y: lastaction.y
                    };
                    whiteboardpast.push(newPastAction);
                    lastaction.element.x = lastaction.x;
                    lastaction.element.y = lastaction.y;
                    showEditor(lastaction.element);
                    redrawCanvas();*/
                    const newPastAction = {
                        element: lastaction.element,
                        action: 'move',
                        x: lastaction.element.x,  // aktuelle Position speichern
                        y: lastaction.element.y
                    };
                    whiteboardpast.push(newPastAction);

                    // Das Element zu den zukünftigen Koordinaten bewegen
                    lastaction.element.x = lastaction.x;
                    lastaction.element.y = lastaction.y;

                    showEditor(lastaction.element);
                    redrawCanvas();
                }
            }else {
                document.getElementById('whiteboardforwardbutton').style.background = 'var(--button-disabled-background-color)';
                document.getElementById('whiteboardforwardbutton').style.color = 'var(--button-disabled-color)';
            }
        }

        function showEditor(shape) {
            //rectangle, circle, triangle, line

            if (shape.type === 'rectangle'){
                //input display
                document.getElementById('borderRadius').style.display = 'inline-block';
                document.getElementById('borderRadiusLabel').style.display = 'inline-block';
                document.getElementById('borderRadiusbr').style.display = 'inline';
                document.getElementById('elementColor').style.display = 'inline-block';
                document.getElementById('elementColorLabel').style.display = 'inline-block';
                document.getElementById('elementColorbr').style.display = 'inline';
                document.getElementById('bgColor').style.display = 'inline-block';
                document.getElementById('bgColorLabel').style.display = 'inline-block';
                document.getElementById('bgColorbr').style.display = 'inline';
                document.getElementById('whiteboardeditorwidth').style.display = 'inline-block';
                document.getElementById('whiteboardeditorwidthLabel').style.display = 'inline-block';
                document.getElementById('whiteboardeditorwidthbr').style.display = 'inline';
                document.getElementById('whiteboardeditorheight').style.display = 'inline-block';
                document.getElementById('whiteboardeditorheightLabel').style.display = 'inline-block';
                document.getElementById('whiteboardeditorheightbr').style.display = 'inline';
                document.getElementById('shapesborderthicknes').style.display = 'inline-block';
                document.getElementById('shapesborderthicknesLabel').style.display = 'inline-block';
                document.getElementById('shapesborderthicknesbr').style.display = 'inline';
                document.getElementById('newshapetext').style.display = 'none';
                document.getElementById('newshapetextLabel').style.display = 'none';
                document.getElementById('newshapetextbr').style.display = 'none';

                document.getElementById('borderRadiusLabel').textContent = 'border radius';
                document.getElementById('elementColorLabel').textContent = 'border color';
                document.getElementById('bgColorLabel').textContent = 'background color';
                document.getElementById('whiteboardeditorwidthLabel').textContent = 'width';
                document.getElementById('whiteboardeditorheightLabel').textContent = 'height';
                document.getElementById('shapesborderthicknesLabel').textContent = 'border thickness';
                document.getElementById('newshapetextLabel').textContent = 'text';
            }else if (shape.type === 'circle'){
                document.getElementById('borderRadius').style.display = 'none';
                document.getElementById('borderRadiusLabel').style.display = 'none';
                document.getElementById('borderRadiusbr').style.display = 'none';
                document.getElementById('elementColor').style.display = 'inline-block';
                document.getElementById('elementColorLabel').style.display = 'inline-block';
                document.getElementById('elementColorbr').style.display = 'inline';
                document.getElementById('bgColor').style.display = 'inline-block';
                document.getElementById('bgColorLabel').style.display = 'inline-block';
                document.getElementById('bgColorbr').style.display = 'inline';
                document.getElementById('whiteboardeditorwidth').style.display = 'inline-block';
                document.getElementById('whiteboardeditorwidthLabel').style.display = 'inline-block';
                document.getElementById('whiteboardeditorwidthbr').style.display = 'inline';
                document.getElementById('whiteboardeditorheight').style.display = 'none';
                document.getElementById('whiteboardeditorheightLabel').style.display = 'none';
                document.getElementById('whiteboardeditorheightbr').style.display = 'none';
                document.getElementById('shapesborderthicknes').style.display = 'inline-block';
                document.getElementById('shapesborderthicknesLabel').style.display = 'inline-block';
                document.getElementById('shapesborderthicknesbr').style.display = 'inline';
                document.getElementById('newshapetext').style.display = 'none';
                document.getElementById('newshapetextLabel').style.display = 'none';
                document.getElementById('newshapetextbr').style.display = 'none';

                document.getElementById('borderRadiusLabel').textContent = 'border radius';
                document.getElementById('elementColorLabel').textContent = 'border color';
                document.getElementById('bgColorLabel').textContent = 'background color';
                document.getElementById('whiteboardeditorwidthLabel').textContent = 'width';
                document.getElementById('whiteboardeditorheightLabel').textContent = 'height';
                document.getElementById('shapesborderthicknesLabel').textContent = 'border thickness';
                document.getElementById('newshapetextLabel').textContent = 'text';
            }else if (shape.type === 'triangle'){
                document.getElementById('borderRadius').style.display = 'none';
                document.getElementById('borderRadiusLabel').style.display = 'none';
                document.getElementById('borderRadiusbr').style.display = 'none';
                document.getElementById('elementColor').style.display = 'inline-block';
                document.getElementById('elementColorLabel').style.display = 'inline-block';
                document.getElementById('elementColorbr').style.display = 'inline';
                document.getElementById('bgColor').style.display = 'inline-block';
                document.getElementById('bgColorLabel').style.display = 'inline-block';
                document.getElementById('bgColorbr').style.display = 'inline';
                document.getElementById('whiteboardeditorwidth').style.display = 'inline-block';
                document.getElementById('whiteboardeditorwidthLabel').style.display = 'inline-block';
                document.getElementById('whiteboardeditorwidthbr').style.display = 'inline';
                document.getElementById('whiteboardeditorheight').style.display = 'inline-block';
                document.getElementById('whiteboardeditorheightLabel').style.display = 'inline-block';
                document.getElementById('whiteboardeditorheightbr').style.display = 'inline';
                document.getElementById('shapesborderthicknes').style.display = 'inline-block';
                document.getElementById('shapesborderthicknesLabel').style.display = 'inline-block';
                document.getElementById('shapesborderthicknesbr').style.display = 'inline';
                document.getElementById('newshapetext').style.display = 'none';
                document.getElementById('newshapetextLabel').style.display = 'none';
                document.getElementById('newshapetextbr').style.display = 'none';

                document.getElementById('borderRadiusLabel').textContent = 'border radius';
                document.getElementById('elementColorLabel').textContent = 'border color';
                document.getElementById('bgColorLabel').textContent = 'background color';
                document.getElementById('whiteboardeditorwidthLabel').textContent = 'width';
                document.getElementById('whiteboardeditorheightLabel').textContent = 'height';
                document.getElementById('shapesborderthicknesLabel').textContent = 'border thickness';
                document.getElementById('newshapetextLabel').textContent = 'text';
            }else if (shape.type === 'line'){
                document.getElementById('borderRadius').style.display = 'none';
                document.getElementById('borderRadiusLabel').style.display = 'none';
                document.getElementById('borderRadiusbr').style.display = 'none';
                document.getElementById('elementColor').style.display = 'inline-block';
                document.getElementById('elementColorLabel').style.display = 'inline-block';
                document.getElementById('elementColorbr').style.display = 'inline';
                document.getElementById('bgColor').style.display = 'none';
                document.getElementById('bgColorLabel').style.display = 'none';
                document.getElementById('bgColorbr').style.display = 'none';
                document.getElementById('whiteboardeditorwidth').style.display = 'inline-block';
                document.getElementById('whiteboardeditorwidthLabel').style.display = 'inline-block';
                document.getElementById('whiteboardeditorwidthbr').style.display = 'inline';
                document.getElementById('whiteboardeditorheight').style.display = 'inline-block';
                document.getElementById('whiteboardeditorheightLabel').style.display = 'inline-block';
                document.getElementById('whiteboardeditorheightbr').style.display = 'inline';
                document.getElementById('shapesborderthicknes').style.display = 'inline-block';
                document.getElementById('shapesborderthicknesLabel').style.display = 'inline-block';
                document.getElementById('shapesborderthicknesbr').style.display = 'inline';
                document.getElementById('newshapetext').style.display = 'none';
                document.getElementById('newshapetextLabel').style.display = 'none';
                document.getElementById('newshapetextbr').style.display = 'none';

                document.getElementById('borderRadiusLabel').textContent = 'border radius';
                document.getElementById('elementColorLabel').textContent = 'color';
                document.getElementById('bgColorLabel').textContent = 'background color';
                document.getElementById('whiteboardeditorwidthLabel').textContent = 'width';
                document.getElementById('whiteboardeditorheightLabel').textContent = 'height';
                document.getElementById('shapesborderthicknesLabel').textContent = 'line thickness';
                document.getElementById('newshapetextLabel').textContent = 'text';
            }else if (shape.type === 'text'){
                document.getElementById('borderRadius').style.display = 'none';
                document.getElementById('borderRadiusLabel').style.display = 'none';
                document.getElementById('borderRadiusbr').style.display = 'none';
                document.getElementById('elementColor').style.display = 'inline-block';
                document.getElementById('elementColorLabel').style.display = 'inline-block';
                document.getElementById('elementColorbr').style.display = 'inline';
                document.getElementById('bgColor').style.display = 'none';
                document.getElementById('bgColorLabel').style.display = 'none';
                document.getElementById('bgColorbr').style.display = 'none';
                document.getElementById('whiteboardeditorwidth').style.display = 'none';
                document.getElementById('whiteboardeditorwidthLabel').style.display = 'none';
                document.getElementById('whiteboardeditorwidthbr').style.display = 'none';
                document.getElementById('whiteboardeditorheight').style.display = 'inline-block';
                document.getElementById('whiteboardeditorheightLabel').style.display = 'inline-block';
                document.getElementById('whiteboardeditorheightbr').style.display = 'inline';
                document.getElementById('shapesborderthicknes').style.display = 'none';
                document.getElementById('shapesborderthicknesLabel').style.display = 'none';
                document.getElementById('shapesborderthicknesbr').style.display = 'none';
                document.getElementById('newshapetext').style.display = 'inline-block';
                document.getElementById('newshapetextLabel').style.display = 'inline-block';
                document.getElementById('newshapetextbr').style.display = 'inline';

                document.getElementById('borderRadiusLabel').textContent = 'border radius';
                document.getElementById('elementColorLabel').textContent = 'text color';
                document.getElementById('bgColorLabel').textContent = 'background color';
                document.getElementById('whiteboardeditorwidthLabel').textContent = 'width';
                document.getElementById('whiteboardeditorheightLabel').textContent = 'size';
                document.getElementById('shapesborderthicknesLabel').textContent = 'border thickness';
                document.getElementById('newshapetextLabel').textContent = 'text';
            }
            currentshapeelement = shape;
            const editor = document.getElementById('whiteboardeditor');
            editor.style.display = 'block';
            editor.style.left = `${shape.x + shape.width + editor.style.width}px`;
            //editor.style.top = `${shape.y + shape.height + editor.style.height}px`;
            //editor.style.top = `${shape.y + shape.height + 100}px`;
            if (shape.y > canvas.height / 2) {
                // Wenn der Shape unterhalb der Hälfte des Canvas ist, wird der Editor über dem Shape gesetzt
                editor.style.top = `${shape.y - shape.height - 50}px`;
            } else {
                // Wenn der Shape oberhalb der Hälfte des Canvas ist, wird der Editor unter dem Shape gesetzt
                editor.style.top = `${shape.y + shape.height + 150}px`;
            }



            document.getElementById('borderRadius').value = shape.borderRadius;
            document.getElementById('elementColor').value = shape.color;
            document.getElementById('bgColor').value = shape.bgColor;
            document.getElementById('whiteboardeditorwidth').value = shape.width;
            document.getElementById('whiteboardeditorheight').value = shape.height;
            document.getElementById('shapesborderthicknes').value = shape.borderWidth;
            document.getElementById('newshapetext').value = shape.text;


            /*let applycahngesbtn = document.getElementById('applycahngesbtn');

            applycahngesbtn.addEventListener('click', () => {
                const borderRadius = document.getElementById('borderRadius').value;
                const color = document.getElementById('elementColor').value;
                const bgColor = document.getElementById('bgColor').value;
                const width = parseInt(document.getElementById('width').value);
                const height = parseInt(document.getElementById('height').value);

                // Zuweisung der neuen Werte an das ausgewählte Shape
                shape.borderRadius = borderRadius ? parseInt(borderRadius) : shape.borderRadius;
                shape.color = color ? color : shape.color;
                shape.bgColor = bgColor ? bgColor : shape.bgColor;
                shape.width = !isNaN(width) ? width : shape.width;
                shape.height = !isNaN(height) ? height : shape.height;

                // Canvas neu zeichnen, um die Änderungen zu reflektieren
                redrawCanvas();
                closeEditor();
            });*/

            /*document.getElementById('borderRadius').addEventListener('input', () => {
                const borderRadius = document.getElementById('borderRadius').value;
                shape.borderRadius = borderRadius ? parseInt(borderRadius) : shape.borderRadius;
                redrawCanvas();
            });

            document.getElementById('elementColor').addEventListener('input', () => {
                const color = document.getElementById('elementColor').value;
                shape.color = color ? color : shape.color;
                redrawCanvas();
            });

            document.getElementById('bgColor').addEventListener('input', () => {
                const bgColor = document.getElementById('bgColor').value;
                shape.bgColor = bgColor ? bgColor : shape.bgColor;
                redrawCanvas();
            });

            document.getElementById('width').addEventListener('input', () => {
                const width = parseInt(document.getElementById('width').value);
                shape.width = !isNaN(width) ? width : shape.width;
                redrawCanvas();
            });

            document.getElementById('height').addEventListener('input', () => {
                const height = parseInt(document.getElementById('height').value);
                shape.height = !isNaN(height) ? height : shape.height;
                redrawCanvas();
            });*/

            let deletecurrentshapebtn = document.getElementById('deletecurrentshapebtn');

            try {
                document.getElementById('borderRadius').removeEventListener('input', borderRadiusinputfunction);

                document.getElementById('elementColor').removeEventListener('input', elementColorinputfunction);

                document.getElementById('bgColor').removeEventListener('input', bgColorinputfunction);

                document.getElementById('whiteboardeditorwidth').removeEventListener('input', widthinputfunction);

                document.getElementById('whiteboardeditorheight').removeEventListener('input', heightinputfunction);

                document.getElementById('cloneshapebtn').removeEventListener('click', cloneshape);

                document.getElementById('shapesborderthicknes').removeEventListener('input', shapesborderthicknesfunction);

                document.getElementById('newshapetext').removeEventListener('input', newshapetextfunction);

                deletecurrentshapebtn.removeEventListener('click', deletecurrentshape);
            }catch (error) {
                let err = error;
            }
            document.getElementById('borderRadius').addEventListener('input', borderRadiusinputfunction);

            document.getElementById('elementColor').addEventListener('input', elementColorinputfunction);

            document.getElementById('bgColor').addEventListener('input', bgColorinputfunction);

            document.getElementById('whiteboardeditorwidth').addEventListener('input', widthinputfunction);

            document.getElementById('whiteboardeditorheight').addEventListener('input', heightinputfunction);

            document.getElementById('cloneshapebtn').addEventListener('click', cloneshape);

            document.getElementById('shapesborderthicknes').addEventListener('input', shapesborderthicknesfunction);

            document.getElementById('newshapetext').addEventListener('input', newshapetextfunction);

            deletecurrentshapebtn.addEventListener('click', deletecurrentshape);
        }

        function applyChanges() {
            if (selectedShape) {
                console.log('changes where applied');
                // Prüfen und Anwenden der Änderungen
                const borderRadius = document.getElementById('borderRadius').value;
                const color = document.getElementById('elementColor').value;
                const bgColor = document.getElementById('bgColor').value;
                const width = parseInt(document.getElementById('whiteboardeditorwidth').value);
                const height = parseInt(document.getElementById('whiteboardeditorheight').value);
                const borderWidth = parseInt(document.getElementById('shapesborderthicknes').value);

                // Zuweisung der neuen Werte an das ausgewählte Shape
                selectedShape.style.borderRadius = borderRadius ? parseInt(borderRadius) : selectedShape.borderRadius;
                selectedShape.style.color = color ? color : selectedShape.color;
                selectedShape.style.bgColor = bgColor ? bgColor : selectedShape.bgColor;
                selectedShape.style.width = !isNaN(width) ? width : selectedShape.width;
                selectedShape.style.height = !isNaN(height) ? height : selectedShape.height;
                selectedShape.style.borderWidth = borderWidth ? parseInt(borderthicknes) : selectedShape.borderWidth;

                // Canvas neu zeichnen, um die Änderungen zu reflektieren
                redrawCanvas();
                closeEditor();
            }
        }


        function deleteShape() {
            if (selectedShape) {
                shapes = shapes.filter(shape => shape !== selectedShape);
                selectedShape = null;
                redrawCanvas();
                closeEditor();
            }
        }

        function closeEditor() {
            document.getElementById('whiteboardeditor').style.display = 'none';
        }

        function redrawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            shapes.forEach(shape => shape.draw());
        }

        function getMousePos(canvas, evt) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: evt.clientX - rect.left,
                y: evt.clientY - rect.top
            };
        }

        function getTouchPos(canvas, evt) {
            const rect = canvas.getBoundingClientRect();
            const touch = evt.touches[0];
            return {
                x: touch.clientX - rect.left,
                y: touch.clientY - rect.top
            };
        }

        CanvasRenderingContext2D.prototype.roundRect = function (x, y, width, height, radius) {
            this.beginPath();
            this.moveTo(x + radius, y);
            this.lineTo(x + width - radius, y);
            this.quadraticCurveTo(x + width, y, x + width, y + radius);
            this.lineTo(x + width, y + height - radius);
            this.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            this.lineTo(x + radius, y + height);
            this.quadraticCurveTo(x, y + height, x, y + height - radius);
            this.lineTo(x, y + radius);
            this.quadraticCurveTo(x, y, x + radius, y);
            this.closePath();
        };
        /* not whiteboard */
        function toggleNotesTextArea(thiselement){
            let shownotesbtn = document.getElementById("shownotesbtn");

            thiselement.classList.toggle("Active");
            //shownotesbtn.style.display = thiselement.classList.contains("Active") ? "block" : "none";

            /*if (thiselement.classList.contains("Active")){
                positionDivNextToButton(document.getElementById('shownotesbtn'), document.querySelector('.notes-container'));
            }*/
            if (thiselement.classList.contains("Active")){
                shownotesbtn.style.display = 'flex';
                shownotesbtn.style.animation = "none";
                void shownotesbtn.offsetWidth; // Trigger reflow
                shownotesbtn.style.animation = "fadeIn 1s ease-out";
                positionDivNextToButton(document.getElementById('shownotesbtn'), document.querySelector('.notes-container'));
            }else if (shownotesbtn.style.display == 'flex'){
                shownotesbtn.style.animation = "none";
                void shownotesbtn.offsetWidth; // Trigger reflow
                shownotesbtn.style.animation = "fadeOut 1s ease-out";
                setTimeout(() => {
                    shownotesbtn.style.display = 'none';
                }, 1000);
            }
        }
        
        document.getElementById('shownotesbtn').addEventListener('click', () => {
            if (document.querySelector('.notes-container').style.display == 'block'){
                let siableThis = document.getElementById('shownotesbtn');
                siableThis.disabled = true;
                document.querySelector('.notes-container').style.animation = "none";
                void document.querySelector('.notes-container').offsetWidth; // Trigger reflow
                document.querySelector('.notes-container').style.animation = "fadeOut 1s ease-out";
                setTimeout(() => {
                    document.querySelector('.notes-container').style.display = 'none';
                    siableThis.disabled = false;
                    positionDivNextToButton(document.getElementById('shownotesbtn'), document.querySelector('.notes-container'));
                }, 1000);
            }else {
                positionDivNextToButton(document.getElementById('shownotesbtn'), document.querySelector('.notes-container'));
                document.querySelector('.notes-container').style.display = 'block';
                document.querySelector('.notes-container').style.animation = "none";
                void document.querySelector('.notes-container').offsetWidth; // Trigger reflow
                document.querySelector('.notes-container').style.animation = "fadeIn 1s ease-out";
            }
        });
        document.querySelector('.notes-header-ready').addEventListener('click', () => {
            //document.querySelector('.notes-container').style.display = 'none';
            let siableThis = document.getElementById('shownotesbtn');
            siableThis.disabled = true;
            document.querySelector('.notes-container').style.animation = "none";
            void document.querySelector('.notes-container').offsetWidth; // Trigger reflow
            document.querySelector('.notes-container').style.animation = "fadeOut 1s ease-out";
            setTimeout(() => {
                document.querySelector('.notes-container').style.display = 'none';
                siableThis.disabled = false;
                positionDivNextToButton(document.getElementById('shownotesbtn'), document.querySelector('.notes-container'));
            }, 1000);
        });

        function toggleWhiteboard(thiselementwasclicked){

            thiselementwasclicked.classList.toggle("Active");

            if (thiselementwasclicked.classList.contains("Active")){
                document.getElementById('whiteboardbtn').style.display = 'block';
                document.getElementById('whiteboardbtn').style.animation = "none";
                void document.getElementById('whiteboardbtn').offsetWidth; // Trigger reflow
                document.getElementById('whiteboardbtn').style.animation = "fadeIn 1s ease-out";
            }else if (document.getElementById('whiteboardbtn').style.display == 'block'){
                document.getElementById('whiteboardbtn').style.animation = "none";
                void document.getElementById('whiteboardbtn').offsetWidth; // Trigger reflow
                document.getElementById('whiteboardbtn').style.animation = "fadeOut 1s ease-out";
                setTimeout(() => {
                    document.getElementById('whiteboardbtn').style.display = 'none';
                }, 1000);
            }
        }
        function toggleClock(thiselementwasclicked) {
            thiselementwasclicked.classList.toggle("Active");

            if (thiselementwasclicked.classList.contains("Active")){
                document.getElementById('clock').style.display = 'block';
                document.getElementById('clock').style.animation = "none";
                void document.getElementById('clock').offsetWidth; // Trigger reflow
                document.getElementById('clock').style.animation = "fadeIn 1s ease-out";
            }else if (document.getElementById('clock').style.display == 'block'){
                document.getElementById('clock').style.animation = "none";
                void document.getElementById('clock').offsetWidth; // Trigger reflow
                document.getElementById('clock').style.animation = "fadeOut 1s ease-out";
                setTimeout(() => {
                    document.getElementById('clock').style.display = 'none';
                }, 1000);
            }
        }
        function toggleConsole(thiselementwasclicked){
            thiselementwasclicked.classList.toggle("Active");

            if (thiselementwasclicked.classList.contains("Active")){
                document.getElementById('consolebtn').style.display = 'flex';
                document.getElementById('consolebtn').style.animation = "none";
                void document.getElementById('consolebtn').offsetWidth; // Trigger reflow
                document.getElementById('consolebtn').style.animation = "fadeIn 1s ease-out";
            }else if (document.getElementById('consolebtn').style.display == 'flex'){
                document.getElementById('consolebtn').style.animation = "none";
                void document.getElementById('consolebtn').offsetWidth; // Trigger reflow
                document.getElementById('consolebtn').style.animation = "fadeOut 1s ease-out";
                setTimeout(() => {
                    document.getElementById('consolebtn').style.display = 'none';
                }, 1000);
            }
        }
        let timelineRunning = false;
        let timelineInterval;  // Variable für das aktuelle Intervall

        function toggleTineline(thiselementwasclicked) {
            thiselementwasclicked.classList.toggle("Active");

            if (thiselementwasclicked.classList.contains("Active")) {
                document.getElementById('timeline-container').style.display = 'block';
                document.getElementById('timeline-container').style.animation = "none";
                void document.getElementById('timeline-container').offsetWidth; // Trigger reflow
                document.getElementById('timeline-container').style.animation = "fadeIn 1s ease-out";

                //let userprompt = prompt('Enter a time in minutes');
                showPrompt('Enter a time in minutes', (userprompt) => {
                    if (userprompt != null && !isNaN(userprompt)) {
                        runTimeline(userprompt);
                    }
                });

            } else if (document.getElementById('timeline-container').style.display == 'block') {
                document.getElementById('timeline-container').style.animation = "none";
                void document.getElementById('timeline-container').offsetWidth; // Trigger reflow
                document.getElementById('timeline-container').style.animation = "fadeOut 1s ease-out";

                setTimeout(() => {
                    document.getElementById('timeline-container').style.display = 'none';
                    stopTimeline();  // Stoppe die Timeline
                }, 1000);
            }
        }

        function stopTimeline() {
            timelineRunning = false;
            clearInterval(timelineInterval);  // Stoppe das aktuelle Intervall
            document.getElementById('timeline-line').style.width = '0';  // Setze die Breite auf 0 zurück
        }

        function runTimeline(time) {
            if (timelineRunning) {
                stopTimeline();  // Stoppe die aktuelle Timeline, bevor eine neue gestartet wird
            }

            timelineRunning = true;  // Markiere Timeline als laufend
            let timeline = document.getElementById('timeline-line');
            let totalSeconds = time * 60;
            let currentSecond = 0;

            timelineInterval = setInterval(() => {
                if (!timelineRunning) {
                    clearInterval(timelineInterval);  // Stoppe, wenn Timeline nicht mehr laufen soll
                    return;
                }

                currentSecond++;
                timeline.style.width = (currentSecond / totalSeconds) * 100 + '%';

                if (currentSecond >= totalSeconds) {
                    clearInterval(timelineInterval);  // Stoppe das Intervall, wenn die Zeit abgelaufen ist
                    timelineRunning = false;
                    timeline.style.width = '0';
                    /*let userprompt = prompt(time + ' minutes have passed! Enter a new time in minutes');
                    if (userprompt != null && !isNaN(userprompt)) {
                        runTimeline(userprompt);  // Starte eine neue Timeline mit der neuen Zeit
                    }*/
                    showPrompt(time + ' minutes have passed! Enter a new time in minutes', (userprompt) => {
                        if (userprompt != null && !isNaN(userprompt)) {
                            runTimeline(userprompt);
                        }
                    });
                }
            }, 1000);  // Die Timeline wird jede Sekunde aktualisiert
        }

        // Beispiel-Event-Listener für Klick auf 'timeline-container'
        document.getElementById('timeline-container').addEventListener('click', () => {
            /*let userprompt = prompt('Enter a new time in minutes');
            if (userprompt != null && !isNaN(userprompt)) {
                runTimeline(userprompt);  // Starte oder ändere die Timeline zur Laufzeit
            }*/
            showPrompt('Enter a new time in minutes', (userprompt) => {
                if (userprompt != null && !isNaN(userprompt)) {
                    runTimeline(userprompt);
                }
            });
        });


        let notes = [];

        function formatText(command) {
            document.execCommand(command, false, null);
        }

        function toggleChecklist() {
            const editor = document.getElementById('notes-editor');
            editor.innerHTML += '<input type="checkbox"> ';
        }

        function saveNote() {
            const content = document.getElementById('notes-editor').innerHTML;
            const note = {
                id: new Date().getTime(),
                content: content,
                timestamp: new Date().toLocaleString(),
                name: 'Note'
            };
            notes.push(note);
            displayNotes();
            clearEditor();
        }

        function hideshowactions(hideshowactionelement, toggledactionoptionsid) {
            let toggledactionoptions = document.getElementById(toggledactionoptionsid);
            if (/*hideshowactionelement.textContent == '>'*/toggledactionoptions.style.display == 'flex'){
                //hideshowactionelement.textContent = 'v';
                toggledactionoptions.style.display = 'none';
            }else {
                //hideshowactionelement.textContent = '>';
                toggledactionoptions.style.display = 'flex';
                //toggledactionoptions.style.height = '60px';
            }
        }

        function hideshownotetextcontent(thiselement, togglednotetextcontentid, thisanotherelementid){
            let togglednotetextcontent = document.getElementById(togglednotetextcontentid);
            let thisanotherelement = document.getElementById(thisanotherelementid);
            if (thiselement.textContent == 'v'){
                thiselement.textContent = '>';
                togglednotetextcontent.style.display = 'none';
                thisanotherelement.style.height = '60px';
            }else {
                thiselement.textContent = 'v';
                togglednotetextcontent.style.display = 'block';
                thisanotherelement.style.height = '380px';//290
            }
        }

        function notetitleinput(thisnoteelement, thisnoteid) {
            notes.forEach(note => {
                if (note.id == thisnoteid) {
                    note.name = thisnoteelement.value;
                }
            });
        }

        function displayNotes() {
            const notesList = document.getElementById('notes-list');
            notesList.innerHTML = '';
            notes.forEach(note => {
                const noteElement = document.createElement('div');
                noteElement.classList.add('note-container');
                noteElement.id = 'noteElement' + note.id;
                noteElement.innerHTML = `
                    <header>
                        <input class="note-title" oninput="notetitleinput(this, '${note.id}')" value="${note.name}">
                        <div class="show-note-options" onclick="hideshownotetextcontent(this, 'notetextcontentcontainer${note.id}', 'noteElement${note.id}')" id="show-note-options-${note.id}">v</div>
                        <div class="show-note-options" onclick="hideshowactions(this, 'actioncontainer${note.id}')">…</div>
                        <div class="note-actions" id="actioncontainer${note.id}">
                            <button onclick="editNoteContent(${note.id})">edit</button>
                            <button onclick="viewNoteContent(${note.id})">view</button>
                            <button onclick="copyNoteContent(${note.id}, this)">copy</button>
                            <button onclick="deleteNoteContent(${note.id})">delete</button>
                        </div>
                    </header>
                    <div class="note-content" id="notetextcontentcontainer${note.id}" contenteditable="false" onclick="editNoteContent(${note.id})">
                        ${note.content}
                    </div>
                `;

                //noteElement.setAtribute("onclick", "editNoteContent(this)");
                notesList.appendChild(noteElement);
                let clickthisbtn = document.getElementById('show-note-options-' + note.id);
                clickthisbtn.click();
            });
        }

        function hideandshownotescontainer(thiselementwasgiven){
            if (thiselementwasgiven.textContent == "v"){
                thiselementwasgiven.textContent = ">";
                document.querySelector('.format-buttons').style.display = 'none';
                document.getElementById('notes-editor').style.display = 'none';
                document.querySelector('.toolbar').style.display = 'none';

                document.getElementById('notes-editor-edit-container').style.height = '60px';
            }else{
                thiselementwasgiven.textContent = "v";
                document.querySelector('.format-buttons').style.display = 'flex';
                document.getElementById('notes-editor').style.display = 'block';
                document.querySelector('.toolbar').style.display = 'flex';

                document.getElementById('notes-editor-edit-container').style.height = '380px';//290
            }
        }

        function updateNoteContent(note) {
            note.content = document.getElementById('notes-editor').innerHTML;
            document.getElementById('notetextcontentcontainer' + note.id).innerHTML = note.content;
        }

        // Variable, um den Event Listener zu speichern
        let currentNote = null;

        // Bereinigt den Editor und entfernt den Event Listener
        function clearEditor() {
            try {
                document.getElementById('notes-editor').removeEventListener('input', updateNoteContent2);
            } catch (err) {
                console.log(err);
            }
            document.getElementById('notes-editor').innerHTML = '';
        }

        // Setzt den Fokus auf eine neue Notiz und entfernt den alten Event Listener
        function createNewNote() {
            clearEditor();
            document.getElementById('notes-editor').focus();
            currentNote = null; // Setzt die aktuelle Notiz zurück
        }

        // Zeigt den Inhalt einer bestimmten Notiz an und entfernt den alten Event Listener
        function viewNoteContent(id) {
            clearEditor();
            const note = notes.find(n => n.id === id);
            if (note) {
                document.getElementById('notes-editor').innerHTML = note.content;
                currentNote = note;  // Setze die aktuelle Notiz
                document.getElementById('actioncontainer' + note.id).style.display = 'none';
            }
        }

        // Kopiert den Inhalt der Notiz in die Zwischenablage
        function copyNoteContent(id, thiselement) {
            const note = notes.find(n => n.id === id);
            if (note) {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = note.content;
                const textContent = tempDiv.textContent || tempDiv.innerText || '';

                const tempInput = document.createElement('textarea');
                tempInput.style.position = 'absolute';
                tempInput.style.left = '-9999px';
                tempInput.style.top = '-9999px';
                tempInput.value = textContent;
                document.body.appendChild(tempInput);

                tempInput.select();
                tempInput.setSelectionRange(0, 99999);

                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        thiselement.textContent = 'copied';
                        setTimeout(() => {
                            thiselement.textContent = 'copy';
                        }, 1000);
                    } else {
                        showAlert('Failed to copy text.');
                    }
                } catch (err) {
                    console.log('Failed to copy text: ', err);
                }

                document.body.removeChild(tempInput);
            }
        }

        // Löscht eine Notiz und entfernt den Event Listener
        function deleteNoteContent(id) {
            clearEditor();
            notes = notes.filter(note => note.id !== id);
            displayNotes();
        }

        // Bearbeitet den Inhalt einer Notiz und fügt den Event Listener korrekt hinzu
        function editNoteContent(id) {
            const note = notes.find(n => n.id === id);
            if (note) {
                clearEditor(); // Bereinige vorher den Editor und entferne den Event Listener

                document.getElementById('notes-editor').innerHTML = note.content;
                document.getElementById('notes-editor').focus();

                document.getElementById('actioncontainer' + note.id).style.display = 'none';

                // Setze den aktuellen Event Listener neu
                currentNote = note;
                document.getElementById('notes-editor').addEventListener('input', updateNoteContent2);
            }
        }

        // Funktion, die dem Event Listener zugeordnet wird
        function updateNoteContent2() {
            if (currentNote) {
                updateNoteContent(currentNote);
            }
        }
        function changeColor(event) {
            document.execCommand('foreColor', false, event.target.value);
        }

        function changeFont(event) {
            document.execCommand('fontName', false, event.target.value);
        }
        /* new end */

        const relement2 = document.querySelector('.notes-header');
        const move_div = document.querySelector('.notes-container');
        let isMouseDown2 = false;
        let offsetX2, offsetY2;

        relement2.addEventListener('mousedown', function(e) {
            isMouseDown2 = true;
            offsetX2 = e.clientX - relement2.offsetLeft;
            offsetY2 = e.clientY - relement2.offsetTop;
        });

        document.addEventListener('mouseup', function() {
            isMouseDown2 = false;
        });

        document.addEventListener('mousemove', function(e) {
            if (isMouseDown2) {
                relement2.style.left = `${e.clientX/* - offsetX2*/}px`;
                relement2.style.top = `${e.clientY/* - offsetY2*/}px`;
            }
        });

        relement2.addEventListener('touchstart', function(e) {
            isMouseDown2 = true;
            const touch = e.touches[0];
            offsetX2 = touch.clientX - relement2.offsetLeft;
            offsetY2 = touch.clientY - relement2.offsetTop;
        });

        document.addEventListener('touchend', function() {
            isMouseDown2 = false;
        });

        document.addEventListener('touchmove', function(e) {
            if (isMouseDown2) {
                e.preventDefault();  // Verhindert das Scrollen
                const touch = e.touches[0];
                move_div.style.left = `${touch.clientX/* - offsetY2*/}px`;
                move_div.style.top = `${touch.clientY/* - offsetX2*/}px`;
            }
        });

        /* new end */

        function positionDivNextToButton(buttonElement, divElement) {

            // Berechne die Position des Knopfes
            const buttonRect = buttonElement.getBoundingClientRect();

            // Setze die `div` direkt unten rechts neben den Knopf
            divElement.style.top = `${buttonRect.bottom - 10}px`;
            divElement.style.left = `${buttonRect.right + 15}px`;
        }
        let isshowingeditwindow = false;
        function hideandshoweditPagewindow() {
            if (!isshowingeditwindow){
                positionDivNextToButton(document.getElementById("editPagebtn"), document.getElementById("edit-sidebar-container"));
                document.getElementById("edit-sidebar-container").style.display = "flex";
                document.getElementById("edit-sidebar-container").style.animation = "none";
                void document.getElementById("edit-sidebar-container").offsetWidth; // Trigger reflow
                document.getElementById("edit-sidebar-container").style.animation = "fadeIn 1s ease-out";
                isshowingeditwindow = true;
            }else {
                let siableThis = document.getElementById("editPagebtn");
                siableThis.disabled = true;
                document.getElementById("edit-sidebar-container").style.animation = "none";
                void document.getElementById("edit-sidebar-container").offsetWidth; // Trigger reflow
                document.getElementById("edit-sidebar-container").style.animation = "fadeOut 1s ease-out";
                isshowingeditwindow = false;
                setTimeout(() => {
                    document.getElementById("edit-sidebar-container").style.display = "none";
                    siableThis.disabled = false;
                }, 1000);
            }
        }

        document.getElementById("editPagebtn").addEventListener('click', () => {
            hideandshoweditPagewindow();
        });

        positionDivNextToButton(document.getElementById("editPagebtn"), document.getElementById("edit-sidebar-container"));

        
        let homebtnv = document.getElementById("homebtn");
        homebtnv.addEventListener("click", function() {
            window.location.href = "index.html";
        });
        let previewIsFullScreen = false;
        function previewFullScreen() {
            let preview = document.getElementById("preview");
            let previewContainer = document.getElementById("preview-container");
            let previewCross = document.getElementById("preview-cross");
            if (previewIsFullScreen){
                preview.style.height = "100%";
                preview.style.width = "calc(100vw - 70px);";
                preview.style.position = "relative";
                /*previewContainer.style.left = "0";
                previewContainer.style.top = "0";*/
                preview.style.zIndex = "1";
                preview.style.borderRadius = "5px";
                previewCross.style.display = "none";
                previewIsFullScreen = false;
            }else {
                preview.style.height = "100%";
                preview.style.width = "100%";
                preview.style.position = "fixed";
                preview.style.left = "0";
                preview.style.top = "0";
                preview.style.zIndex = "999";
                preview.style.borderRadius = "0";
                /*previewContainer.style.left = "0";
                previewContainer.style.top = "0";*/
                previewCross.style.display = "block";
                previewIsFullScreen = true;
            }
        }
        const iframeE = document.getElementById('preview');
        const loadElement = document.getElementById('load');

        function startLoading() {
            loadElement.style.display = 'flex';
        }

        function finishLoading() {
            loadElement.style.display = 'none';
        }

        let UploadFile = document.getElementById('UploadFile');
        let fileInputv = document.getElementById('fileInput');
        let allimages = {};
        UploadFile.addEventListener('click', () => {
            fileInputv.click();
        });
        let currentFile = "index.html";
        let filenames = [];

        let values = {

        };
        let mode = {

        };

        let cursorPositions = {
            
        };

        let indexfile = "index.html";

        let filenamei = document.getElementById('filename');

        filenamei.addEventListener('input', () => {
            indexfile = filenamei.value;
            if (filenamei == ''){
                indexfile = "index.html";
            }
        });
        filenamei.addEventListener('change', () => {
            indexfile = filenamei.value;
            if (filenamei == ''){
                indexfile = "index.html";
            }
        });


        const editor = CodeMirror.fromTextArea(document.getElementById('editor'), {
            mode: mode[currentFile],
            lineNumbers: true,
            theme: "mytheme",
            indentUnit: 4,
            tabSize: 4,
            indentWithTabs: true,
            lineWrapping: false,
            matchBrackets: true,
            styleActiveLine: true,
            autoCloseTags: true,
            matchTags: {bothTags: true},
            foldGutter: true,
            viewportMargin: 30,
            gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
            scrollbarStyle: "native",
            readOnly: false,
            cursorHeight: 0.5,
            extraKeys: {
                "Ctrl-Space": "autocomplete",
                "Tab": "autocomplete",
                "Ctrl-D": "duplicateLine",
                "Ctrl-/": "toggleComment"
            },
            highlightSelectionMatches: {showToken: /\w/, annotateScrollbar: true},
            lint: true,
            lintOnChange: true,
            showCursorWhenSelecting: true,
            search: {
                showMatchesOnScrollbar: true,
                highlightMatches: true
            },
            dragDrop: true,
            historyEventDelay: 1000,
            undoDepth: 1000,
            autoCloseBrackets: true,
            autoCloseBrackets: {
                pairs: "()[]{}''\"\"``",
                triples: "",
                explode: "[]{}()",
                override: ["]", "}"],
                closeAfter: "*",
                closeOnEnter: true,
                closeBrackets: true,
                ignoreParentheses: false,
                ignoreBrackets: false,
                ignoreTags: false,
                ignoreComments: false,
                ignoreStrings: false,
                ignorePattern: "",
            },
            hintOptions: {
                hint: CodeMirror.hint.auto,
                completeSingle: false,
                closeOnUnfocus: true,
            },
            autoCloseTags: {
              whenClosing: true,
              indentTags: ['div', 'li', 'section', 'button', 'script', 'style', 'html'],
            }
        });

        function goToLine() {
            var line = parseInt(document.getElementById("lineNumber").value, 10);
            if (!isNaN(line)) {
              editor.scrollIntoView({line: line - 1, ch: 0}, 200);
              editor.setCursor({line: line - 1, ch: 0});
              editor.focus();
            }
        }

        function showGhostText(cm, suggestion) {
            const cursor = cm.getCursor();
            const token = cm.getTokenAt(cursor);
            const line = cm.getLine(cursor.line);
            const textBeforeCursor = line.slice(token.start, cursor.ch);
            const remainingText = suggestion.slice(textBeforeCursor.length);

            const ghostStart = { line: cursor.line, ch: token.start + textBeforeCursor.length };
            const ghostEnd = { line: cursor.line, ch: ghostStart.ch + remainingText.length };

            const ghostElement = document.createElement('span');
            ghostElement.className = 'CodeMirror-ghost';
            ghostElement.textContent = remainingText;

            cm.markText(ghostStart, ghostEnd, {
                replacedWith: ghostElement,
                clearWhenEmpty: false
            });
        }

        function clearGhostText(cm) {
            const marks = cm.getAllMarks();
            for (const mark of marks) {
                if (mark.replacedWith && mark.replacedWith.className === 'CodeMirror-ghost') {
                    mark.clear();
                }
            }
        }

        function applyGhostText(cm) {
            const cursor = cm.getCursor();
            const marks = cm.findMarksAt(cursor);

            for (const mark of marks) {
                if (mark.replacedWith && mark.replacedWith.className === 'CodeMirror-ghost') {
                    const range = mark.find();
                    const textToInsert = mark.replacedWith.textContent;
                    cm.replaceRange(textToInsert, range.from, range.to, "+input");
                    mark.clear();
                    break;
                }
            }
        }

        function getHintFunction(cm) {
            const mode = cm.getMode().name;
            if (mode === 'htmlmixed') {
                return CodeMirror.hint.html;
            } else if (mode === 'css') {
                return CodeMirror.hint.css;
            } else if (mode === 'javascript') {
                return CodeMirror.hint.javascript;
            }
            return CodeMirror.hint.anyword;
        }

        editor.on("inputRead", function(cm, change) {
            if (!currentFile.includes('.html') && !currentFile.includes('.js') && !currentFile.includes('.css')){
                return;
            }
            if (change.text.join("") === " ") {
                clearGhostText(cm);
                return;
            }

            if (change.text.join("").length > 0) {
                clearGhostText(cm);

                const cursor = cm.getCursor();
                const token = cm.getTokenAt(cursor);
                const word = token.string;

                const hintFunction = getHintFunction(cm);
                CodeMirror.showHint(cm, hintFunction, {
                    completeSingle: false
                });

                const hint = hintFunction(cm);
                if (hint && hint.list.length > 0) {
                    showGhostText(cm, hint.list[0]);
                }
            }
            if (/*change.origin !== 'setValue' && */cursorPositions[currentFile]) {
                const cursorps = cm.getCursor();
                cursorPositions[currentFile].line = cursorps.line;
                cursorPositions[currentFile].column = cursorps.ch;
            }
        });

        editor.addKeyMap({
            'Tab': function(cm) {
                applyGhostText(cm);
            },
            'Space': function(cm) {
                clearGhostText(cm);
                cm.replaceSelection(" ");
            }
        });

        CodeMirror.defineOption("lint", false, function(cm, val, old) {
            if (old && old !== CodeMirror.Init) {
                cm.off("renderLine", old);
                cm.off("change", old);
            }
            if (val) {
                cm.on("renderLine", function(cm, line, elem) {
                    if (cm.somethingSelected()) return;
                    const error = cm.getLintingErrors(line);
                    if (error) {
                        elem.className += " lint-error";
                    }
                });
                cm.on("change", function() {
                    cm.performLinting();
                });
            }
        });

        function checkscreensizing() {
            let preview = document.getElementById("preview-container");
            let lineNumInputContainer = document.getElementById("line-number-input-container");
            if (isonpreview && !iswhiteboard){
                editor.setSize("100%", "100%");
                preview.style.display = "block";
                document.getElementById("currentFileImg-container").style.display = "none";
                lineNumInputContainer.style.display = "none";
                document.getElementById("whiteboard-container").style.display = "none";
                iswhiteboard = false;
            }else if (!allimages[currentFile] && !isonpreview && !iswhiteboard){
                editor.setSize("100%", "100%");
                preview.style.display = "none";
                document.getElementById("currentFileImg-container").style.display = "none";
                lineNumInputContainer.style.display = "flex";
                document.getElementById("whiteboard-container").style.display = "none";
                iswhiteboard = false;
            }else if (allimages[currentFile] && !iswhiteboard){
                editor.setSize("100%", "100%");
                preview.style.display = "none";
                document.getElementById("currentFileImg-container").style.display = "flex";
                document.getElementById("currentFileImg").src = allimages[currentFile];
                lineNumInputContainer.style.display = "none";
                document.getElementById("whiteboard-container").style.display = "none";
                iswhiteboard = false;
            }else if (iswhiteboard){
                editor.setSize("100%", "100%");
                preview.style.display = "none";
                document.getElementById("currentFileImg-container").style.display = "none";
                lineNumInputContainer.style.display = "none";
                document.getElementById("whiteboard-container").style.display = "flex";
            }
        }

        checkscreensizing();

        let viewelement = document.querySelector(`.view`);

        viewelement.addEventListener('click', () => {
            document.querySelector('.index.highlight')?.classList.remove('highlight');
            viewelement.classList.add(`highlight`);
            isonpreview = true;
            iswhiteboard = false;
            checkscreensizing();
        });
        viewelement.addEventListener('dragstart', (event) => {
            event.dataTransfer.setData('text/plain', 'view'); // Speichere den Tab-Namen
            viewelement.style.opacity = '0.5';  // Setze die Sichtbarkeit auf 50%
        });

        // Drag-End Event: Stelle die Opazität wieder her
        viewelement.addEventListener('dragend', () => {
            viewelement.style.opacity = '1';  // Stelle die Sichtbarkeit wieder auf 100%
        });

        // Erlaube das Drop-Event
        viewelement.addEventListener('dragover', (event) => {
            event.preventDefault(); // Erlaube das Droppen
        });

        // Highlight, wenn der Tab während des Ziehens betreten wird
        viewelement.addEventListener('dragenter', (event) => {
            event.preventDefault();
            //viewelement.classList.add('highlight');
        });

        // Highlight entfernen, wenn der Tab verlassen wird
        /*viewelement.addEventListener('dragleave', () => {
            viewelement.classList.remove('highlight');
        });*/

        // Drop-Event: Platziere das gezogene Element nach dem Ziel-Element
        viewelement.addEventListener('drop', (event) => {
            event.preventDefault();
            //viewelement.classList.remove('highlight');

            const draggedTabName = event.dataTransfer.getData('text/plain');  // Gezogenes Tab abrufen

            // Finde das gezogene Tab
            const draggedElement = Array.from(files.children).find(div => div.textContent === draggedTabName);

            // Überprüfe, ob das gezogene Tab nicht auf sich selbst gedropped wird
            if (draggedElement && draggedElement !== viewelement) {
                // Verschiebe das gezogene Tab direkt nach dem Tab, auf dem es gedropped wurde
                files.insertBefore(draggedElement, viewelement.nextSibling);
            }
        });

        document.getElementById('whiteboardbtn').addEventListener('dragstart', (event) => {
            event.dataTransfer.setData('text/plain', 'whiteboard'); // Speichere den Tab-Namen
            document.getElementById('whiteboardbtn').style.opacity = '0.5';  // Setze die Sichtbarkeit auf 50%
        });

        // Drag-End Event: Stelle die Opazität wieder her
        document.getElementById('whiteboardbtn').addEventListener('dragend', () => {
            document.getElementById('whiteboardbtn').style.opacity = '1';  // Stelle die Sichtbarkeit wieder auf 100%
        });

        // Erlaube das Drop-Event
        document.getElementById('whiteboardbtn').addEventListener('dragover', (event) => {
            event.preventDefault(); // Erlaube das Droppen
        });

        // Highlight, wenn der Tab während des Ziehens betreten wird
        document.getElementById('whiteboardbtn').addEventListener('dragenter', (event) => {
            event.preventDefault();
            //viewelement.classList.add('highlight');
        });

        // Highlight entfernen, wenn der Tab verlassen wird
        document.getElementById('whiteboardbtn').addEventListener('drop', (event) => {
            event.preventDefault();
            //viewelement.classList.remove('highlight');

            const draggedTabName = event.dataTransfer.getData('text/plain');  // Gezogenes Tab abrufen

            // Finde das gezogene Tab
            const draggedElement = Array.from(files.children).find(div => div.textContent === draggedTabName);

            // Überprüfe, ob das gezogene Tab nicht auf sich selbst gedropped wird
            if (draggedElement && draggedElement !== document.getElementById('whiteboardbtn')) {
                // Verschiebe das gezogene Tab direkt nach dem Tab, auf dem es gedropped wurde
                files.insertBefore(draggedElement, document.getElementById('whiteboardbtn').nextSibling);
            }
        });
        function goToCursorLine(line, column) {
            if (!isNaN(line) && line > 0) {
                editor.scrollIntoView({line: line, ch: column}, 200);
                editor.setCursor({line: line, ch: column});
                editor.focus();
            } else if (line === 0) {
                editor.scrollIntoView({line: 0, ch: column}, 200);
                editor.setCursor({line: 0, ch: column});
                editor.focus();
            }
        }


        document.addEventListener('DOMContentLoaded', () => {
            const sidebar = document.getElementById('sidebar');
            const addFileButton = document.getElementById('addFile');
            const toggleSidebarButton = document.getElementById('toggleSidebar');
            const fileList = document.getElementById('fileList');
            const hidesidebar = document.getElementById('hidesidebar');
            const files = document.getElementById('files');
            const fileInput = document.getElementById('fileInput');

            fileInput.addEventListener('change', (event) => {
                const files = event.target.files;

                Array.from(files).forEach(file => {
                    const fileName = file.name;

                    if (file.type === 'text/plain') {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            addNewFile(fileName);
                            values[fileName] = e.target.result;
                        };
                        reader.readAsText(file);
                    } else if (file.type === 'text/html') {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            addNewFile(fileName);
                            values[fileName] = e.target.result;
                        };
                        reader.readAsText(file);
                    } else if (file.type === 'text/css') {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            addNewFile(fileName);
                            values[fileName] = e.target.result;
                        };
                        reader.readAsText(file);
                    } else if (file.type === 'text/js') {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            addNewFile(fileName);
                            values[fileName] = e.target.result;
                        };
                        reader.readAsText(file);
                    } else if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            allimages[fileName] = e.target.result;
                            let newimageelement = createImgElement(fileName);
                            fileList.appendChild(newimageelement);
                        };
                        reader.readAsDataURL(file);
                    } else {
                        console.error('Unsupported file type:', file.type);
                    }
                });
            });

            function createFileElement(namee) {
                let name = namee;
                if (filenames.includes(name)) {
                    return;
                }
                let oldname = name;
                filenames.push(name);

                cursorPositions[name] = {
                    line: 0,
                    column: 0
                };

                if (name.includes(".html")) {
                    mode[name] = "htmlmixed";
                    values[name] = `
<!DOCTYPE html>
<html lang="de">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>AIlury Programming studio</title>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <script src="script.js"><\/script>
    </body>
</html>`;
                } else if (name.includes(".js")) {
                    mode[name] = "javascript";
                    values[name] = `
console.log("Hello World!");`;
                } else if (name.includes(".css")) {
                    mode[name] = "css";
                    values[name] = `
body {
    font-family: Arial, sans-serif;
    line-height: 1.6;
    margin: 0;
    padding: 0;
    background-color: #f4f4f4;
}`;
                } else {
                    mode[name] = "text";
                    values[name] = "";
                }

                const fileElement = document.createElement('div');
                fileElement.className = 'file';

                let logoText = "✗";
                if (name.includes(".html")){
                    logoText = "Html";
                }else if (name.includes(".js")){
                    logoText = "Js";
                }else if (name.includes(".css")){
                    logoText = "Css";
                }
                const FileElementIcon = document.createElement('span');
                FileElementIcon.className = "file-icon";
                FileElementIcon.textContent = logoText;
                FileElementIcon.style.fontWeight = "1500";
                FileElementIcon.style.fontSize = "1em";
                // text gradient
                if (logoText == "✗"){
                    FileElementIcon.style.background = "linear-gradient(to right, #ff0000, #ff00ff)";
                }else {
                    FileElementIcon.style.background = "linear-gradient(to right, #ff0077, #7700ff)";
                }
                FileElementIcon.style.backgroundClip = "text";
                FileElementIcon.style.color = "transparent";

                const fileNameInput = document.createElement('input');
                fileNameInput.type = 'text';
                fileNameInput.value = name;
                fileNameInput.disabled = true;
                fileElement.appendChild(FileElementIcon);
                fileElement.appendChild(fileNameInput);

                const options = document.createElement('div');
                options.className = 'options';

                const menuButton = document.createElement('span');
                menuButton.className = 'menu-btn';
                menuButton.textContent = '…';
                menuButton.addEventListener('click', (event) => {
                    const dropdown = event.currentTarget.nextElementSibling;
                    dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
                });

                const dropdown = document.createElement('div');
                dropdown.className = 'dropdown';
                
                const newfileforfiles = document.createElement('div');
                newfileforfiles.className = 'index';
                newfileforfiles.setAttribute('draggable', 'true');
                newfileforfiles.textContent = name;  // Name des Tabs

                // Click-Event für das Tab
                newfileforfiles.addEventListener('click', () => {
                    startLoading();
                    currentFile = name;
                    editor.setOption('mode', mode[name]);
                    editor.refresh();
                    files.querySelector('.index.highlight')?.classList.remove('highlight');
                    newfileforfiles.classList.add("highlight");
                    isonpreview = false;
                    iswhiteboard = false;
                    checkscreensizing();
                    editor.setValue(values[name]);
                    if (cursorPositions[currentFile] && typeof cursorPositions[currentFile].line !== 'undefined') {
                        goToCursorLine(cursorPositions[currentFile].line, cursorPositions[currentFile].column);
                    }
                    finishLoading();
                });

                // Füge das Tab hinzu
                files.appendChild(newfileforfiles);

                // Drag-Start Event: Speichere den Tab-Index
                newfileforfiles.addEventListener('dragstart', (event) => {
                    event.dataTransfer.setData('text/plain', name); // Speichere den Tab-Namen
                    newfileforfiles.style.opacity = '0.5';  // Setze die Sichtbarkeit auf 50%
                });

                // Drag-End Event: Stelle die Opazität wieder her
                newfileforfiles.addEventListener('dragend', () => {
                    newfileforfiles.style.opacity = '1';  // Stelle die Sichtbarkeit wieder auf 100%
                });

                // Erlaube das Drop-Event
                newfileforfiles.addEventListener('dragover', (event) => {
                    event.preventDefault(); // Erlaube das Droppen
                });

                // Highlight, wenn der Tab während des Ziehens betreten wird
                newfileforfiles.addEventListener('dragenter', (event) => {
                    event.preventDefault();
                    //newfileforfiles.classList.add('highlight');
                });

                // Highlight entfernen, wenn der Tab verlassen wird
                /*newfileforfiles.addEventListener('dragleave', () => {
                    newfileforfiles.classList.remove('highlight');
                });*/

                // Drop-Event: Platziere das gezogene Element nach dem Ziel-Element
                newfileforfiles.addEventListener('drop', (event) => {
                    event.preventDefault();
                    //newfileforfiles.classList.remove('highlight');

                    const draggedTabName = event.dataTransfer.getData('text/plain');  // Gezogenes Tab abrufen

                    // Finde das gezogene Tab
                    const draggedElement = Array.from(files.children).find(div => div.textContent === draggedTabName);

                    // Überprüfe, ob das gezogene Tab nicht auf sich selbst gedropped wird
                    if (draggedElement && draggedElement !== newfileforfiles) {
                        // Verschiebe das gezogene Tab direkt nach dem Tab, auf dem es gedropped wurde
                        files.insertBefore(draggedElement, newfileforfiles.nextSibling);
                    }
                });

                
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.addEventListener('click', () => {
                    const index = filenames.indexOf(name);
                    if (index !== -1) filenames.splice(index, 1);
                    delete mode[name];
                    delete values[name];
                    fileElement.remove();
                    newfileforfiles.remove();
                    menuButton.click();
                    document.querySelector('.view').click();
                });

                const renameButton = document.createElement('button');
                renameButton.textContent = 'Rename';
                renameButton.addEventListener('click', () => {
                    menuButton.click();
                    if (fileNameInput.disabled) {
                        fileNameInput.disabled = false;
                        fileNameInput.focus();
                        fileNameInput.classList.add('editing');

                        fileNameInput.addEventListener('keydown', (event) => {
                            if (event.key === 'Enter') {
                                let newName = fileNameInput.value.trim();
                                if (newName && newName !== name && !filenames.includes(newName)) {
                                    const index = filenames.indexOf(name);
                                    if (index !== -1) filenames[index] = newName;

                                    mode[newName] = mode[name];
                                    values[newName] = values[name];
                                    cursorPositions[newName] = cursorPositions[name];

                                    name = newName;
                                    fileNameInput.value = name;
                                    newfileforfiles.textContent = name;
                                    oldname = name;
                                    let logoText2 = "✗";
                                    if (name.includes(".html")){
                                        logoText2 = "Html";
                                    }else if (name.includes(".js")){
                                        logoText2 = "Js";
                                    }else if (name.includes(".css")){
                                        logoText2 = "Css";
                                    }
                                    if (logoText2 == "✗"){
                                        FileElementIcon.style.background = "linear-gradient(to right, #ff0000, #af002d)";
                                        FileElementIcon.style.backgroundClip = "text";
                                        FileElementIcon.style.color = "transparent";
                                    }else {
                                        FileElementIcon.style.background = "linear-gradient(to right, #ff0077, #7700ff)";
                                        FileElementIcon.style.backgroundClip = "text";
                                        FileElementIcon.style.color = "transparent";
                                    }
                                    FileElementIcon.textContent = logoText2;
                                    fileNameInput.disabled = true;
                                    fileNameInput.classList.remove('editing');
                                } else {
                                    fileNameInput.value = oldname;
                                    newfileforfiles.textContent = oldname;
                                    fileNameInput.disabled = true;
                                    fileNameInput.classList.remove('editing');
                                }
                            }
                        });

                        fileNameInput.addEventListener('blur', () => {
                            let newName = fileNameInput.value.trim();
                            if (newName && newName !== name && !filenames.includes(newName)) {
                                const index = filenames.indexOf(name);
                                if (index !== -1) filenames[index] = newName;

                                mode[newName] = mode[name];
                                values[newName] = values[name];
                                cursorPositions[newName] = cursorPositions[name];

                                name = newName;
                                fileNameInput.value = name;
                                newfileforfiles.textContent = name;
                                oldname = name;
                                let logoText2 = "✗";
                                if (name.includes(".html")){
                                    logoText2 = "Html";
                                }else if (name.includes(".js")){
                                    logoText2 = "Js";
                                }else if (name.includes(".css")){
                                    logoText2 = "Css";
                                }
                                if (logoText2 == "✗"){
                                    FileElementIcon.style.background = "linear-gradient(to right, #ff0000, #af002d)";
                                    FileElementIcon.style.backgroundClip = "text";
                                    FileElementIcon.style.color = "transparent";
                                }else {
                                    FileElementIcon.style.background = "linear-gradient(to right, #ff0077, #7700ff)";
                                    FileElementIcon.style.backgroundClip = "text";
                                    FileElementIcon.style.color = "transparent";
                                }
                                FileElementIcon.textContent = logoText2;
                                fileNameInput.disabled = true;
                                fileNameInput.classList.remove('editing');
                            }else {
                                fileNameInput.disabled = true;
                                fileNameInput.classList.remove('editing');
                            }
                        });
                    }
                });

                const downloadButton = document.createElement('button');
                downloadButton.textContent = 'Download';
                function downloadFile(filename, content) {
                    const blob = new Blob([content], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }

                downloadButton.addEventListener('click', () => {
                    menuButton.click();
                    downloadFile(name, values[name]);
                });

                const copyButton = document.createElement('button');
                copyButton.textContent = 'Copy';
                copyButton.addEventListener('click', () => {
                    menuButton.click();
                    const textarea = document.createElement('textarea');
                    textarea.value = values[name];
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                });

                let copyFilePathButton = document.createElement('button');
                copyFilePathButton.textContent = 'path';
                copyFilePathButton.addEventListener('click', () => {
                    menuButton.click();
                    const textarea = document.createElement('textarea');
                    textarea.value = name;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                });

                dropdown.appendChild(deleteButton);
                dropdown.appendChild(renameButton);
                dropdown.appendChild(downloadButton);
                dropdown.appendChild(copyButton);
                dropdown.appendChild(copyFilePathButton);
                options.appendChild(menuButton);
                options.appendChild(dropdown);
                fileElement.appendChild(options);

                return fileElement;
            }

            let imgType = {

            };
            function createImgElement(namevv) {
                let name = namevv;
                let oldname = name;
                if (!name) {
                    return;
                }
                if (filenames.includes(name)) {
                    return;
                }

                if (name.includes(".png") || name.includes(".jpg") || name.includes(".jpeg") || name.includes(".gif")) {
                    let imagetype = name.split('.');
                    let topImageType = imagetype[imagetype.length - 1];
                    imgType[name] = topImageType;
                    if (filenames.includes(name)) {
                        return;
                    }
                    filenames.push(name);

                    const fileElement = document.createElement('div');
                    fileElement.className = 'file';

                    const FileElementIcon = document.createElement('span');
                    FileElementIcon.className = "file-icon";
                    FileElementIcon.textContent = "□";
                    FileElementIcon.style.fontWeight = "1500";
                    FileElementIcon.style.fontSize = "1em";
                    FileElementIcon.style.background = "linear-gradient(to right, #ff0077, #7700ff)";
                    FileElementIcon.style.backgroundClip = "text";
                    FileElementIcon.style.color = "transparent";


                    const fileNameInput = document.createElement('input');
                    fileNameInput.type = 'text';
                    fileNameInput.value = name;
                    fileNameInput.disabled = true;
                    fileElement.appendChild(FileElementIcon);
                    fileElement.appendChild(fileNameInput);

                    const options = document.createElement('div');
                    options.className = 'options';

                    const menuButton = document.createElement('span');
                    menuButton.className = 'menu-btn';
                    menuButton.textContent = '…';
                    menuButton.addEventListener('click', (event) => {
                        const dropdown = event.currentTarget.nextElementSibling;
                        dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
                    });

                    const dropdown = document.createElement('div');
                    dropdown.className = 'dropdown';

                    const newfileforfiles = document.createElement('div');
                    newfileforfiles.className = 'index';
                    newfileforfiles.setAttribute('draggable', 'true');
                    newfileforfiles.textContent = name;

                    newfileforfiles.addEventListener('click', () => {
                        editor.refresh();
                        currentFile = name;
                        files.querySelector('.index.highlight')?.classList.remove('highlight');
                        newfileforfiles.classList.add("highlight");
                        isonpreview = false;
                        iswhiteboard = false;
                        checkscreensizing();
                    });
                    
                    files.appendChild(newfileforfiles);
                    
                    newfileforfiles.addEventListener('dragstart', (event) => {
                        event.dataTransfer.setData('text/plain', name); // Speichere den Tab-Namen
                        newfileforfiles.style.opacity = '0.5';  // Setze die Sichtbarkeit auf 50%
                    });
                    
                    // Drag-End Event: Stelle die Opazität wieder her
                    newfileforfiles.addEventListener('dragend', () => {
                        newfileforfiles.style.opacity = '1';  // Stelle die Sichtbarkeit wieder auf 100%
                    });
                    
                    // Erlaube das Drop-Event
                    newfileforfiles.addEventListener('dragover', (event) => {
                        event.preventDefault(); // Erlaube das Droppen
                    });
                    
                    // Highlight, wenn der Tab während des Ziehens betreten wird
                    newfileforfiles.addEventListener('dragenter', (event) => {
                        event.preventDefault();
                        //newfileforfiles.classList.add('highlight');
                    });
                    
                    // Highlight entfernen, wenn der Tab verlassen wird
                    /*newfileforfiles.addEventListener('dragleave', () => {
                        newfileforfiles.classList.remove('highlight');
                    });*/
                    
                    // Drop-Event: Platziere das gezogene Element nach dem Ziel-Element
                    newfileforfiles.addEventListener('drop', (event) => {
                        event.preventDefault();
                        //newfileforfiles.classList.remove('highlight');

                        const draggedTabName = event.dataTransfer.getData('text/plain');  // Gezogenes Tab abrufen

                        // Finde das gezogene Tab
                        const draggedElement = Array.from(files.children).find(div => div.textContent === draggedTabName);

                        // Überprüfe, ob das gezogene Tab nicht auf sich selbst gedropped wird
                        if (draggedElement && draggedElement !== newfileforfiles) {
                            // Verschiebe das gezogene Tab direkt nach dem Tab, auf dem es gedropped wurde
                            //files.insertBefore(draggedElement, newfileforfiles.nextSibling);
                            if (newfileforfiles.nextElementSibling) {
                                files.insertBefore(draggedElement, newfileforfiles.nextElementSibling);
                            } else {
                                files.appendChild(draggedElement);  // Falls es das letzte Element ist
                            }
                        }
                    });
                    
                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Delete';
                    deleteButton.addEventListener('click', () => {
                        const index = filenames.indexOf(name);
                        if (index !== -1) filenames.splice(index, 1);
                        delete mode[name];
                        delete values[name];
                        fileElement.remove();
                        newfileforfiles.remove();
                        menuButton.click();
                        document.querySelector('.view').click();
                    });

                    const renameButton = document.createElement('button');
                    renameButton.textContent = 'Rename';
                    renameButton.addEventListener('click', () => {
                        menuButton.click();
                        if (fileNameInput.disabled) {
                            fileNameInput.disabled = false;
                            fileNameInput.focus();
                            fileNameInput.classList.add('editing');

                            fileNameInput.addEventListener('keydown', (event) => {
                                if (event.key === 'Enter') {
                                    let newName = fileNameInput.value.trim();
                                    if (newName && newName !== name && !filenames.includes(newName)) {
                                        const index = filenames.indexOf(name);
                                        if (index !== -1) filenames[index] = newName;

                                        allimages[newName] = allimages[name];

                                        name = newName;
                                        fileNameInput.value = name;
                                        newfileforfiles.textContent = name;
                                        oldname = name;
                                        fileNameInput.disabled = true;
                                        fileNameInput.classList.remove('editing');
                                    } else {
                                        fileNameInput.value = oldname;
                                        newfileforfiles.textContent = name;
                                        fileNameInput.disabled = true;
                                        fileNameInput.classList.remove('editing');
                                    }
                                }
                            });

                            fileNameInput.addEventListener('blur', () => {
                                let newName = fileNameInput.value.trim();
                                if (newName && newName !== name && !filenames.includes(newName)) {
                                    const index = filenames.indexOf(name);
                                    if (index !== -1) filenames[index] = newName;

                                    allimages[newName] = allimages[name];

                                    name = newName;
                                    fileNameInput.value = name;
                                    newfileforfiles.textContent = name;
                                    oldname = name;
                                    fileNameInput.disabled = true;
                                    fileNameInput.classList.remove('editing');
                                }else {
                                    fileNameInput.value = oldname;
                                    newfileforfiles.textContent = name;
                                    fileNameInput.disabled = true;
                                    fileNameInput.classList.remove('editing');
                                }
                            });
                        }
                    });


                    const downloadButton = document.createElement('button');
                    downloadButton.textContent = 'Download';
                    downloadButton.addEventListener('click', () => {
                        menuButton.click();
                        const blob = new Blob([allimages[name]], { type: `image/${imgType[name]}` });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = name;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    });

                    const copyFilePathButton = document.createElement('button');
                    copyFilePathButton.textContent = 'path';
                    copyFilePathButton.addEventListener('click', () => {
                        menuButton.click();
                        const textarea = document.createElement('textarea');
                        textarea.value = name;
                        document.body.appendChild(textarea);
                        textarea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textarea);
                    });

                    dropdown.appendChild(deleteButton);
                    dropdown.appendChild(renameButton);
                    dropdown.appendChild(downloadButton);
                    dropdown.appendChild(copyFilePathButton);
                    options.appendChild(menuButton);
                    options.appendChild(dropdown);
                    fileElement.appendChild(options);

                    return fileElement;
                }
            }


            function addNewFile(name = '') {
                if (filenames.includes(name)) {
                    showAlert('this file path already exists.');
                    return;
                }
                const newFile = createFileElement(name || `in${filenames.length + 2}dex.html`);
                fileList.appendChild(newFile);
            }

            addFileButton.addEventListener('click', () => {
                function promptForFileName() {
                    showPrompt('file path:', (newfilename) => {
                        // Überprüfen, ob der Prompt abgelehnt wurde
                        if (newfilename === null) {
                            let namebegining = ["index", "project", "app", "page", "site", "file"];
                            let pathsend = [".html", ".js", ".css"];
                            let randomStart = Math.floor(Math.random() * namebegining.length);
                            let randomEnd = Math.floor(Math.random() * pathsend.length);
                            newfilename = namebegining[randomStart] + (filenames.length + 1) + pathsend[randomEnd];
                        }

                        // Überprüfen, ob der Dateiname bereits existiert
                        if (filenames.includes(newfilename) || newfilename == null) {
                            promptForFileName(); // Wenn der Dateiname nicht gültig ist, erneut fragen
                        } else {
                            addNewFile(newfilename); // Datei hinzufügen, wenn der Name gültig ist
                        }
                    });
                }

                promptForFileName(); // Erste Anfrage für den Dateinamen starten
            });



            toggleSidebarButton.addEventListener('click', () => {
                sidebar.classList.toggle('show');
            });

            let consolebtn = document.getElementById("consolebtn");

            function consolebtnonclick() {
                if (document.querySelector('.resizable-draggable').style.display == 'block'){
                    let siableThis = consolebtn;
                    siableThis.disabled = true;
                    document.querySelector('.resizable-draggable').style.animation = "none";
                    void document.querySelector('.resizable-draggable').offsetWidth; // Trigger reflow
                    document.querySelector('.resizable-draggable').style.animation = "fadeOut 1s ease-out";
                    setTimeout(() => {
                        document.querySelector('.resizable-draggable').style.display = 'none';
                        siableThis.disabled = false;
                        //document.querySelector('.resizable-draggable').style.right = "20vw";
                        //document.querySelector('.resizable-draggable').style.top = "10vh";
                        positionDivNextToButton(consolebtn, document.querySelector('.resizable-draggable'));
                    }, 1000);
                    //document.querySelector(".resizable-draggable").classList.remove("show");
                }else {
                    //document.querySelector('.resizable-draggable').style.right = "20vw";
                    //document.querySelector('.resizable-draggable').style.top = "10vh";
                    positionDivNextToButton(consolebtn, document.querySelector('.resizable-draggable'));
                    
                    document.querySelector('.resizable-draggable').style.display = 'block';
                    document.querySelector('.resizable-draggable').style.animation = "none";
                    void document.querySelector('.resizable-draggable').offsetWidth; // Trigger reflow
                    document.querySelector('.resizable-draggable').style.animation = "fadeIn 1s ease-out";
                    //document.querySelector(".resizable-draggable").classList.add("show");
                }
                //document.querySelector(".resizable-draggable").classList.toggle('show');
                document.getElementById('alert-icon').style.display = 'none';
            }
            consolebtn.addEventListener("click", () => {
                consolebtnonclick();
            });

            hidesidebar.addEventListener('click', () => {
                sidebar.classList.toggle('show');
            });

            let close_button = document.querySelector(".close-button");
            close_button.addEventListener("click", () => {
                consolebtnonclick();
            });
            addNewFile('index.html');
            addNewFile('style.css');
            addNewFile('script.js');
        });

        /*function replacePaths(htmlString, allimages) {
            function findVariableValue(code, variableName, seen = new Set()) {
                if (seen.has(variableName)) return variableName;
                seen.add(variableName);

                const regex = new RegExp(`(?:var|let|const)?\\s+${variableName}\\s*=\\s*(['"\`]?)([^'"\`]+)\\1`, 'g');
                const match = regex.exec(code);

                if (match) {
                    const value = match[2];

                    const variableRegex = /^[a-zA-Z_$][a-zA-Z_$0-9]*$/;
                    if (variableRegex.test(value)) {
                        return findVariableValue(code, value, seen);
                    }

                    const templateLiteralRegex = /\$\{([^}]+)\}/g;
                    if (templateLiteralRegex.test(value)) {
                        return value.replace(templateLiteralRegex, (match, p1) => {
                            const innerValue = findVariableValue(code, p1, seen);
                            return innerValue !== undefined ? innerValue : p1;
                        });
                    }

                    return value;
                }

                return variableName;
            }


            htmlString = htmlString.replaceAll(/<img\s+[^>]*src=["']([^"']+)["'][^>]*>/g, (match, src) => {
                if (allimages[src]) {
                    return match.replaceAll(src, allimages[src]);
                }
                return match;
            });

            htmlString = htmlString.replaceAll(/<style[^>]*>([\s\S]*?)<\/style>/g, (match, cssText) => {
                Object.keys(allimages).forEach(key => {
                    const regex = new RegExp(`url\\(['"]?${key}['"]?\\)`, 'g');
                    cssText = cssText.replaceAll(regex, `url('${allimages[key]}')`);
                });
                return `<style>${cssText}</style>`;
            });

            htmlString = htmlString.replaceAll(/style=["']([^"']+)["']/g, (match, styleText) => {
                Object.keys(allimages).forEach(key => {
                    const regex = new RegExp(`url\\(['"]?${key}['"]?\\)`, 'g');
                    styleText = styleText.replaceAll(regex, `url(\'${allimages[key]}\')`);
                });
                return `style="${styleText}"`;
            });
            htmlString = htmlString.replace(/<script(?![^>]*\ssrc)[\s\S]*?>([\s\S]*?)<\/script>/g, (match, code) => {
                Object.keys(allimages).forEach(key => {

                    const regexTemplateLiteral = new RegExp("\\${([^}]+)}", "g");

                    code = code.replaceAll(regexTemplateLiteral, (match, p1) => {
                        const p1split = p1.split("+");
                        let p1result = "";
                        p1split.forEach(p1key => {
                            let p1_ = p1key.trim();
                            const p1resultv = findVariableValue(code, p1_); 
                            p1result += p1resultv;
                        });
                        return p1result;
                    });

                    const urlRegex = new RegExp(`url\\(['"]?${key}['"]?\\)`, 'g');

                    let alsocheckedCode = findVariableValue(code, key);
                    code = code.replaceAll(urlRegex, (match, p1) => {
                        return `url('${allimages[alsocheckedCode]}')`;
                    });

                    const regex = new RegExp(`(['"\`]?${key}['"\`]?)`, 'g');
                    let checkedCode = findVariableValue(code, key);
                    code = code.replaceAll(regex, `(\'${allimages[checkedCode]}\')`);
                    const regex8 = new RegExp(`\\s*=\\s*['"\`]?${key}['"\`]?`, 'g');
                    let checkedCode8 = findVariableValue(code, key);
                    code = code.replaceAll(regex8, (match) => {
                        if (allimages[checkedCode8]) {
                            return ` = '${allimages[checkedCode8]}'`;
                        }
                        return match;
                    });
                    const regex4 = new RegExp(`.src\\s*=\\s*['"\`]?${key}['"\`]?`, 'g');
                    let checkedCode4 = findVariableValue(code, key);
                    code = code.replaceAll(regex4, (match) => {
                        return `.src = '${allimages[checkedCode5]}'`;
                    });
                    const regex5 = new RegExp(`Img\\s*=\\s*['"\`]?${key}['"\`]?`, 'g');

                    let checkedCode5 = findVariableValue(code, key);

                    code = code.replaceAll(regex5, (match) => {
                        return `Img = '${allimages[checkedCode5]}'`;
                    });
                });
                const textureRegex = /new\s*THREE\.TextureLoader\(\)\.load\(['"`]?([^'"`]+)['"`]?\)/g;
                code = code.replace(textureRegex, (match, p1) => {
                    let checkedCode = findVariableValue(code, p1);
                    return allimages[checkedCode] ? `new THREE.TextureLoader().load('${allimages[checkedCode]}')` : match;
                });
                return `<script>\n${code}\n<\/script>`;
            });

            return htmlString;
        }*/
        async function replacePaths(htmlString, allimages) {
            // Hilfsfunktion: Findet den Wert einer Variable im Code
            function findVariableValue(code, variableName, seen = new Set()) {
                if (seen.has(variableName)) return variableName; // Zirkuläre Referenz vermeiden
                seen.add(variableName);

                // Suche nach der Variablenzuweisung im Code (var, let, const)
                const regex = new RegExp(`(?:var|let|const)?\\s+${variableName}\\s*=\\s*(['"\`]?)([^'"\`]+)\\1`, 'g');
                const match = regex.exec(code);

                if (match) {
                    const value = match[2];

                    // Überprüfe, ob der Wert eine weitere Variable ist
                    const variableRegex = /^[a-zA-Z_$][a-zA-Z_$0-9]*$/;
                    if (variableRegex.test(value)) {
                        return findVariableValue(code, value, seen);
                    }

                    // Verarbeite Template Literals (z.B. `${variable}`)
                    const templateLiteralRegex = /\$\{([^}]+)\}/g;
                    if (templateLiteralRegex.test(value)) {
                        return value.replace(templateLiteralRegex, (match, p1) => {
                            const innerValue = findVariableValue(code, p1, seen);
                            return innerValue !== undefined ? innerValue : p1;
                        });
                    }

                    return value; // Gib den Wert der Variablen zurück
                }

                return variableName; // Wenn keine Zuweisung gefunden wird, gib den Variablennamen zurück
            }

            // 1. Ersetze Pfade in <img> Tags
            htmlString = htmlString.replaceAll(/<img\s+[^>]*src=["']([^"']+)["'][^>]*>/g, (match, src) => {
                if (allimages[src]) {
                    return match.replace(src, allimages[src]);
                }
                return match;
            });

            // 2. Ersetze Pfade in <style> Blöcken
            htmlString = htmlString.replaceAll(/<style[^>]*>([\s\S]*?)<\/style>/g, (match, cssText) => {
                Object.keys(allimages).forEach(key => {
                    const regex = new RegExp(`url\\(['"]?${key}['"]?\\)`, 'g');
                    cssText = cssText.replace(regex, `url('${allimages[key]}')`);
                });
                return `<style>${cssText}</style>`;
            });

            // 3. Ersetze Pfade in style Attributen
            htmlString = htmlString.replaceAll(/style=["']([^"']+)["']/g, (match, styleText) => {
                Object.keys(allimages).forEach(key => {
                    const regex = new RegExp(`url\\(['"]?${key}['"]?\\)`, 'g');
                    styleText = styleText.replace(regex, `url('${allimages[key]}')`);
                });
                return `style="${styleText}"`;
            });

            // 4. Ersetze Pfade in <script> Blöcken, die kein src-Attribut haben
            htmlString = htmlString.replaceAll(/<script(?![^>]*\ssrc)[\s\S]*?>([\s\S]*?)<\/script>/g, (match, code) => {
                Object.keys(allimages).forEach(key => {
                    // Verarbeite Template Literals in JavaScript (z.B. `${variable}`)
                    const regexTemplateLiteral = new RegExp("\\${([^}]+)}", "g");
                    code = code.replace(regexTemplateLiteral, (match, p1) => {
                        const p1split = p1.split("+");
                        let result = "";
                        p1split.forEach(part => {
                            const variableName = part.trim();
                            const variableValue = findVariableValue(code, variableName);
                            result += variableValue;
                        });
                        return result;
                    });

                    // Ersetze Pfade in `url()` Ausdrücken (z.B. `url('image.png')`)
                    const urlRegex = new RegExp(`url\\(['"]?${key}['"]?\\)`, 'g');
                    code = code.replace(urlRegex, `url('${allimages[key]}')`);

                    // Ersetze direkte String-Vergleiche
                    const stringRegex = new RegExp(`(['"\`]?${key}['"\`]?)`, 'g');
                    code = code.replace(stringRegex, `'${allimages[key]}'`);

                    // Ersetze Zuweisungen von `src` Attributen
                    const srcRegex = new RegExp(`.src\\s*=\\s*['"\`]?${key}['"\`]?`, 'g');
                    code = code.replace(srcRegex, `.src = '${allimages[key]}'`);
                });

                // Spezielle Behandlung für THREE.js TextureLoader
                const textureRegex = /new\s*THREE\.TextureLoader\(\)\.load\(['"`]?([^'"`]+)['"`]?\)/g;
                code = code.replace(textureRegex, (match, p1) => {
                    const imagePath = findVariableValue(code, p1);
                    return allimages[imagePath] ? `new THREE.TextureLoader().load('${allimages[imagePath]}')` : match;
                });

                return `<script>\n${code}\n<\/script>`;
            });

            return htmlString;
        }



        const preview = document.getElementById('preview');
        const runButton = document.getElementById('runbtn');
        let running = false;

        let filename = document.getElementById('filename');
        function externalConsoleLog(message) {
            let consoleOutput = document.getElementById('console');
            consoleOutput.innerText += message + '\n';
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function replaceLinksAndScripts(htmlString, values) {
            htmlString = htmlString.replace(/<link\s+[^>]*rel=["']stylesheet["'][^>]*href=["']([^"']+)["'][^>]*>/g, (match, href) => {
                if (values[href]) {
                    return `<style>\n${values[href]}\n</style>`;
                }
                return match;
            });

            htmlString = htmlString.replaceAll(/<script\s+[^>]*src=["']([^"']+)["'][^>]*><\/script>/g, (match, src) => {
                if (values[src]) {
                    return `<script>\n${values[src]}\n<\/script>`;
                }
                return match;
            });

            return htmlString;
        }


        function processHtmlMixedCode(htmlString) {
            htmlString = htmlString.replace(/<script(?![^>]*\ssrc)[\s\S]*?>([\s\S]*?)<\/script>/g, (match, scriptContent) => {
                const wrappedScriptContent = `
        try {
            ${scriptContent.trim()}
        } catch (error) {
            window.parent.postMessage({
                type: 'error',
                message: \`\${error.name}: \${error.message}\n\`
            }, '*');
        }
                `;
                return `<script>${wrappedScriptContent}<\/script>`;
            });

            return htmlString;
        }


        function processHtmlForWindowLocation(htmlMixedCode) {
            let editedHtmlMixedCode = htmlMixedCode.replace(/window\.location(?:\.href)?\s*=\s*(?:`([^`]*)`|(['"`])([^'"`;\s]+)\2|([^;\s]+))\s*;/g, (match, templateLiteral, quote, quotedValue, unquotedValue) => {
                const location = templateLiteral ? `\`${templateLiteral}\`` : (quote ? `${quote}${quotedValue}${quote}` : unquotedValue);

                return `window.parent.postMessage({ type: 'get window location', message: ${location} }, '*');`;
            });

            const monitorScript = `
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                document.body.addEventListener('click', function(event) {
                    if (event.target.tagName === 'A' && event.target.href) {
                        event.preventDefault();
                        window.parent.postMessage({
                            type: 'get window location',
                            message: event.target.href
                        }, '*');
                    }
                });
            });
            document.querySelectorAll('a[href]').forEach(function(link) {
                link.addEventListener('click', function(event) {
                    event.preventDefault();

                    // Nachricht an das parent-Window senden
                    window.parent.postMessage({
                        type: 'get window location',
                        message: this.href
                    }, '*');
                });
            });
        <\/script>\n
            `;
            const bodyTagPosition = editedHtmlMixedCode.lastIndexOf('</body>');
            if (bodyTagPosition !== -1) {
                editedHtmlMixedCode = editedHtmlMixedCode.slice(0, bodyTagPosition) + monitorScript + editedHtmlMixedCode.slice(bodyTagPosition);
            } else {
                editedHtmlMixedCode += monitorScript;
            }

            return `${editedHtmlMixedCode}`;
        }

        function refreshFunction() {
            running = false;
            runbuttononclick();
        }

        /*function runbuttononclick() {
            isonpreview = true;
            iswhiteboard = false;
            document.querySelector('.index.highlight')?.classList.remove('highlight');
            viewelement.classList.add(`highlight`);
            isonpreview = true;
            checkscreensizing();
            values[currentFile] = editor.getValue();
            let code = values[indexfile];
            let consoleDiv = document.getElementById('console');
            if (code && indexfile.includes('.html')){
                code = replaceLinksAndScripts(code, values);
                code = replacePaths(code, allimages);
                code = processHtmlMixedCode(code);
                code = processHtmlForWindowLocation(code);
                if (document.querySelector('.edit-sidebar-container-button.Active')){
                    code = replaceConsoleMethodsInCode(code);
                }
                running = !running;
                runButton.textContent = running ? "||" : "▶";
                if (running){
                    document.getElementById('filename').value = `${indexfile}`;
                    startLoading();
                    preview.srcdoc = code;
                    finishLoading();
                }else {
                    startLoading();
                    consoleDiv.innerHTML = '';
                    document.getElementById('alert-icon').style.display = 'none';
                    preview.srcdoc = "";
                    finishLoading();
                }
            }else {
                startLoading();
                consoleDiv.innerHTML = '';
                document.getElementById('alert-icon').style.display = 'none';
                preview.srcdoc = "";
                running = !running;
                runButton.textContent = "▶";
                finishLoading();
            }
        }*/
        async function runbuttononclick() {
            try {
                isonpreview = true;
                iswhiteboard = false;

                // Entferne Highlight von der aktuellen Datei
                document.querySelector('.index.highlight')?.classList.remove('highlight');
                viewelement.classList.add('highlight');

                // Speichere den aktuellen Inhalt des Editors
                values[currentFile] = editor.getValue();
                let code = values[indexfile];
                let consoleDiv = document.getElementById('console');
                let alertIcon = document.getElementById('alert-icon');

                /*running = !running;
                runButton.textContent = running ? "||" : "▶";

                if (indexfile == "AIlury" && running) {
                    document.querySelector('.view').click();
                    preview.src = "https://ailury.com/AIlury.html";
                    return;
                }*/

                if (code && indexfile.includes('.html')) {

                    running = !running;
                    runButton.textContent = running ? "||" : "▶";
                    // Wenn gestartet, HTML in die Vorschau laden
                    if (running) {
                        document.querySelector('.view').click();
                        code = await replaceLinksAndScripts(code, values);
                        if (allimages != ""){
                            code = await replacePaths(code, allimages);
                        }
                        if (document.getElementById('edit-console-button').classList.contains('Active')) {
                            code = await processHtmlMixedCode(code);
                        }
                        code = await processHtmlForWindowLocation(code);

                        // Falls die Sidebar aktiv ist, Konsolenmethoden im Code ersetzen
                        if (document.getElementById('edit-console-button').classList.contains('Active')) {
                            code = await replaceConsoleMethodsInCode(code);
                        }
                        document.getElementById('filename').value = `${indexfile}`;
                        startLoading();
                        preview.srcdoc = code;
                        finishLoading();
                    } else {
                        // Wenn gestoppt, die Vorschau leeren und Konsole zurücksetzen
                        startLoading();
                        consoleDiv.innerHTML = '';
                        alertIcon.style.display = 'none';
                        preview.srcdoc = "";
                        finishLoading();
                    }

                } else if (indexfile != "AIlury"){
                    // Wenn kein HTML-Code gefunden wurde, Vorschau leeren und zurücksetzen
                    startLoading();
                    consoleDiv.innerHTML = '';
                    alertIcon.style.display = 'none';
                    preview.srcdoc = "";
                    running = false;
                    runButton.textContent = "▶";
                    finishLoading();
                }
            } catch (error) {
                let thiserrorwascatched = error;
            }
        }


        runButton.addEventListener('click', () => {
            runbuttononclick();
        });

        editor.on('keyup', function(editor, event) {
            values[currentFile] = editor.getValue();
        });

        function replaceConsoleMethodsInCode(code) {
            const methods = ['log', 'error', 'warn', 'info', 'debug', 'table', 'trace', 'clear', 'group', 'groupEnd', 'assert', 'count', 'countReset', 'markTimeline', 'profile', 'profileEnd', 'time', 'timeEnd', 'timeStamp', 'dir', 'dirxml', 'groupCollapsed'];

            const consolePattern = new RegExp(`console\\.(${methods.join('|')})\\s*\\(([^)]*)\\)`, 'g');

            const replacedCode = code.replace(consolePattern, (match, method, args) => {
                if (args !== ''){
                    return `console.${method}(${args});\nwindow.parent.postMessage({ type: '${method}', message: ${args} }, '*');`;
                }else {
                    return `console.${method}(${args});\nwindow.parent.postMessage({ type: '${method}', message: "placeholder" }, '*');`;
                }

            });

            return replacedCode;
        }

        editor.on('text-change', () => {
            values[currentFile] = editor.getValue();
            const doc = editor.getDoc();
            const cursor = doc.getCursor();
            const line = cursor.line;
            const ch = cursor.ch;

            const closingBracket = completionsbrackets[event.key];

            if (closingBracket) {
                doc.replaceRange(closingBracket, { line: line, ch: ch });

                doc.setCursor({ line: line, ch: ch });
            }

            if (cursorPositions[currentFile]){
                cursorPositions[currentFile].line = line;
                cursorPositions[currentFile].column = ch;
            }

        });
        editor.on('inputRead', () => {
            values[currentFile] = editor.getValue();
        });

        const consoleDiv = document.getElementById('console');
        const consoleMethods = [
            'log', 'error', 'warn', 'info', 'debug', 'trace', 'dir', 'dirxml', 'group', 'groupEnd', 
            'time', 'timeEnd', 'assert', 'count', 'markTimeline', 'profile', 'profileEnd', 
            'clearTimeline', 'countReset', 'memory', 'memoryProfile', 'memoryUsage', 
            'timeStamp', 'timeStampEnd', 'timeOrigin', 'timeOriginEnd', 'timeOriginStart', 'clear'
        ];

        function captureConsoleWithEvents(consoleDivId) {
            var originalConsole = {};

            ['log', 'error', 'warn', 'info', 'debug', 'table', 'trace', 'clear', 'group', 'groupEnd', 'assert', 'count', 'countReset', 'markTimeline', 'profile', 'profileEnd', 'time', 'timeEnd', 'timeStamp', 'dir', 'dirxml', 'groupCollapsed'].forEach(method => {
                if (typeof console[method] === 'function') {
                    originalConsole[method] = console[method];
                }
            });

            function appendToConsoleDiv(type, message) {
                var newElement = document.createElement('div');
                newElement.className = type;
                if (type == 'warn'){
                    newElement.textContent = '⚠ ' + message;
                }else if (type == 'error'){
                    newElement.textContent = '⊗ ' + message;
                    document.getElementById('alert-icon').style.display = 'inline';
                }else if (type == 'info'){
                    newElement.textContent = 'ⓘ ' + message;
                }else if (type == 'table'){
                    newElement.textContent = '□ ' + message;
                }else if (type == 'debug'){
                    newElement.textContent = '◆ ' + message;
                }else if (type == 'trace'){
                    newElement.textContent = '☉ ' + message;
                }else if (type == 'table'){
                    newElement.textContent = '□ ' + message;
                }else if (type == 'time'){
                    newElement.textContent = '○ ' + message;
                }else if (type == 'timeEnd'){
                    newElement.textContent = '○ ' + message;
                }else if (type == 'log'){
                    newElement.textContent = '✎ ' + message;
                }else {
                    newElement.textContent = message;
                }
                consoleDiv.appendChild(newElement);
            }

            function dispatchConsoleEvent(type, message) {
                var event = new CustomEvent('consoleActivity', {
                    detail: { type: type, message: message }
                });
                window.dispatchEvent(event);
            }

            if (originalConsole.log) {
                console.log = function(...args) {
                    appendToConsoleDiv('log', args.join(' '));
                    dispatchConsoleEvent('log', args.join(' '));
                    originalConsole.log.apply(console, args);
                };
            }

            if (originalConsole.error) {
                console.error = function(...args) {
                    appendToConsoleDiv('error', args.join(' '));
                    dispatchConsoleEvent('error', args.join(' '));
                    originalConsole.error.apply(console, args);
                };
            }

            if (originalConsole.warn) {
                console.warn = function(...args) {
                    appendToConsoleDiv('warn', args.join(' '));
                    dispatchConsoleEvent('warn', args.join(' '));
                    originalConsole.warn.apply(console, args);
                };
            }

            if (originalConsole.info) {
                console.info = function(...args) {
                    appendToConsoleDiv('info', args.join(' '));
                    dispatchConsoleEvent('info', args.join(' '));
                    originalConsole.info.apply(console, args);
                };
            }

            if (originalConsole.debug) {
                console.debug = function(...args) {
                    appendToConsoleDiv('debug', args.join(' '));
                    dispatchConsoleEvent('debug', args.join(' '));
                    originalConsole.debug.apply(console, args);
                };
            }

            if (originalConsole.table) {
                console.table = function(...args) {
                    appendToConsoleDiv('table', JSON.stringify(args, null, 2));
                    dispatchConsoleEvent('table', JSON.stringify(args, null, 2));
                    originalConsole.table.apply(console, args);
                };
            }

            if (originalConsole.trace) {
                console.trace = function(...args) {
                    appendToConsoleDiv('trace', new Error().stack);
                    dispatchConsoleEvent('trace', new Error().stack);
                    originalConsole.trace.apply(console, args);
                };
            }

            if (originalConsole.clear) {
                console.clear = function() {
                    consoleDiv.innerHTML = '';  // Leert das consoleDiv
                    dispatchConsoleEvent('clear', 'Console cleared');
                    originalConsole.clear.apply(console);
                };
            }

            if (originalConsole.group) {
                console.group = function(...args) {
                    appendToConsoleDiv('group', args.join(' '));
                    dispatchConsoleEvent('group', args.join(' '));
                    originalConsole.group.apply(console, args);
                };
            }

            if (originalConsole.groupEnd) {
                console.groupEnd = function(...args) {
                    appendToConsoleDiv('groupEnd', 'Group End');
                    dispatchConsoleEvent('groupEnd', 'Group End');
                    originalConsole.groupEnd.apply(console, args);
                };
            }

            if (originalConsole.assert) {
                console.assert = function(...args) {
                    appendToConsoleDiv('assert', args.join(' '));
                    dispatchConsoleEvent('assert', args.join(' '));
                    originalConsole.assert.apply(console, args);
                };
            }

            if (originalConsole.count) {
                console.count = function(...args) {
                    appendToConsoleDiv('count', args.join(' '));
                    dispatchConsoleEvent('count', args.join(' '));
                    originalConsole.count.apply(console, args);
                };
            }

            if (originalConsole.countReset) {
                console.countReset = function(...args) {
                    appendToConsoleDiv('countReset', args.join(' '));
                    dispatchConsoleEvent('countReset', args.join(' '));
                    originalConsole.countReset.apply(console, args);
                };
            }

            if (originalConsole.markTimeline) {
                console.markTimeline = function(...args) {
                    appendToConsoleDiv('markTimeline', args.join(' '));
                    dispatchConsoleEvent('markTimeline', args.join(' '));
                    originalConsole.markTimeline.apply(console, args);
                };
            }

            if (originalConsole.profile) {
                console.profile = function(...args) {
                    appendToConsoleDiv('profile', args.join(' '));
                    dispatchConsoleEvent('profile', args.join(' '));
                    originalConsole.profile.apply(console, args);
                };
            }

            if (originalConsole.profileEnd) {
                console.profileEnd = function(...args) {
                    appendToConsoleDiv('profileEnd', args.join(' '));
                    dispatchConsoleEvent('profileEnd', args.join(' '));
                    originalConsole.profileEnd.apply(console, args);
                };
            }

            if (originalConsole.time) {
                console.time = function(...args) {
                    appendToConsoleDiv('time', args.join(' '));
                    dispatchConsoleEvent('time', args.join(' '));
                    originalConsole.time.apply(console, args);
                };
            }

            if (originalConsole.timeEnd) {
                console.timeEnd = function(...args) {
                    appendToConsoleDiv('timeEnd', args.join(' '));
                    dispatchConsoleEvent('timeEnd', args.join(' '));
                    originalConsole.timeEnd.apply(console, args);
                };
            }

            if (originalConsole.timeStamp) {
                console.timeStamp = function(...args) {
                    appendToConsoleDiv('timeStamp', args.join(' '));
                    dispatchConsoleEvent('timeStamp', args.join(' '));
                    originalConsole.timeStamp.apply(console, args);
                };
            }

            if (originalConsole.timeStampEnd) {
                console.timeStampEnd = function(...args) {
                    appendToConsoleDiv('timeStampEnd', args.join(' '));
                    dispatchConsoleEvent('timeStampEnd', args.join(' '));
                    originalConsole.timeStampEnd.apply(console, args);
                };
            }

            if (originalConsole.timeOrigin) {
                console.timeOrigin = function(...args) {
                    appendToConsoleDiv('timeOrigin', args.join(' '));
                    dispatchConsoleEvent('timeOrigin', args.join(' '));
                    originalConsole.timeOrigin.apply(console, args);
                };
            }

            if (originalConsole.timeOriginEnd) {
                console.timeOriginEnd = function(...args) {
                    appendToConsoleDiv('timeOriginEnd', args.join(' '));
                    dispatchConsoleEvent('timeOriginEnd', args.join(' '));
                    originalConsole.timeOriginEnd.apply(console, args);
                };
            }

            if (originalConsole.timeOriginStart) {
                console.timeOriginStart = function(...args) {
                    appendToConsoleDiv('timeOriginStart', args.join(' '));
                    dispatchConsoleEvent('timeOriginStart', args.join(' '));
                    originalConsole.timeOriginStart.apply(console, args);
                };
            }

            if (originalConsole.dir) {
                console.dir = function(...args) {
                    appendToConsoleDiv('dir', JSON.stringify(args, null, 2));
                    dispatchConsoleEvent('dir', JSON.stringify(args, null, 2));
                    originalConsole.dir.apply(console, args);
                };
            }

            if (originalConsole.dirxml) {
                console.dirxml = function(...args) {
                    appendToConsoleDiv('dirxml', JSON.stringify(args, null, 2));
                    dispatchConsoleEvent('dirxml', JSON.stringify(args, null, 2));
                    originalConsole.dirxml.apply(console, args);
                };
            }

            if (originalConsole.groupCollapsed) {
                console.groupCollapsed = function(...args) {
                    appendToConsoleDiv('groupCollapsed', args.join(' '));
                    dispatchConsoleEvent('groupCollapsed', args.join(' '));
                    originalConsole.groupCollapsed.apply(console, args);
                };
            }
        }

        captureConsoleWithEvents('consoleDiv');
        window.addEventListener('message', (event) => {
            const { type, message } = event.data;

            if (type && message !== undefined && type != 'get window location') {
                console[type](message);
            }else if (type && message !== undefined && type == 'get window location'){
                let presrcdoc = document.getElementById('preview');
                let cmessagee = message;
                let cmessageel = message.split('/');
                cmessagee = cmessageel[cmessageel.length - 1];

                if (values[`${cmessagee}`] == undefined){
                    presrcdoc.srcdoc = '';
                }else if (values[`${cmessagee}`] != undefined){
                    indexfile = `${cmessagee}`;
                    runbuttononclick();
                    runbuttononclick();
                }
            }
        });


        function addToConsole2(message, type) {
            const newMessage = document.createElement('div');
            newMessage.className = type;
            newMessage.textContent = message;
            consoleDiv.appendChild(newMessage);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        const relement = document.getElementById('resizable-element');
        const move_button = document.querySelector('.move-button');
        let isMouseDown = false;
        let offsetX, offsetY;

        move_button.addEventListener('mousedown', function(e) {
            isMouseDown = true;
            offsetX = e.clientX - relement.offsetLeft;
            offsetY = e.clientY - relement.offsetTop;
        });

        document.addEventListener('mouseup', function() {
            isMouseDown = false;
        });

        document.addEventListener('mousemove', function(e) {
            if (isMouseDown) {
                relement.style.left = `${e.clientX - offsetX}px`;
                relement.style.top = `${e.clientY - offsetY}px`;
            }
        });

        move_button.addEventListener('touchstart', function(e) {
            isMouseDown = true;
            const touch = e.touches[0];
            offsetX = touch.clientX - relement.offsetLeft;
            offsetY = touch.clientY - relement.offsetTop;
        });

        document.addEventListener('touchend', function() {
            isMouseDown = false;
        });

        document.addEventListener('touchmove', function(e) {
            if (isMouseDown) {
                const touch = e.touches[0];
                relement.style.left = `${touch.clientX - offsetX}px`;
                relement.style.top = `${touch.clientY - offsetY}px`;
            }
        });

        function closeElement() {
            document.querySelector(".resizable-draggable").classList.toggle('show');
        }

        let warningelement = document.getElementById('warning');
        let errorelement = document.getElementById('error');
        let infoelement = document.getElementById('info');
        let debugelement = document.getElementById('debug');
        let loggelement = document.getElementById('log');
        let allelement = document.getElementById('all');


        warningelement.addEventListener('click', () => {
            document.querySelectorAll('.warn').forEach(child => child.style.display = 'block');
            document.querySelectorAll('.error').forEach(child => child.style.display = 'none');
            document.querySelectorAll('.info').forEach(child => child.style.display = 'none');
            document.querySelectorAll('.log').forEach(child => child.style.display = 'none');
            document.querySelector('.console-setting-btn.enabled')?.classList.remove('enabled');
            warningelement.classList.add("enabled");
        });
        errorelement.addEventListener('click', () => {
            document.querySelectorAll('.warn').forEach(child => child.style.display = 'none');
            document.querySelectorAll('.error').forEach(child => child.style.display = 'block');
            document.querySelectorAll('.info').forEach(child => child.style.display = 'none');
            document.querySelectorAll('.log').forEach(child => child.style.display = 'none');
            document.querySelector('.console-setting-btn.enabled')?.classList.remove('enabled');
            errorelement.classList.add("enabled");
        });
        infoelement.addEventListener('click', () => {
            document.querySelectorAll('.warn').forEach(child => child.style.display = 'none');
            document.querySelectorAll('.error').forEach(child => child.style.display = 'none');
            document.querySelectorAll('.info').forEach(child => child.style.display = 'block');
            document.querySelectorAll('.log').forEach(child => child.style.display = 'none');
            document.querySelector('.console-setting-btn.enabled')?.classList.remove('enabled');
            infoelement.classList.add("enabled");
        });
        loggelement.addEventListener('click', () => {
            document.querySelectorAll('.warn').forEach(child => child.style.display = 'none');
            document.querySelectorAll('.error').forEach(child => child.style.display = 'none');
            document.querySelectorAll('.info').forEach(child => child.style.display = 'none');
            document.querySelectorAll('.log').forEach(child => child.style.display = 'block');
            document.querySelector('.console-setting-btn.enabled')?.classList.remove('enabled');
            loggelement.classList.add("enabled");
        });
        allelement.addEventListener('click', () => {
            document.querySelectorAll('.warn').forEach(child => child.style.display = 'block');
            document.querySelectorAll('.error').forEach(child => child.style.display = 'block');
            document.querySelectorAll('.info').forEach(child => child.style.display = 'block');
            document.querySelectorAll('.log').forEach(child => child.style.display = 'block');
            document.querySelector('.console-setting-btn.enabled')?.classList.remove('enabled');
            allelement.classList.add("enabled");
        });
        function isDarkMode() {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                changeFavicon('AIlurylogo2.ico');
            } else {
                changeFavicon('AIlurylogo.ico');
            }
        }
        function changeFavicon(faviconurl) {
            let favilink = document.getElementById("faviconico");

            if (favilink) {
                favilink.href = faviconurl;
            } else {
                favilink = document.createElement('link');
                favilink.id = 'faviconico';
                favilink.rel = 'icon';
                favilink.href = faviconurl;
                favilink.type = 'image/x-icon';
                document.head.appendChild(favilink);
            }
        }

        function updateModeInfo() {
            isDarkMode();
        }

        updateModeInfo();

        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', updateModeInfo);

        document.querySelector('.view').click();

    </script>
</body>
</html>
