<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link id="faviconico" rel="icon" href="AIlurylogo.ico" type="image/x-icon">
    <title>AIlury Studio</title>
    <style>
        :root {
            --background-color: #ffffff;
            --text-color: #000000;
            --editor-background-color: #E9E9E9;
            --editor-background2-color: #E9E9E9;
            --header-background-color: #e0e0e0;
            --circle-color: #000000;
            --button-background-color: #000000;
            --button-text-color: #ffffff;
            --editor-color: #172C41;
            --button-disabled-color: #999999;
            --button-disabled-background-color: #cccccc;
            --tag-color: #a239ca;
            --attribute-color: #d500f9;
            --text2-color: #e040fb;
            --keyword-color: #e040fb;
            --string-color: #e292fe;
            --number-color: #ff8a80;
            --def-color: #ab47bc;
            --variable-color: #7e57c2;
            --variable-2-color: #8e24aa;
            --variable-3-color: #aa00ff;
            --property-color: #ba68c8;
            --operator-color: #e91e63;
            --comment-color: #7d7d7d;
            --meta-color: #800080;
            --qualifier-color: #8e24aa;
            --builtin-color: #800080;
            --error-color: #d32f2f;
            --bracket-color: #8e24aa;
            --link-color: #d81b60;
            --active-line-bg: #1e1e1e;
            --selection-bg: #2c2c2c;
            --matching-bracket-color: #800080;
            --highlight-bg-color: rgba(0, 0, 0, 0.2);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --background-color: #000000;
                --text-color: #ffffff;
                --editor-background-color: #122335;
                --editor-background2-color: #122335;
                --header-background-color: #000000;
                --circle-color: #ffffff;
                --button-background-color: #ffffff;
                --button-text-color: #000000;
                --editor-color: #49C7CC;
                --button-disabled-color: grey;
                --button-disabled-background-color: #121212;
                --tag-color: #a239ca;
                --attribute-color: #d500f9;
                --text2-color: #e040fb;
                --keyword-color: #e040fb;
                --string-color: #e292fe;
                --number-color: #ff8a80;
                --def-color: #ab47bc;
                --variable-color: #7e57c2;
                --variable-2-color: #8e24aa;
                --variable-3-color: #aa00ff;
                --property-color: #ba68c8;
                --operator-color: #e91e63;
                --comment-color: #7d7d7d;
                --meta-color: #800080;
                --qualifier-color: #8e24aa;
                --builtin-color: #800080;
                --error-color: #d32f2f;
                --bracket-color: #8e24aa;
                --link-color: #d81b60;
                --active-line-bg: #1e1e1e;
                --selection-bg: #2c2c2c;
                --matching-bracket-color: #800080;
                --highlight-bg-color: rgba(255, 255, 255, 0.2);
            }
        }
        body {
            display: flex;
            font-family: Arial, sans-serif;
            margin: 0;
            height: 100vh;
            padding: 0;
            width: 100vw;
            transition: 1s;
            background: var(--background-color);
            overflow: hidden;
        }

        #editor-container {
            display: flex;
            margin-top: 7%;
            width: 100%;
            height: calc(100vh - 60px);
            transition: 1s;
        }

        #preview {
            flex: 1;
            height: 75vh;
            width: 100vw;
            border: none;
            overflow: auto;
            transition: 1s;
            background-color: var(--editor-background-color);
            border-radius: 5px;
        }

        .CodeMirror {
            font-family: 'Fira Code', monospace;
            font-size: 1.3em;
            line-height: 1.5;
            background: var(--editor-background-color);
            color: var(--text-color);
            border-radius: 0;
        }

        /* Zeilennummern und Cursor */
        .cm-s-mytheme .CodeMirror-gutters {
            background: var(--button-text-color);
            color: var(--button-background-color);
            border: none;
            padding: 10px;
            background-color: var(--button-text-color);
        }

        /*.CodeMirror-cursor {
            color: var(--button-background-color);
            border: none;
        }
        .cm-s-mytheme .CodeMirror-cursor {
            border-left: none;
            border: none;
        }*/
        
        .cm-s-mytheme.CodeMirror {
            background-color: var(--editor-background2-color);
            color: var(--editor-color);
            border: none;
        }

        .CodeMirror-gutters {
            color: var(--button-background-color);
            background: var(--button-text-color);
            border: none;
        }

        .cm-s-mytheme .CodeMirror-gutter {
            color: var(--button-background-color);
            background: var(--button-text-color);
            border: none;
        }
        .CodeMirror-linenumber {
            background: var(--button-text-color);
            color: var(--button-background-color);
            border: none;
        }

        .cm-s-mytheme .CodeMirror-linenumber {
            color: var(--button-background-color);
            background: var(--button-text-color);
            border: none;
        }

        .cm-s-mytheme .CodeMirror-foldgutter{
            color: var(--button-background-color);
            background: var(--button-text-color);
            border: none;
        }

        #files {
            display: flex;
            align-items: center;
            background-color: var(--header-background-color);
            padding: 10px;
            border-bottom: none;
            overflow-x: auto;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 50;
            transition: 1s;
        }

        #index {
            padding: 10px 20px;
            margin-right: 5px;
            background-color: #3a3f47;
            border-radius: 5px;
            color: #ffffff;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
            min-width: 100px;
            text-align: center;
            white-space: nowrap;
        }

        .index.highlight {
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border-bottom: 0;
            position: relative;
            z-index: 1;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
        }
        .view.highlight {
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border-bottom: 0;
            position: relative;
            z-index: 1;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
        }

        .toolbtn {
            padding: 9px 20px;
            font-size: 1.3em;
            font-weight: bold;
            color: var(--button-text-color);
            background: var(--button-background-color);
            border: none;
            border-radius: 100px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            margin: 0 8px;
        }

        #runbtn {
            font-size: 1em;
            padding: 12px 24px;
            background: linear-gradient(90deg, #ff0077, #7700ff);
            color: #fff;
        }

        #consolebtn {
            font-size: 1em;
            padding: 12px 24px;
        }

        .toolbtn:hover {
            background: #f0f0f0;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            transform: translateY(-2px);
        }

        .toolbtn:active {
            background: #e0e0e0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            transform: translateY(0);
        }

        .toolbtn:disabled {
            background: #ddd;
            color: #666;
            cursor: not-allowed;
            box-shadow: none;
        }

        #sidebar {
            background-color: var(--header-background-color);
            color: var(--text-color);
            position: absolute;
            width: 250px;
            height: 100vh;
            top: 0;
            left: -300px;
            padding: 10px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
            transition: left 0.3s;
            z-index: 100;
            overflow-y: scroll;
            overflow-x: hidden;
        }

        #sidebar.show {
            left: 0;
        }

        .file {
            color: var(--text-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px;
            opacity: 1;
            border-bottom: 1px solid #5c5c5c;
        }

        .file input {
            border: none;
            background: none;
            color: var(--text-color);
            font-size: 16px;
            width: 100%;
        }

        .file .options {
            position: relative;
        }

        .file .options .dropdown {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background-color: var(--text-color);
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }

        .file .options .dropdown button {
            display: block;
            background: none;
            border: none;
            color: var(--button-text-color);
            padding: 5px 10px;
            width: 100%;
            text-align: left;
            cursor: pointer;
        }

        .file .options .dropdown button:hover {
            background-color: var(--header-background-color);
            color: var(--text-color);
        }

        #addFile {
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 1.3em;
            margin-bottom: 10px;
            margin-left: 10px;
            font-weight: bold;
            height: 5%;
        }

        #hidesidebar {
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 1.3em;
            margin-bottom: 10px;
            font-weight: bold;
            height: 5%;
        }

        .file .menu-btn {
            cursor: pointer;
            color: var(--text-color);
            font-size: 20px;
            margin-left: 10px;
        }

        #filepath-container {
            display: flex;
            align-items: center;
            background-color: var(--editor-background-color);
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            width: 100vw;
            z-index: 10;
        }

        #filepath-container label {
            font-size: 1em;
            color: var(--editor-color);
            margin-right: 10px;
            white-space: nowrap;
        }

        #filepath-container input[type="text"] {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 4px;
            font-size: 1em;
            color: var(--editor-color);
            box-sizing: border-box;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background: transparent;
        }

        #filepath-container input[type="text"]:focus {
            border: none;
            outline: none;
        }

        .index {
            padding: 10px 20px;
            margin-right: 5px;
            background-color: var(--button-disabled-background-color);
            border-radius: 5px;
            color: var(--button-disabled-color);
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
            min-width: 100px;
            text-align: center;
            white-space: nowrap;
        }

        .index:hover {
            background-color: var(--button-background-color);
            color: var(--button-text-color);
        }

        .index.highlight {
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border-bottom: 0;
            position: relative;
            z-index: 1;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1); /* Schatten unter dem aktiven Tab */
        }

        .view.highlight {
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border-bottom: 0;
            position: relative;
            z-index: 1;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1); /* Schatten unter dem aktiven Tab */
        }
        .cm-s-mytheme .cm-tag {
            color: var(--tag-color);
        }

        .cm-s-mytheme .cm-attribute {
            color: var(--attribute-color);
        }

        .cm-s-mytheme .cm-attribute.cm-tag {
            color: var(--text2-color);
        }

        .cm-s-mytheme .cm-keyword {
            color: var(--keyword-color);
        }

        .cm-s-mytheme .cm-string {
            color: var(--string-color);
        }

        .cm-s-mytheme .cm-number {
            color: var(--number-color);
        }

        .cm-s-mytheme .cm-def {
            color: var(--def-color);
        }

        .cm-s-mytheme .cm-variable {
            color: var(--variable-color);
        }

        .cm-s-mytheme .cm-variable-2 {
            color: var(--variable-2-color);
        }

        .cm-s-mytheme .cm-variable-3 {
            color: var(--variable-3-color);
        }

        .cm-s-mytheme .cm-property {
            color: var(--property-color);
        }

        .cm-s-mytheme .cm-operator {
            color: var(--operator-color);
        }

        .cm-s-mytheme .cm-comment {
            color: var(--comment-color);
        }

        .cm-s-mytheme .cm-meta {
            color: var(--meta-color);
        }

        .cm-s-mytheme .cm-qualifier {
            color: var(--qualifier-color);
        }

        .cm-s-mytheme .cm-builtin {
            color: var(--builtin-color);
        }

        .cm-s-mytheme .cm-error {
            background: rgba(255, 0, 0, 0.2);
        }

        .cm-s-mytheme .cm-bracket {
            color: var(--bracket-color);
        }

        .cm-s-mytheme .cm-link {
            color: var(--link-color);
        }

        .cm-s-mytheme .cm-activeLine {
            background: var(--active-line-bg);
        }

        .cm-s-mytheme .cm-selection {
            background: var(--selection-bg);
        }

        .cm-s-mytheme .cm-matchingbracket {
            text-decoration: underline;
            color: var(--matching-bracket-color);
            background-color: var(--matching-bracket-color);
        }
        .cm-s-mytheme .cm-matchingbrackets {
            text-decoration: underline;
            color: var(--matching-bracket-color);
            background-color: var(--matching-bracket-color);
        }

        .cm-s-mytheme .CodeMirror-hints {
            background-color: var(--button-text-color);
            color: var(--button-background-color);
            border: none;
            font-size: 1em;
            padding: 5px;
        }

        .cm-s-mytheme .CodeMirror-hint {
            padding: 2px 5px;
            cursor: pointer;
            font-family: 'Fira Code', monospace;
        }

        .cm-s-mytheme .CodeMirror-hint-active {
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            font-family: 'Fira Code', monospace;
        }

        .cm-s-mytheme .CodeMirror-search-field{
            background-color: var(--button-text-color) !important;
            color: var(--button-background-color) !important;
            border: none;
            font-size: 1em;
            padding: 5px;
        }

        .cm-s-mytheme .CodeMirror-search-field input{
            background-color: transparent;
            color: var(--button-background-color) !important;
            border: none;
            font-size: 1em;
            padding: 5px;
        }

        .CodeMirror-foldgutter-open {
            background-color: transparent;
            color: var(--button-background-color) !important;
            border: none;
            font-size: 1em;
            padding: 5px;
            font-weight: bold;
        }

        .CodeMirror-foldgutter-folded {
            background-color: transparent;
            color: var(--button-background-color) !important;
            border: none;
            font-size: 1em;
            padding: 5px;
            font-weight: bold;
        }

        .CodeMirror-hints {
            color: var(--button-text-color) !important;
            background-color: var(--button-background-color) !important;
            border: none !important;
            font-family: 'Fira Code', monospace !important;
        }

        .CodeMirror-hint {
            color: var(--button-text-color) !important;
            background-color: var(--button-background-color) !important;
            border: none !important;
            font-family: 'Fira Code', monospace !important;
        }

        .CodeMirror-hint-active {
            color: var(--button-background-color) !important;
            background-color: var(--button-text-color) !important;
        }

        #preview-container{
            width: 100vw;
            height: 100%;
            display: flex;
            flex-direction: column;
            transition: 1s;
        }
        .resizable-draggable {
            display: none;
            width: 40%;
            height: 70%;
            background-color: var(--button-disabled-background-color);
            border: none;
            border-radius: 8px;
            position: absolute;
            right: 20%;
            top: 10%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 10px;
            resize: both;
            overflow: auto;
            cursor: move;
            z-index: 50;
            transition: background-color 1s ease;
        }
        .resizable-draggable.show{
            display: block;
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            font-size: 2em;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            line-height: 20px;
            text-align: center;
            cursor: pointer;
            color: var(--text-color);
            z-index: 52;
            transition: 1s;
        }

        .move-button{
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            font-size: 2em;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            line-height: 20px;
            text-align: center;
            cursor: pointer;
            color: var(--text-color);
            transition: 1s;
        }

        #console {
            margin-top: 0;
            width: 100%;
            height: 100%;
            margin-top: 15%;
            transition: 1s;
        }
        #console-message{
            color: var(--text-color);
            font-family: 'Fira Code', monospace;
            transition: 1s;
        }

        .error{
            color: red;
            font-family: 'Fira Code', monospace;
            transition: 1s;
        }

        .warn{
            color: orange;
            font-family: 'Fira Code', monospace;
            transition: 1s;
        }

        .info{
            color: var(--text-color);
            font-family: 'Fira Code', monospace;
            transition: 1s;
        }

        .log{
            color: var(--text-color);
            font-family: 'Fira Code', monospace;
            transition: 1s;
        }

        .success{
            color: green;
            font-family: 'Fira Code', monospace;
            transition: 1s;
        }

        .button-container{
            height: 11%;
            width: 100%;
            overflow-y: scroll;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            margin-top: 30px;
            transition: 1s;
            position: absolute;
            z-index: 51;
            margin-top: 0;
            margin-left: 0;
        }

        #console-container{
            height: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
            transition: 1s;
        }
        .console-setting-btn{
            background-color: var(--button-disabled-background-color);
            color: var(--button-disabled-color);
            border: none;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
            font-size: 1em;
            margin-bottom: 10px;
            margin-left: 10px;
            width: 100%;
            transition: 1s;
        }
        .console-setting-btn:hover{
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            transition: 1s;
        }
        .console-setting-btn.enabled{
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            transition: 1s;
        }
        #UploadFile{
            text-decoration: underline;
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 1.3em;
            margin-bottom: 10px;
            margin-left: 10px;
            font-weight: bold;
            height: 5%;
            transition: 1s;
        }
        #currentFileImg{
            max-width: 90vw;
            max-height: 85vh;
            object-fit: cover;
            transition: 1s;
        }
        #currentFileImg-container{
            width: 100vw;
            height: 100vh;
            background: var(--editor-background-color);
            position: absolute;
            top: 0;
            left: 0;
            z-index: 45;
            transition: 1s;
            display: flex;
            justify-content: center;
            align-items: center;
            display: none;
            padding: 10%;
        }

        .CodeMirror-ghost {
            opacity: 0.5;
            color: gray;
            pointer-events: none;
            position: absolute;
            transition: 1s;
        }

        #line-number-input-container{
            width: 20%;
            max-width: 250px;
            color: var(--button-background-color);
            background-color: var(--button-text-color);
            border: none;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            position: fixed;
            right: 10px;
            bottom: 10px;
        }

        #GO-button{
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border: none;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
            font-size: 1em;
            margin-left: 10px;
            width: 30%;
            transition: 1s;
        }

        #lineNumber{
            background-color: var(--button-background-color);
            color: var(--button-text-color);
            border: none;
            border-radius: 5px;
            padding: 10px;
            font-size: 1em;
            margin-left: 10px;
            width: 60%;
            transition: 1s;
        }

        #lineNumber:focus{
            outline: none;
        }

        @keyframes rotateAnimation {
            0% {
              filter: hue-rotate(0deg);
            }
            100% {
              filter: hue-rotate(360deg);
            }
        }
        #load {
            display: none;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            width: 100vw;
            background: rgba(0, 0, 0, 0.4);
            animation: rotateAnimation 10s linear infinite;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 999;
        }
        #load .loader {
            position: relative;
            width: 120px;
            height: 120px;
        }
        #load .loader span{
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            transform: rotate(calc(18deg * var(--i)));
        }
        #load .loader span::before{
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #fff;
            box-shadow: 0 0 10px #fff;/*, 0 0 20px #fff, 0 0 40px #fff, 0 0 60px #fff, 0 0 80px #fff;*/
            animation: loadingAnimation 2s linear infinite;
            animation-delay: calc(0.1s * var(--i));
        }
        @keyframes loadingAnimation{
            0%{
              transform: scale(0);
            }
            80%,100%{
              transform: scale(1);
            }
        }
        .file-icon{
            font-size: 1em;
        }
        #refreshBtn{
            background: transparent;
            color: var(--editor-color);
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 1.5em;
            margin-right: 20px;
            font-weight: bold;
        }
        #preview-cross{
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            color: var(--editor-color);
            border: none;
            font-size: 2.5em;
            border-radius: none;
            z-index: 999;
            font-weight: bold;
            display: none;
            text-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        #previewFullScreenBtn{
            background: transparent;
            color: var(--editor-color);
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 1.5em;
            margin-right: 20px;
            font-weight: bold;
            transform: rotate(45deg);
        }
        #alert-icon{
            position: absolute;
            font-size: 1.5em;
            color: red;
            margin-top: -0.8em;
            margin-left: 0.3em;
            display: none;
            animation: alertAnimation 1s;
        }

        @keyframes alertAnimation {
            0%{
                transform: scale(1) rotate(0deg);
            }
            33%{
                transform: scale(1.5) rotate(45deg);
            }
            66%{
                transform: scale(1.5) rotate(-45deg);
            }
            100%{
                transform: scale(1) rotate(0deg);
            }
        }

    </style>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/fold/foldgutter.min.css">
    <link rel="stylesheet" href="https://codemirror.net/lib/codemirror.css">
    <link rel="stylesheet" href="https://codemirror.net/addon/dialog/dialog.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/show-hint.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/hint/show-hint.min.css">

</head>
<body>
    <section id="load">
      <div class="loader">
        <span style="--i: 1"></span>
        <span style="--i: 2"></span>
        <span style="--i: 3"></span>
        <span style="--i: 4"></span>
        <span style="--i: 5"></span>
        <span style="--i: 6"></span>
        <span style="--i: 7"></span>
        <span style="--i: 8"></span>
        <span style="--i: 9"></span>
        <span style="--i: 10"></span>
        <span style="--i: 11"></span>
        <span style="--i: 12"></span>
        <span style="--i: 13"></span>
        <span style="--i: 14"></span>
        <span style="--i: 15"></span>
        <span style="--i: 16"></span>
        <span style="--i: 17"></span>
        <span style="--i: 18"></span>
        <span style="--i: 19"></span>
        <span style="--i: 20"></span>
      </div>
    </section>
    <button id="preview-cross" onclick="previewFullScreen()">×</button>
    <div id="sidebar">
        <input type="file" id="fileInput" accept="image/*,.txt,.html,.css,.js" style="display: none;">
        <button id="hidesidebar">←</button><button id="addFile">+</button><label for="fileInput"><button id="UploadFile">↓</button></label>
        <div id="fileList">
            
        </div>
    </div>
    <div id="files">
        <button class="toolbtn" id="toggleSidebar">≡</button>
        <button class="toolbtn" id="homebtn">⌂</button>
        <button class="toolbtn" id="runbtn">Test</button>
        <button class="toolbtn" id="consolebtn">console<span id="alert-icon">⚠</span></button>
        <div class="view index">view</div>
    </div>
    <div class="resizable-draggable" id="resizable-element">
        <button class="close-button" onclick="closeElement()">×</button>
        <button class="move-button">○</button>
        <div id="console-container">
            <div class="button-container" id="button-container">
                <button id="warning" class="console-setting-btn">warning</button>
                <button id="error" class="console-setting-btn">error</button>
                <button id="log" class="console-setting-btn">log</button>
                <button id="info" class="console-setting-btn">info</button>
                <button id="all" class="console-setting-btn">all</button>
            </div>
            <div class="console" id="console">

            </div>
        </div>
    </div>

    <div id="editor-container">
        <textarea id="editor"></textarea>
        <div id="preview-container">
            <!-- ⏻ -->
            <div id="filepath-container"><button id="previewFullScreenBtn" onclick="previewFullScreen()">↔</button><button id="refreshBtn" onclick="refreshFunction()">↻</button><label for="filename">/</label><input type="text" id="filename" placeholder="html file path..." value="index.html"></div><br>
            <iframe id="preview" loading="lazy"></iframe>
        </div>
        <div id="currentFileImg-container">
            <img src="" id="currentFileImg">
        </div>
    </div>
    <div id="line-number-input-container">
        <input type="number" id="lineNumber" placeholder="line">
        <button id="GO-button" onclick="goToLine()">GO</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/lint/lint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/lint/javascript-lint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jshint/2.13.0/jshint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/fold/foldcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/fold/brace-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/fold/xml-fold.min.js"></script>
    <script src="path/to/codemirror/addon/edit/closebrackets.js"></script>
    <script src="path/to/codemirror/addon/edit/closetag.js"></script>
    <script src="path/to/codemirror/addon/edit/matchtags.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/edit/closetag.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/edit/matchtags.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/edit/matchbrackets.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/fold/foldgutter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/fold/foldcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/fold/brace-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/fold/comment-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.6/addon/fold/markdown-fold.min.js"></script>

    <script src="https://codemirror.net/addon/search/search.js"></script>
    <script src="https://codemirror.net/addon/search/searchcursor.js"></script>
    <script src="https://codemirror.net/addon/dragdrop/dragdrop.js"></script>
    <script src="https://codemirror.net/addon/edit/history.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/search/search.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/search/jump-to-line.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/display/fullscreen.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/display/placeholder.min.js"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/show-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/javascript-hint.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/hint/show-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/hint/html-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/hint/css-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/hint/javascript-hint.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/hint/show-hint.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/hint/xml-hint.min.js"></script>
    <script src="https://codemirror.net/addon/edit/closetag.js"></script>


    <script>
        let homebtnv = document.getElementById("homebtn");
        homebtnv.addEventListener("click", function() {
            window.location.href = "index.html";
        });
        let previewIsFullScreen = false;
        function previewFullScreen() {
            let preview = document.getElementById("preview");
            let previewContainer = document.getElementById("preview-container");
            let previewCross = document.getElementById("preview-cross");
            if (previewIsFullScreen){
                preview.style.height = "75vh";
                preview.style.width = "100vw";
                preview.style.position = "relative";
                previewContainer.style.left = "0";
                previewContainer.style.top = "0";
                preview.style.zIndex = "1";
                preview.style.borderRadius = "5px";
                previewCross.style.display = "none";
                previewIsFullScreen = false;
            }else {
                preview.style.height = "100%";
                preview.style.width = "100%";
                preview.style.position = "absolute";
                preview.style.left = "0";
                preview.style.top = "0";
                preview.style.zIndex = "555";
                preview.style.borderRadius = "5px";
                previewCross.style.display = "block";
                previewIsFullScreen = true;
            }
        }
        const iframeE = document.getElementById('preview');
        const loadElement = document.getElementById('load');

        function startLoading() {
            loadElement.style.display = 'flex';
        }

        function finishLoading() {
            loadElement.style.display = 'none';
        }

        let UploadFile = document.getElementById('UploadFile');
        let fileInputv = document.getElementById('fileInput');
        let allimages = {};
        UploadFile.addEventListener('click', () => {
            fileInputv.click();
        });
        let currentFile = "index.html";
        let filenames = [];

        let values = {

        };
        let mode = {

        };

        let cursorPositions = {
        };

        let indexfile = "index.html";

        let filenamei = document.getElementById('filename');

        filenamei.addEventListener('input', () => {
            indexfile = filenamei.value;
            if (filenamei == ''){
                indexfile = "index.html";
            }
        });
        filenamei.addEventListener('change', () => {
            indexfile = filenamei.value;
            if (filenamei == ''){
                indexfile = "index.html";
            }
        });


        const editor = CodeMirror.fromTextArea(document.getElementById('editor'), {
            mode: mode[currentFile],
            lineNumbers: true,
            theme: "mytheme",
            indentUnit: 4,
            tabSize: 4,
            indentWithTabs: true,
            lineWrapping: false,
            matchBrackets: true,
            styleActiveLine: true,
            autoCloseTags: true,
            matchTags: {bothTags: true},
            foldGutter: true,
            viewportMargin: 30,
            gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
            scrollbarStyle: "native",
            readOnly: false,
            cursorHeight: 0.5,
            extraKeys: {
                "Ctrl-Space": "autocomplete",
                "Tab": "autocomplete",
                "Ctrl-D": "duplicateLine",
                "Ctrl-/": "toggleComment"
            },
            highlightSelectionMatches: {showToken: /\w/, annotateScrollbar: true},
            lint: true,
            lintOnChange: true,
            showCursorWhenSelecting: true,
            search: {
                showMatchesOnScrollbar: true,
                highlightMatches: true
            },
            dragDrop: true,
            historyEventDelay: 1000,
            undoDepth: 1000,
            autoCloseBrackets: true,
            autoCloseBrackets: {
                pairs: "()[]{}''\"\"``",
                triples: "",
                explode: "[]{}()",
                override: ["]", "}"],
                closeAfter: "*",
                closeOnEnter: true,
                closeBrackets: true,
                ignoreParentheses: false,
                ignoreBrackets: false,
                ignoreTags: false,
                ignoreComments: false,
                ignoreStrings: false,
                ignorePattern: "",
            },
            hintOptions: {
                hint: CodeMirror.hint.auto,
                completeSingle: false,
                closeOnUnfocus: true,
            },
            autoCloseTags: {
              whenClosing: true,
              indentTags: ['div', 'li', 'section', 'button', 'script', 'style', 'html'],
            }
        });

        function goToLine() {
            var line = parseInt(document.getElementById("lineNumber").value, 10);
            if (!isNaN(line)) {
              editor.scrollIntoView({line: line - 1, ch: 0}, 200);
              editor.setCursor({line: line - 1, ch: 0});
              editor.focus();
            }
        }

        function showGhostText(cm, suggestion) {
            const cursor = cm.getCursor();
            const token = cm.getTokenAt(cursor);
            const line = cm.getLine(cursor.line);
            const textBeforeCursor = line.slice(token.start, cursor.ch);
            const remainingText = suggestion.slice(textBeforeCursor.length);

            const ghostStart = { line: cursor.line, ch: token.start + textBeforeCursor.length };
            const ghostEnd = { line: cursor.line, ch: ghostStart.ch + remainingText.length };

            const ghostElement = document.createElement('span');
            ghostElement.className = 'CodeMirror-ghost';
            ghostElement.textContent = remainingText;

            cm.markText(ghostStart, ghostEnd, {
                replacedWith: ghostElement,
                clearWhenEmpty: false
            });
        }

        function clearGhostText(cm) {
            const marks = cm.getAllMarks();
            for (const mark of marks) {
                if (mark.replacedWith && mark.replacedWith.className === 'CodeMirror-ghost') {
                    mark.clear();
                }
            }
        }

        function applyGhostText(cm) {
            const cursor = cm.getCursor();
            const marks = cm.findMarksAt(cursor);

            for (const mark of marks) {
                if (mark.replacedWith && mark.replacedWith.className === 'CodeMirror-ghost') {
                    const range = mark.find();
                    const textToInsert = mark.replacedWith.textContent;
                    cm.replaceRange(textToInsert, range.from, range.to, "+input");
                    mark.clear();
                    break;
                }
            }
        }

        function getHintFunction(cm) {
            const mode = cm.getMode().name;
            if (mode === 'htmlmixed') {
                return CodeMirror.hint.html;
            } else if (mode === 'css') {
                return CodeMirror.hint.css;
            } else if (mode === 'javascript') {
                return CodeMirror.hint.javascript;
            }
            return CodeMirror.hint.anyword;
        }

        editor.on("inputRead", function(cm, change) {
            if (change.text.join("") === " ") {
                clearGhostText(cm);
                return;
            }

            if (change.text.join("").length > 0) {
                clearGhostText(cm);

                const cursor = cm.getCursor();
                const token = cm.getTokenAt(cursor);
                const word = token.string;

                const hintFunction = getHintFunction(cm);
                CodeMirror.showHint(cm, hintFunction, {
                    completeSingle: false
                });

                const hint = hintFunction(cm);
                if (hint && hint.list.length > 0) {
                    showGhostText(cm, hint.list[0]);
                }
            }
            if (/*change.origin !== 'setValue' && */cursorPositions[currentFile]) {
                const cursorps = cm.getCursor();
                cursorPositions[currentFile].line = cursorps.line;
                cursorPositions[currentFile].column = cursorps.ch;
            }
        });

        editor.addKeyMap({
            'Tab': function(cm) {
                applyGhostText(cm);
            },
            'Space': function(cm) {
                clearGhostText(cm);
                cm.replaceSelection(" ");
            }
        });

        CodeMirror.defineOption("lint", false, function(cm, val, old) {
            if (old && old !== CodeMirror.Init) {
                cm.off("renderLine", old);
                cm.off("change", old);
            }
            if (val) {
                cm.on("renderLine", function(cm, line, elem) {
                    if (cm.somethingSelected()) return;
                    const error = cm.getLintingErrors(line);
                    if (error) {
                        elem.className += " lint-error";
                    }
                });
                cm.on("change", function() {
                    cm.performLinting();
                });
            }
        });

        let isonpreview = false;

        function checkscreensizing() {
            let preview = document.getElementById("preview-container");
            let lineNumInputContainer = document.getElementById("line-number-input-container");
            if (isonpreview){
                editor.setSize("100%", "100%");
                preview.style.display = "block";
                document.getElementById("currentFileImg-container").style.display = "none";
                lineNumInputContainer.style.display = "none";
            }else if (!allimages[currentFile] && !isonpreview){
                editor.setSize("100%", "100%");
                preview.style.display = "none";
                document.getElementById("currentFileImg-container").style.display = "none";
                lineNumInputContainer.style.display = "flex";
            }else if (allimages[currentFile]){
                editor.setSize("100%", "100%");
                preview.style.display = "none";
                document.getElementById("currentFileImg-container").style.display = "block";
                document.getElementById("currentFileImg").src = allimages[currentFile];
                lineNumInputContainer.style.display = "none";
            }
        }

        checkscreensizing();

        let viewelement = document.querySelector(`.view`);

        viewelement.addEventListener('click', () => {
            document.querySelector('.index.highlight')?.classList.remove('highlight');
            viewelement.classList.add(`highlight`);
            isonpreview = true;
            checkscreensizing();
        });
        function goToCursorLine(line, column) {
            if (!isNaN(line) && line > 0) {
                editor.scrollIntoView({line: line, ch: column}, 200);
                editor.setCursor({line: line, ch: column});
                editor.focus();
            } else if (line === 0) {
                editor.scrollIntoView({line: 0, ch: column}, 200);
                editor.setCursor({line: 0, ch: column});
                editor.focus();
            }
        }


        document.addEventListener('DOMContentLoaded', () => {
            const sidebar = document.getElementById('sidebar');
            const addFileButton = document.getElementById('addFile');
            const toggleSidebarButton = document.getElementById('toggleSidebar');
            const fileList = document.getElementById('fileList');
            const hidesidebar = document.getElementById('hidesidebar');
            const files = document.getElementById('files');
            const fileInput = document.getElementById('fileInput');

            fileInput.addEventListener('change', (event) => {
                const files = event.target.files;

                Array.from(files).forEach(file => {
                    const fileName = file.name;

                    if (file.type === 'text/plain') {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            addNewFile(fileName);
                            values[fileName] = e.target.result;
                        };
                        reader.readAsText(file);
                    } else if (file.type === 'text/html') {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            addNewFile(fileName);
                            values[fileName] = e.target.result;
                        };
                        reader.readAsText(file);
                    } else if (file.type === 'text/css') {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            addNewFile(fileName);
                            values[fileName] = e.target.result;
                        };
                        reader.readAsText(file);
                    } else if (file.type === 'text/js') {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            addNewFile(fileName);
                            values[fileName] = e.target.result;
                        };
                        reader.readAsText(file);
                    } else if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            allimages[fileName] = e.target.result;
                            let newimageelement = createImgElement(fileName);
                            fileList.appendChild(newimageelement);
                        };
                        reader.readAsDataURL(file);
                    } else {
                        console.error('Unsupported file type:', file.type);
                    }
                });
            });

            function createFileElement(namee) {
                let name = namee;
                if (filenames.includes(name)) {
                    return;
                }
                let oldname = name;
                filenames.push(name);

                cursorPositions[name] = {
                    line: 0,
                    column: 0
                };

                if (name.includes(".html")) {
                    mode[name] = "htmlmixed";
                    values[name] = `
<!DOCTYPE html>
<html lang="de">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>AIlury Programming studio</title>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <script src="script.js"><\/script>
    </body>
</html>`;
                } else if (name.includes(".js")) {
                    mode[name] = "javascript";
                    values[name] = `
console.log("Hello World!");`;
                } else if (name.includes(".css")) {
                    mode[name] = "css";
                    values[name] = `
body {
    font-family: Arial, sans-serif;
    line-height: 1.6;
    margin: 0;
    padding: 0;
    background-color: #f4f4f4;
}`;
                }

                const fileElement = document.createElement('div');
                fileElement.className = 'file';

                let logoText = "✗";
                if (name.includes(".html")){
                    logoText = "Html";
                }else if (name.includes(".js")){
                    logoText = "Js";
                }else if (name.includes(".css")){
                    logoText = "Css";
                }
                const FileElementIcon = document.createElement('span');
                FileElementIcon.className = "file-icon";
                FileElementIcon.textContent = logoText;
                FileElementIcon.style.fontWeight = "1500";
                FileElementIcon.style.fontSize = "1em";
                // text gradient
                if (logoText == "✗"){
                    FileElementIcon.style.background = "linear-gradient(to right, #ff0000, #ff00ff)";
                }else {
                    FileElementIcon.style.background = "linear-gradient(to right, #ff0077, #7700ff)";
                }
                FileElementIcon.style.backgroundClip = "text";
                FileElementIcon.style.color = "transparent";

                const fileNameInput = document.createElement('input');
                fileNameInput.type = 'text';
                fileNameInput.value = name;
                fileNameInput.disabled = true;
                fileElement.appendChild(FileElementIcon);
                fileElement.appendChild(fileNameInput);

                const options = document.createElement('div');
                options.className = 'options';

                const menuButton = document.createElement('span');
                menuButton.className = 'menu-btn';
                menuButton.textContent = '…';
                menuButton.addEventListener('click', (event) => {
                    const dropdown = event.currentTarget.nextElementSibling;
                    dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
                });

                const dropdown = document.createElement('div');
                dropdown.className = 'dropdown';

                const newfileforfiles = document.createElement('div');
                newfileforfiles.className = 'index';

                newfileforfiles.textContent =  name;

                newfileforfiles.addEventListener('click', () => {
                    startLoading();
                    currentFile = name;
                    editor.setOption('mode', mode[name]);
                    editor.refresh();
                    files.querySelector('.index.highlight')?.classList.remove('highlight');
                    newfileforfiles.classList.add("highlight");
                    isonpreview = false;
                    checkscreensizing();
                    editor.setValue(values[name]);
                    if (cursorPositions[currentFile] && typeof cursorPositions[currentFile].line !== 'undefined') {
                        goToCursorLine(cursorPositions[currentFile].line, cursorPositions[currentFile].column);
                    }
                    finishLoading();
                });

                files.appendChild(newfileforfiles);

                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.addEventListener('click', () => {
                    const index = filenames.indexOf(name);
                    if (index !== -1) filenames.splice(index, 1);
                    delete mode[name];
                    delete values[name];
                    fileElement.remove();
                    newfileforfiles.remove();
                    menuButton.click();
                    document.querySelector('.view').click();
                });

                const renameButton = document.createElement('button');
                renameButton.textContent = 'Rename';
                renameButton.addEventListener('click', () => {
                    menuButton.click();
                    if (fileNameInput.disabled) {
                        fileNameInput.disabled = false;
                        fileNameInput.focus();
                        fileNameInput.classList.add('editing');

                        fileNameInput.addEventListener('keydown', (event) => {
                            if (event.key === 'Enter') {
                                let newName = fileNameInput.value.trim();
                                if (newName && newName !== name && !filenames.includes(newName)) {
                                    const index = filenames.indexOf(name);
                                    if (index !== -1) filenames[index] = newName;

                                    mode[newName] = mode[name];
                                    values[newName] = values[name];
                                    cursorPositions[newName] = cursorPositions[name];

                                    name = newName;
                                    fileNameInput.value = name;
                                    newfileforfiles.textContent = name;
                                    oldname = name;
                                    let logoText2 = "✗";
                                    if (name.includes(".html")){
                                        logoText2 = "Html";
                                    }else if (name.includes(".js")){
                                        logoText2 = "Js";
                                    }else if (name.includes(".css")){
                                        logoText2 = "Css";
                                    }
                                    if (logoText2 == "✗"){
                                        FileElementIcon.style.background = "linear-gradient(to right, #ff0000, #af002d)";
                                        FileElementIcon.style.backgroundClip = "text";
                                        FileElementIcon.style.color = "transparent";
                                    }else {
                                        FileElementIcon.style.background = "linear-gradient(to right, #ff0077, #7700ff)";
                                        FileElementIcon.style.backgroundClip = "text";
                                        FileElementIcon.style.color = "transparent";
                                    }
                                    FileElementIcon.textContent = logoText2;
                                    fileNameInput.disabled = true;
                                    fileNameInput.classList.remove('editing');
                                } else {
                                    fileNameInput.value = oldname;
                                    newfileforfiles.textContent = oldname;
                                    fileNameInput.disabled = true;
                                    fileNameInput.classList.remove('editing');
                                }
                            }
                        });

                        fileNameInput.addEventListener('blur', () => {
                            let newName = fileNameInput.value.trim();
                            if (newName && newName !== name && !filenames.includes(newName)) {
                                const index = filenames.indexOf(name);
                                if (index !== -1) filenames[index] = newName;

                                mode[newName] = mode[name];
                                values[newName] = values[name];
                                cursorPositions[newName] = cursorPositions[name];

                                name = newName;
                                fileNameInput.value = name;
                                newfileforfiles.textContent = name;
                                oldname = name;
                                let logoText2 = "✗";
                                if (name.includes(".html")){
                                    logoText2 = "Html";
                                }else if (name.includes(".js")){
                                    logoText2 = "Js";
                                }else if (name.includes(".css")){
                                    logoText2 = "Css";
                                }
                                if (logoText2 == "✗"){
                                    FileElementIcon.style.background = "linear-gradient(to right, #ff0000, #af002d)";
                                    FileElementIcon.style.backgroundClip = "text";
                                    FileElementIcon.style.color = "transparent";
                                }else {
                                    FileElementIcon.style.background = "linear-gradient(to right, #ff0077, #7700ff)";
                                    FileElementIcon.style.backgroundClip = "text";
                                    FileElementIcon.style.color = "transparent";
                                }
                                FileElementIcon.textContent = logoText2;
                                fileNameInput.disabled = true;
                                fileNameInput.classList.remove('editing');
                            }else {
                                fileNameInput.disabled = true;
                                fileNameInput.classList.remove('editing');
                            }
                        });
                    }
                });

                const downloadButton = document.createElement('button');
                downloadButton.textContent = 'Download';
                function downloadFile(filename, content) {
                    const blob = new Blob([content], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }

                downloadButton.addEventListener('click', () => {
                    menuButton.click();
                    downloadFile(name, values[name]);
                });

                const copyButton = document.createElement('button');
                copyButton.textContent = 'Copy';
                copyButton.addEventListener('click', () => {
                    menuButton.click();
                    const textarea = document.createElement('textarea');
                    textarea.value = values[name];
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                });

                let copyFilePathButton = document.createElement('button');
                copyFilePathButton.textContent = 'path';
                copyFilePathButton.addEventListener('click', () => {
                    menuButton.click();
                    const textarea = document.createElement('textarea');
                    textarea.value = name;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                });

                dropdown.appendChild(deleteButton);
                dropdown.appendChild(renameButton);
                dropdown.appendChild(downloadButton);
                dropdown.appendChild(copyButton);
                dropdown.appendChild(copyFilePathButton);
                options.appendChild(menuButton);
                options.appendChild(dropdown);
                fileElement.appendChild(options);

                return fileElement;
            }

            let imgType = {

            };
            function createImgElement(namevv) {
                let name = namevv;
                let oldname = name;

                if (name.includes(".png") || name.includes(".jpg") || name.includes(".jpeg") || name.includes(".gif")) {
                    let imagetype = name.split('.');
                    let topImageType = imagetype[imagetype.length - 1];
                    imgType[name] = topImageType;
                    if (filenames.includes(name)) {
                        return;
                    }
                    filenames.push(name);

                    const fileElement = document.createElement('div');
                    fileElement.className = 'file';

                    const FileElementIcon = document.createElement('span');
                    FileElementIcon.className = "file-icon";
                    FileElementIcon.textContent = "□";
                    FileElementIcon.style.fontWeight = "1500";
                    FileElementIcon.style.fontSize = "1em";
                    FileElementIcon.style.background = "linear-gradient(to right, #ff0077, #7700ff)";
                    FileElementIcon.style.backgroundClip = "text";
                    FileElementIcon.style.color = "transparent";


                    const fileNameInput = document.createElement('input');
                    fileNameInput.type = 'text';
                    fileNameInput.value = name;
                    fileNameInput.disabled = true;
                    fileElement.appendChild(FileElementIcon);
                    fileElement.appendChild(fileNameInput);

                    const options = document.createElement('div');
                    options.className = 'options';

                    const menuButton = document.createElement('span');
                    menuButton.className = 'menu-btn';
                    menuButton.textContent = '…';
                    menuButton.addEventListener('click', (event) => {
                        const dropdown = event.currentTarget.nextElementSibling;
                        dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
                    });

                    const dropdown = document.createElement('div');
                    dropdown.className = 'dropdown';

                    const newfileforfiles = document.createElement('div');
                    newfileforfiles.className = 'index';
                    newfileforfiles.textContent = name;

                    newfileforfiles.addEventListener('click', () => {
                        editor.refresh();
                        currentFile = name;
                        files.querySelector('.index.highlight')?.classList.remove('highlight');
                        newfileforfiles.classList.add("highlight");
                        isonpreview = false;
                        checkscreensizing();
                    });

                    files.appendChild(newfileforfiles);

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Delete';
                    deleteButton.addEventListener('click', () => {
                        const index = filenames.indexOf(name);
                        if (index !== -1) filenames.splice(index, 1);
                        delete mode[name];
                        delete values[name];
                        fileElement.remove();
                        newfileforfiles.remove();
                        menuButton.click();
                        document.querySelector('.view').click();
                    });

                    const renameButton = document.createElement('button');
                    renameButton.textContent = 'Rename';
                    renameButton.addEventListener('click', () => {
                        menuButton.click();
                        if (fileNameInput.disabled) {
                            fileNameInput.disabled = false;
                            fileNameInput.focus();
                            fileNameInput.classList.add('editing');

                            fileNameInput.addEventListener('keydown', (event) => {
                                if (event.key === 'Enter') {
                                    let newName = fileNameInput.value.trim();
                                    if (newName && newName !== name && !filenames.includes(newName)) {
                                        const index = filenames.indexOf(name);
                                        if (index !== -1) filenames[index] = newName;

                                        allimages[newName] = allimages[name];

                                        name = newName;
                                        fileNameInput.value = name;
                                        newfileforfiles.textContent = name;
                                        oldname = name;
                                        fileNameInput.disabled = true;
                                        fileNameInput.classList.remove('editing');
                                    } else {
                                        fileNameInput.value = oldname;
                                        newfileforfiles.textContent = name;
                                        fileNameInput.disabled = true;
                                        fileNameInput.classList.remove('editing');
                                    }
                                }
                            });

                            fileNameInput.addEventListener('blur', () => {
                                let newName = fileNameInput.value.trim();
                                if (newName && newName !== name && !filenames.includes(newName)) {
                                    const index = filenames.indexOf(name);
                                    if (index !== -1) filenames[index] = newName;

                                    allimages[newName] = allimages[name];

                                    name = newName;
                                    fileNameInput.value = name;
                                    newfileforfiles.textContent = name;
                                    oldname = name;
                                    fileNameInput.disabled = true;
                                    fileNameInput.classList.remove('editing');
                                }else {
                                    fileNameInput.value = oldname;
                                    newfileforfiles.textContent = name;
                                    fileNameInput.disabled = true;
                                    fileNameInput.classList.remove('editing');
                                }
                            });
                        }
                    });


                    const downloadButton = document.createElement('button');
                    downloadButton.textContent = 'Download';
                    downloadButton.addEventListener('click', () => {
                        menuButton.click();
                        const blob = new Blob([allimages[name]], { type: `image/${imgType[name]}` });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = name;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    });

                    const copyFilePathButton = document.createElement('button');
                    copyFilePathButton.textContent = 'path';
                    copyFilePathButton.addEventListener('click', () => {
                        menuButton.click();
                        const textarea = document.createElement('textarea');
                        textarea.value = name;
                        document.body.appendChild(textarea);
                        textarea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textarea);
                    });

                    dropdown.appendChild(deleteButton);
                    dropdown.appendChild(renameButton);
                    dropdown.appendChild(downloadButton);
                    dropdown.appendChild(copyFilePathButton);
                    options.appendChild(menuButton);
                    options.appendChild(dropdown);
                    fileElement.appendChild(options);

                    return fileElement;
                }
            }


            function addNewFile(name = '') {
                if (filenames.includes(name)) {
                    alert('Eine Datei mit diesem Namen existiert bereits.');
                    return;
                }
                const newFile = createFileElement(name || `in${filenames.length + 2}dex.html`);
                fileList.appendChild(newFile);
            }

            addFileButton.addEventListener('click', () => {
                const newfilename = "index" + (filenames.length + 1) + ".html";
                addNewFile(newfilename);
            });

            toggleSidebarButton.addEventListener('click', () => {
                sidebar.classList.toggle('show');
            });

            let consolebtn = document.getElementById("consolebtn");

            consolebtn.addEventListener("click", () => {
                document.querySelector(".resizable-draggable").classList.toggle('show');
                document.getElementById('alert-icon').style.display = 'none';
            });

            hidesidebar.addEventListener('click', () => {
                sidebar.classList.toggle('show');
            });

            addNewFile('index.html');
            addNewFile('style.css');
            addNewFile('script.js');
        });

        function replacePaths(htmlString, allimages) {
            function findVariableValue(code, variableName, seen = new Set()) {
                if (seen.has(variableName)) return variableName;
                seen.add(variableName);

                const regex = new RegExp(`(?:var|let|const)?\\s+${variableName}\\s*=\\s*(['"\`]?)([^'"\`]+)\\1`, 'g');
                const match = regex.exec(code);

                if (match) {
                    const value = match[2];

                    const variableRegex = /^[a-zA-Z_$][a-zA-Z_$0-9]*$/;
                    if (variableRegex.test(value)) {
                        return findVariableValue(code, value, seen);
                    }

                    const templateLiteralRegex = /\$\{([^}]+)\}/g;
                    if (templateLiteralRegex.test(value)) {
                        return value.replace(templateLiteralRegex, (match, p1) => {
                            const innerValue = findVariableValue(code, p1, seen);
                            return innerValue !== undefined ? innerValue : p1;
                        });
                    }

                    return value;
                }

                return variableName;
            }


            htmlString = htmlString.replaceAll(/<img\s+[^>]*src=["']([^"']+)["'][^>]*>/g, (match, src) => {
                if (allimages[src]) {
                    return match.replaceAll(src, allimages[src]);
                }
                return match;
            });

            htmlString = htmlString.replaceAll(/<style[^>]*>([\s\S]*?)<\/style>/g, (match, cssText) => {
                Object.keys(allimages).forEach(key => {
                    const regex = new RegExp(`url\\(['"]?${key}['"]?\\)`, 'g');
                    cssText = cssText.replaceAll(regex, `url('${allimages[key]}')`);
                });
                return `<style>${cssText}</style>`;
            });

            htmlString = htmlString.replaceAll(/style=["']([^"']+)["']/g, (match, styleText) => {
                Object.keys(allimages).forEach(key => {
                    const regex = new RegExp(`url\\(['"]?${key}['"]?\\)`, 'g');
                    styleText = styleText.replaceAll(regex, `url(\'${allimages[key]}\')`);
                });
                return `style="${styleText}"`;
            });
            htmlString = htmlString.replace(/<script(?![^>]*\ssrc)[\s\S]*?>([\s\S]*?)<\/script>/g, (match, code) => {
                Object.keys(allimages).forEach(key => {

                    const regexTemplateLiteral = new RegExp("\\${([^}]+)}", "g");

                    code = code.replaceAll(regexTemplateLiteral, (match, p1) => {
                        const p1split = p1.split("+");
                        let p1result = "";
                        p1split.forEach(p1key => {
                            let p1_ = p1key.trim();
                            const p1resultv = findVariableValue(code, p1_); 
                            p1result += p1resultv;
                        });
                        return p1result;
                    });

                    const urlRegex = new RegExp(`url\\(['"]?${key}['"]?\\)`, 'g');

                    let alsocheckedCode = findVariableValue(code, key);
                    code = code.replaceAll(urlRegex, (match, p1) => {
                        return `url('${allimages[alsocheckedCode]}')`;
                    });

                    const regex = new RegExp(`(['"\`]?${key}['"\`]?)`, 'g');
                    let checkedCode = findVariableValue(code, key);
                    code = code.replaceAll(regex, `(\'${allimages[checkedCode]}\')`);
                    const regex8 = new RegExp(`\\s*=\\s*['"\`]?${key}['"\`]?`, 'g');
                    let checkedCode8 = findVariableValue(code, key);
                    code = code.replaceAll(regex8, (match) => {
                        if (allimages[checkedCode8]) {
                            return ` = '${allimages[checkedCode8]}'`;
                        }
                        return match;
                    });
                    const regex4 = new RegExp(`.src\\s*=\\s*['"\`]?${key}['"\`]?`, 'g');
                    let checkedCode4 = findVariableValue(code, key);
                    code = code.replaceAll(regex4, (match) => {
                        return `.src = '${allimages[checkedCode5]}'`;
                    });
                    const regex5 = new RegExp(`Img\\s*=\\s*['"\`]?${key}['"\`]?`, 'g');

                    let checkedCode5 = findVariableValue(code, key);

                    code = code.replaceAll(regex5, (match) => {
                        return `Img = '${allimages[checkedCode5]}'`;
                    });
                });
                const textureRegex = /new\s*THREE\.TextureLoader\(\)\.load\(['"`]?([^'"`]+)['"`]?\)/g;
                code = code.replace(textureRegex, (match, p1) => {
                    let checkedCode = findVariableValue(code, p1);
                    return allimages[checkedCode] ? `new THREE.TextureLoader().load('${allimages[checkedCode]}')` : match;
                });
                return `<script>${code}<\/script>`;
            });

            return htmlString;
        }


        const preview = document.getElementById('preview');
        const runButton = document.getElementById('runbtn');
        let running = false;

        let filename = document.getElementById('filename');
        function externalConsoleLog(message) {
            let consoleOutput = document.getElementById('console');
            consoleOutput.innerText += message + '\n';
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function replaceLinksAndScripts(htmlString, values) {
            htmlString = htmlString.replace(/<link\s+[^>]*rel=["']stylesheet["'][^>]*href=["']([^"']+)["'][^>]*>/g, (match, href) => {
                if (values[href]) {
                    return `<style>\n${values[href]}\n</style>`;
                }
                return match;
            });

            htmlString = htmlString.replaceAll(/<script\s+[^>]*src=["']([^"']+)["'][^>]*><\/script>/g, (match, src) => {
                if (values[src]) {
                    return `<script>\n${values[src]}\n<\/script>`;
                }
                return match;
            });

            return htmlString;
        }


        function processHtmlMixedCode(htmlString) {
            htmlString = htmlString.replace(/<script(?![^>]*\ssrc)[\s\S]*?>([\s\S]*?)<\/script>/g, (match, scriptContent) => {
                const wrappedScriptContent = `
        try {
            ${scriptContent.trim()}
        } catch (error) {
            window.parent.postMessage({
                type: 'error',
                message: \`\${error.name}: \${error.message}\n\`
            }, '*');
        }
                `;
                return `<script>${wrappedScriptContent}<\/script>`;
            });

            return htmlString;
        }


        function processHtmlForWindowLocation(htmlMixedCode) {
            let editedHtmlMixedCode = htmlMixedCode.replace(/window\.location(?:\.href)?\s*=\s*(?:`([^`]*)`|(['"`])([^'"`;\s]+)\2|([^;\s]+))\s*;/g, (match, templateLiteral, quote, quotedValue, unquotedValue) => {
                const location = templateLiteral ? `\`${templateLiteral}\`` : (quote ? `${quote}${quotedValue}${quote}` : unquotedValue);

                return `window.parent.postMessage({ type: 'get window location', message: ${location} }, '*');`;
            });

            const monitorScript = `
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                document.body.addEventListener('click', function(event) {
                    if (event.target.tagName === 'A' && event.target.href) {
                        event.preventDefault();
                        window.parent.postMessage({
                            type: 'get window location',
                            message: event.target.href
                        }, '*');
                    }
                });
            });
            document.querySelectorAll('a[href]').forEach(function(link) {
                link.addEventListener('click', function(event) {
                    event.preventDefault();

                    // Nachricht an das parent-Window senden
                    window.parent.postMessage({
                        type: 'get window location',
                        message: this.href
                    }, '*');
                });
            });
        <\/script>\n
            `;
            const bodyTagPosition = editedHtmlMixedCode.lastIndexOf('</body>');
            if (bodyTagPosition !== -1) {
                editedHtmlMixedCode = editedHtmlMixedCode.slice(0, bodyTagPosition) + monitorScript + editedHtmlMixedCode.slice(bodyTagPosition);
            } else {
                editedHtmlMixedCode += monitorScript;
            }

            return `${editedHtmlMixedCode}`;
        }

        function refreshFunction() {
            running = false;
            runbuttononclick();
        }

        function runbuttononclick() {
            isonpreview = true;
            document.querySelector('.index.highlight')?.classList.remove('highlight');
            viewelement.classList.add(`highlight`);
            isonpreview = true;
            checkscreensizing();
            values[currentFile] = editor.getValue();
            let code = values[indexfile];
            let consoleDiv = document.getElementById('console');
            if (code && indexfile.includes('.html')){
                code = replaceLinksAndScripts(code, values);
                code = replacePaths(code, allimages);
                code = processHtmlMixedCode(code);
                code = processHtmlForWindowLocation(code);
                code = replaceConsoleMethodsInCode(code);
                running = !running;
                runButton.textContent = running ? "Stop" : "Test";
                if (running){
                    document.getElementById('filename').value = `${indexfile}`;
                    startLoading();
                    preview.srcdoc = code;
                    finishLoading();
                }else {
                    startLoading();
                    consoleDiv.innerHTML = '';
                    document.getElementById('alert-icon').style.display = 'none';
                    preview.srcdoc = "";
                    finishLoading();
                }
            }else {
                startLoading();
                consoleDiv.innerHTML = '';
                document.getElementById('alert-icon').style.display = 'none';
                preview.srcdoc = "";
                running = !running;
                runButton.textContent = "Test";
                finishLoading();
            }
        }
        runButton.addEventListener('click', () => {
            runbuttononclick();
        });

        editor.on('keyup', function(editor, event) {
            values[currentFile] = editor.getValue();
        });

        function replaceConsoleMethodsInCode(code) {
            const methods = ['log', 'error', 'warn', 'info', 'debug', 'table', 'trace', 'clear', 'group', 'groupEnd', 'assert', 'count', 'countReset', 'markTimeline', 'profile', 'profileEnd', 'time', 'timeEnd', 'timeStamp', 'dir', 'dirxml', 'groupCollapsed'];

            const consolePattern = new RegExp(`console\\.(${methods.join('|')})\\s*\\(([^)]*)\\)`, 'g');

            const replacedCode = code.replace(consolePattern, (match, method, args) => {
                if (args !== ''){
                    return `console.${method}(${args});\nwindow.parent.postMessage({ type: '${method}', message: ${args} }, '*');`;
                }else {
                    return `console.${method}(${args});\nwindow.parent.postMessage({ type: '${method}', message: "placeholder" }, '*');`;
                }
                
            });

            return replacedCode;
        }

        editor.on('text-change', () => {
            values[currentFile] = editor.getValue();
            const doc = editor.getDoc();
            const cursor = doc.getCursor();
            const line = cursor.line;
            const ch = cursor.ch;

            const closingBracket = completionsbrackets[event.key];

            if (closingBracket) {
                doc.replaceRange(closingBracket, { line: line, ch: ch });

                doc.setCursor({ line: line, ch: ch });
            }
 
            if (cursorPositions[currentFile]){
                cursorPositions[currentFile].line = line;
                cursorPositions[currentFile].column = ch;
            }

        });
        editor.on('inputRead', () => {
            values[currentFile] = editor.getValue();
        });

        const consoleDiv = document.getElementById('console');
        const consoleMethods = [
            'log', 'error', 'warn', 'info', 'debug', 'trace', 'dir', 'dirxml', 'group', 'groupEnd', 
            'time', 'timeEnd', 'assert', 'count', 'markTimeline', 'profile', 'profileEnd', 
            'clearTimeline', 'countReset', 'memory', 'memoryProfile', 'memoryUsage', 
            'timeStamp', 'timeStampEnd', 'timeOrigin', 'timeOriginEnd', 'timeOriginStart', 'clear'
        ];

        function captureConsoleWithEvents(consoleDivId) {
            var originalConsole = {};

            ['log', 'error', 'warn', 'info', 'debug', 'table', 'trace', 'clear', 'group', 'groupEnd', 'assert', 'count', 'countReset', 'markTimeline', 'profile', 'profileEnd', 'time', 'timeEnd', 'timeStamp', 'dir', 'dirxml', 'groupCollapsed'].forEach(method => {
                if (typeof console[method] === 'function') {
                    originalConsole[method] = console[method];
                }
            });

            function appendToConsoleDiv(type, message) {
                var newElement = document.createElement('div');
                newElement.className = type;
                if (type == 'warn'){
                    newElement.textContent = '⚠ ' + message;
                }else if (type == 'error'){
                    newElement.textContent = '⊗ ' + message;
                    document.getElementById('alert-icon').style.display = 'inline';
                }else if (type == 'info'){
                    newElement.textContent = 'ⓘ ' + message;
                }else if (type == 'table'){
                    newElement.textContent = '□ ' + message;
                }else if (type == 'debug'){
                    newElement.textContent = '◆ ' + message;
                }else if (type == 'trace'){
                    newElement.textContent = '☉ ' + message;
                }else if (type == 'table'){
                    newElement.textContent = '□ ' + message;
                }else if (type == 'time'){
                    newElement.textContent = '○ ' + message;
                }else if (type == 'timeEnd'){
                    newElement.textContent = '○ ' + message;
                }else if (type == 'log'){
                    newElement.textContent = '✎ ' + message;
                }else {
                    newElement.textContent = message;
                }
                consoleDiv.appendChild(newElement);
            }

            function dispatchConsoleEvent(type, message) {
                var event = new CustomEvent('consoleActivity', {
                    detail: { type: type, message: message }
                });
                window.dispatchEvent(event);
            }
            
            if (originalConsole.log) {
                console.log = function(...args) {
                    appendToConsoleDiv('log', args.join(' '));
                    dispatchConsoleEvent('log', args.join(' '));
                    originalConsole.log.apply(console, args);
                };
            }

            if (originalConsole.error) {
                console.error = function(...args) {
                    appendToConsoleDiv('error', args.join(' '));
                    dispatchConsoleEvent('error', args.join(' '));
                    originalConsole.error.apply(console, args);
                };
            }

            if (originalConsole.warn) {
                console.warn = function(...args) {
                    appendToConsoleDiv('warn', args.join(' '));
                    dispatchConsoleEvent('warn', args.join(' '));
                    originalConsole.warn.apply(console, args);
                };
            }

            if (originalConsole.info) {
                console.info = function(...args) {
                    appendToConsoleDiv('info', args.join(' '));
                    dispatchConsoleEvent('info', args.join(' '));
                    originalConsole.info.apply(console, args);
                };
            }

            if (originalConsole.debug) {
                console.debug = function(...args) {
                    appendToConsoleDiv('debug', args.join(' '));
                    dispatchConsoleEvent('debug', args.join(' '));
                    originalConsole.debug.apply(console, args);
                };
            }

            if (originalConsole.table) {
                console.table = function(...args) {
                    appendToConsoleDiv('table', JSON.stringify(args, null, 2));
                    dispatchConsoleEvent('table', JSON.stringify(args, null, 2));
                    originalConsole.table.apply(console, args);
                };
            }

            if (originalConsole.trace) {
                console.trace = function(...args) {
                    appendToConsoleDiv('trace', new Error().stack);
                    dispatchConsoleEvent('trace', new Error().stack);
                    originalConsole.trace.apply(console, args);
                };
            }

            if (originalConsole.clear) {
                console.clear = function() {
                    consoleDiv.innerHTML = '';  // Leert das consoleDiv
                    dispatchConsoleEvent('clear', 'Console cleared');
                    originalConsole.clear.apply(console);
                };
            }

            if (originalConsole.group) {
                console.group = function(...args) {
                    appendToConsoleDiv('group', args.join(' '));
                    dispatchConsoleEvent('group', args.join(' '));
                    originalConsole.group.apply(console, args);
                };
            }

            if (originalConsole.groupEnd) {
                console.groupEnd = function(...args) {
                    appendToConsoleDiv('groupEnd', 'Group End');
                    dispatchConsoleEvent('groupEnd', 'Group End');
                    originalConsole.groupEnd.apply(console, args);
                };
            }

            if (originalConsole.assert) {
                console.assert = function(...args) {
                    appendToConsoleDiv('assert', args.join(' '));
                    dispatchConsoleEvent('assert', args.join(' '));
                    originalConsole.assert.apply(console, args);
                };
            }

            if (originalConsole.count) {
                console.count = function(...args) {
                    appendToConsoleDiv('count', args.join(' '));
                    dispatchConsoleEvent('count', args.join(' '));
                    originalConsole.count.apply(console, args);
                };
            }

            if (originalConsole.countReset) {
                console.countReset = function(...args) {
                    appendToConsoleDiv('countReset', args.join(' '));
                    dispatchConsoleEvent('countReset', args.join(' '));
                    originalConsole.countReset.apply(console, args);
                };
            }

            if (originalConsole.markTimeline) {
                console.markTimeline = function(...args) {
                    appendToConsoleDiv('markTimeline', args.join(' '));
                    dispatchConsoleEvent('markTimeline', args.join(' '));
                    originalConsole.markTimeline.apply(console, args);
                };
            }

            if (originalConsole.profile) {
                console.profile = function(...args) {
                    appendToConsoleDiv('profile', args.join(' '));
                    dispatchConsoleEvent('profile', args.join(' '));
                    originalConsole.profile.apply(console, args);
                };
            }

            if (originalConsole.profileEnd) {
                console.profileEnd = function(...args) {
                    appendToConsoleDiv('profileEnd', args.join(' '));
                    dispatchConsoleEvent('profileEnd', args.join(' '));
                    originalConsole.profileEnd.apply(console, args);
                };
            }

            if (originalConsole.time) {
                console.time = function(...args) {
                    appendToConsoleDiv('time', args.join(' '));
                    dispatchConsoleEvent('time', args.join(' '));
                    originalConsole.time.apply(console, args);
                };
            }

            if (originalConsole.timeEnd) {
                console.timeEnd = function(...args) {
                    appendToConsoleDiv('timeEnd', args.join(' '));
                    dispatchConsoleEvent('timeEnd', args.join(' '));
                    originalConsole.timeEnd.apply(console, args);
                };
            }

            if (originalConsole.timeStamp) {
                console.timeStamp = function(...args) {
                    appendToConsoleDiv('timeStamp', args.join(' '));
                    dispatchConsoleEvent('timeStamp', args.join(' '));
                    originalConsole.timeStamp.apply(console, args);
                };
            }

            if (originalConsole.timeStampEnd) {
                console.timeStampEnd = function(...args) {
                    appendToConsoleDiv('timeStampEnd', args.join(' '));
                    dispatchConsoleEvent('timeStampEnd', args.join(' '));
                    originalConsole.timeStampEnd.apply(console, args);
                };
            }

            if (originalConsole.timeOrigin) {
                console.timeOrigin = function(...args) {
                    appendToConsoleDiv('timeOrigin', args.join(' '));
                    dispatchConsoleEvent('timeOrigin', args.join(' '));
                    originalConsole.timeOrigin.apply(console, args);
                };
            }

            if (originalConsole.timeOriginEnd) {
                console.timeOriginEnd = function(...args) {
                    appendToConsoleDiv('timeOriginEnd', args.join(' '));
                    dispatchConsoleEvent('timeOriginEnd', args.join(' '));
                    originalConsole.timeOriginEnd.apply(console, args);
                };
            }

            if (originalConsole.timeOriginStart) {
                console.timeOriginStart = function(...args) {
                    appendToConsoleDiv('timeOriginStart', args.join(' '));
                    dispatchConsoleEvent('timeOriginStart', args.join(' '));
                    originalConsole.timeOriginStart.apply(console, args);
                };
            }

            if (originalConsole.dir) {
                console.dir = function(...args) {
                    appendToConsoleDiv('dir', JSON.stringify(args, null, 2));
                    dispatchConsoleEvent('dir', JSON.stringify(args, null, 2));
                    originalConsole.dir.apply(console, args);
                };
            }

            if (originalConsole.dirxml) {
                console.dirxml = function(...args) {
                    appendToConsoleDiv('dirxml', JSON.stringify(args, null, 2));
                    dispatchConsoleEvent('dirxml', JSON.stringify(args, null, 2));
                    originalConsole.dirxml.apply(console, args);
                };
            }

            if (originalConsole.groupCollapsed) {
                console.groupCollapsed = function(...args) {
                    appendToConsoleDiv('groupCollapsed', args.join(' '));
                    dispatchConsoleEvent('groupCollapsed', args.join(' '));
                    originalConsole.groupCollapsed.apply(console, args);
                };
            }
        }
        
        captureConsoleWithEvents('consoleDiv');
        window.addEventListener('message', (event) => {
            const { type, message } = event.data;

            if (type && message !== undefined && type != 'get window location') {
                console[type](message);
            }else if (type && message !== undefined && type == 'get window location'){
                let presrcdoc = document.getElementById('preview');
                let cmessagee = message;
                let cmessageel = message.split('/');
                cmessagee = cmessageel[cmessageel.length - 1];

                if (values[`${cmessagee}`] == undefined){
                    presrcdoc.srcdoc = '';
                }else if (values[`${cmessagee}`] != undefined){
                    indexfile = `${cmessagee}`;
                    runbuttononclick();
                    runbuttononclick();
                }
            }
        });


        function addToConsole2(message, type) {
            const newMessage = document.createElement('div');
            newMessage.className = type;
            newMessage.textContent = message;
            consoleDiv.appendChild(newMessage);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        const relement = document.getElementById('resizable-element');
        const move_button = document.querySelector('.move-button');
        let isMouseDown = false;
        let offsetX, offsetY;

        move_button.addEventListener('mousedown', function(e) {
            isMouseDown = true;
            offsetX = e.clientX - relement.offsetLeft;
            offsetY = e.clientY - relement.offsetTop;
        });

        document.addEventListener('mouseup', function() {
            isMouseDown = false;
        });

        document.addEventListener('mousemove', function(e) {
            if (isMouseDown) {
                relement.style.left = `${e.clientX - offsetX}px`;
                relement.style.top = `${e.clientY - offsetY}px`;
            }
        });

        move_button.addEventListener('touchstart', function(e) {
            isMouseDown = true;
            const touch = e.touches[0];
            offsetX = touch.clientX - relement.offsetLeft;
            offsetY = touch.clientY - relement.offsetTop;
        });

        document.addEventListener('touchend', function() {
            isMouseDown = false;
        });

        document.addEventListener('touchmove', function(e) {
            if (isMouseDown) {
                const touch = e.touches[0];
                relement.style.left = `${touch.clientX - offsetX}px`;
                relement.style.top = `${touch.clientY - offsetY}px`;
            }
        });

        function closeElement() {
            document.querySelector(".resizable-draggable").classList.toggle('show');
        }

        let warningelement = document.getElementById('warning');
        let errorelement = document.getElementById('error');
        let infoelement = document.getElementById('info');
        let debugelement = document.getElementById('debug');
        let loggelement = document.getElementById('log');
        let allelement = document.getElementById('all');


        warningelement.addEventListener('click', () => {
            document.querySelectorAll('.warn').forEach(child => child.style.display = 'block');
            document.querySelectorAll('.error').forEach(child => child.style.display = 'none');
            document.querySelectorAll('.info').forEach(child => child.style.display = 'none');
            document.querySelectorAll('.log').forEach(child => child.style.display = 'none');
            document.querySelector('.console-setting-btn.enabled')?.classList.remove('enabled');
            warningelement.classList.add("enabled");
        });
        errorelement.addEventListener('click', () => {
            document.querySelectorAll('.warn').forEach(child => child.style.display = 'none');
            document.querySelectorAll('.error').forEach(child => child.style.display = 'block');
            document.querySelectorAll('.info').forEach(child => child.style.display = 'none');
            document.querySelectorAll('.log').forEach(child => child.style.display = 'none');
            document.querySelector('.console-setting-btn.enabled')?.classList.remove('enabled');
            errorelement.classList.add("enabled");
        });
        infoelement.addEventListener('click', () => {
            document.querySelectorAll('.warn').forEach(child => child.style.display = 'none');
            document.querySelectorAll('.error').forEach(child => child.style.display = 'none');
            document.querySelectorAll('.info').forEach(child => child.style.display = 'block');
            document.querySelectorAll('.log').forEach(child => child.style.display = 'none');
            document.querySelector('.console-setting-btn.enabled')?.classList.remove('enabled');
            infoelement.classList.add("enabled");
        });
        loggelement.addEventListener('click', () => {
            document.querySelectorAll('.warn').forEach(child => child.style.display = 'none');
            document.querySelectorAll('.error').forEach(child => child.style.display = 'none');
            document.querySelectorAll('.info').forEach(child => child.style.display = 'none');
            document.querySelectorAll('.log').forEach(child => child.style.display = 'block');
            document.querySelector('.console-setting-btn.enabled')?.classList.remove('enabled');
            loggelement.classList.add("enabled");
        });
        allelement.addEventListener('click', () => {
            document.querySelectorAll('.warn').forEach(child => child.style.display = 'block');
            document.querySelectorAll('.error').forEach(child => child.style.display = 'block');
            document.querySelectorAll('.info').forEach(child => child.style.display = 'block');
            document.querySelectorAll('.log').forEach(child => child.style.display = 'block');
            document.querySelector('.console-setting-btn.enabled')?.classList.remove('enabled');
            allelement.classList.add("enabled");
        });
        function isDarkMode() {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                changeFavicon('AIlurylogo2.ico');
            } else {
                changeFavicon('AIlurylogo.ico');
            }
        }
        function changeFavicon(faviconurl) {
            let favilink = document.getElementById("faviconico");

            if (favilink) {
                favilink.href = faviconurl;
            } else {
                favilink = document.createElement('link');
                favilink.id = 'faviconico';
                favilink.rel = 'icon';
                favilink.href = faviconurl;
                favilink.type = 'image/x-icon';
                document.head.appendChild(favilink);
            }
        }

        function updateModeInfo() {
            isDarkMode();
        }

        updateModeInfo();

        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', updateModeInfo);

        document.querySelector('.view').click();

    </script>
</body>
</html>
